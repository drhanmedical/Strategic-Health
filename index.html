<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Han | Strategic Health, Wellness & Regulatory Leader</title>
    <meta name="description" content="Sitio Oficial del Dr. Edgar Ivan Bañuelos Han. Liderazgo estratégico en Salud Ocupacional, Bienestar Corporativo y Cumplimiento Normativo.">
    
    <!-- Google Fonts (Incluyendo Dancing Script para la firma) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Inter:wght@300;400;500;600&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">

    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js para el Dashboard -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: '#0f172a',    // Navy Blue Profundo
                        slate: '#f8fafc',   // Slate 50 (Fondos claros)
                        sky: '#0ea5e9',     // Sky Blue (Visión)
                        teal: '#0d9488',    // Teal (Salud/Seguridad)
                        whatsapp: '#25D366', // Verde WhatsApp
                        ai: '#6366f1',       // Indigo para IA
                        orange: '#f97316',    // Naranja para Ergonomía
                        macGreen: '#22c55e',
                        macAmber: '#eab308',
                        macRed: '#ef4444',
                        macPurple: '#a855f7'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        heading: ['Montserrat', 'sans-serif'],
                        signature: ['Dancing Script', 'cursive'], // Tipografía para firma
                    },
                    boxShadow: {
                        'glow': '0 4px 20px -2px rgba(13, 148, 136, 0.5)',
                        'ai-glow': '0 4px 25px -5px rgba(99, 102, 241, 0.5)',
                    },
                    animation: {
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'bounce-short': 'bounce 0.5s ease-in-out 2'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        h1, h2, h3, h4, .font-heading { font-family: 'Montserrat', sans-serif; }
        .font-signature { font-family: 'Dancing Script', cursive; }
        .gradient-text { background: linear-gradient(to right, #0ea5e9, #0d9488); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* Dashboard Styles */
        .dash-sidebar-btn { transition: all 0.3s ease; }
        .dash-sidebar-btn.active { background-color: rgba(255, 255, 255, 0.1); border-left: 4px solid #0d9488; color: white; }
        .dash-sidebar-btn:hover:not(.active) { background-color: rgba(255, 255, 255, 0.05); }
        .kpi-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .kpi-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        
        /* Range Slider Styling for Simulator */
        input[type=range] {
            -webkit-appearance: none; 
            background: transparent; 
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 16px; width: 16px;
            border-radius: 50%;
            background: #ffffff;
            cursor: pointer;
            margin-top: -6px; 
            box-shadow: 0 1px 3px rgba(0,0,0,0.3);
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 4px;
            cursor: pointer;
            background: rgba(255,255,255,0.3);
            border-radius: 2px;
        }
        
        /* Toggle Switch Styling */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #0d9488;
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #0d9488;
        }
        
        /* Tooltip Custom */
        .tooltip-container { position: relative; display: inline-block; }
        .tooltip-text {
            visibility: hidden; width: 200px; background-color: #1e293b; color: #fff; text-align: center;
            border-radius: 6px; padding: 8px; position: absolute; z-index: 1;
            bottom: 125%; left: 50%; margin-left: -100px; opacity: 0; transition: opacity 0.3s;
            font-size: 0.75rem; font-weight: normal; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .tooltip-container:hover .tooltip-text { visibility: visible; opacity: 1; }
        
        /* Audit Animation classes */
        .audit-check { opacity: 0; transform: scale(0.5); transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .audit-check.checked { opacity: 1; transform: scale(1); color: #22c55e; }
        
        /* FORCE BLACK TEXT ON SELECT OPTIONS (Dropdown Fix) */
        select option {
            color: #000000 !important;
            background-color: #ffffff !important;
        }
        
        /* Markdown-like output styling */
        .ai-response ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 1rem; }
        .ai-response strong { color: #0f172a; font-weight: 700; }
        .ai-response p { margin-bottom: 0.75rem; }
    </style>
</head>
<body class="bg-white text-gray-800 antialiased">

    <!-- NAVBAR FIXED -->
    <nav class="fixed w-full z-50 bg-navy/95 backdrop-blur-md shadow-lg border-b border-gray-800 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16 md:h-20 gap-4 lg:gap-8">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center">
                    <a href="#" class="text-white font-heading font-bold text-xl tracking-wide flex items-center">
                        <img src="https://drive.google.com/thumbnail?id=1oqMOYFDdIc47CKLMa3xCSSvptH9aJyeC&sz=w200" alt="Logo Dr. Han" class="h-10 mr-3" referrerpolicy="no-referrer">
                        <div class="flex flex-col sm:flex-row sm:items-center">
                            <span>DR. HAN</span> 
                            <span class="text-sky font-light sm:ml-2 text-xs sm:text-sm tracking-normal opacity-90 hidden lg:inline-block border-l border-gray-600 pl-2 ml-2">STRATEGIC HEALTH LEADER</span>
                        </div>
                    </a>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden md:flex space-x-4 lg:space-x-8 items-center">
                    <a href="#hero" class="text-gray-300 hover:text-white transition-colors text-sm font-medium tracking-wide" data-i18n="nav_home">Inicio</a>
                    <a href="#about" class="text-gray-300 hover:text-white transition-colors text-sm font-medium tracking-wide" data-i18n="nav_strategy">Estrategia</a>
                    <!-- NUEVO LINK -->
                    <a href="#legal-shield" class="text-red-300 hover:text-red-100 transition-colors text-sm font-bold tracking-wide flex items-center gap-1"><i class="fas fa-shield-halved text-xs"></i> <span data-i18n="nav_legal">Normatividad</span></a>
                    <a href="#bi" class="text-teal hover:text-white transition-colors text-sm font-bold tracking-wide" data-i18n="nav_bi">BI & Dashboard</a>
                    <a href="#ai-simulator" class="text-indigo-400 hover:text-indigo-300 transition-colors text-sm font-bold tracking-wide flex items-center gap-1"><i class="fas fa-robot"></i> <span data-i18n="nav_ai">AI Sim</span></a>
                    <a href="#trayectoria" class="text-gray-300 hover:text-white transition-colors text-sm font-medium tracking-wide" data-i18n="nav_career">Trayectoria</a>
                    
                    <a href="https://wa.me/525629846164" target="_blank" class="bg-teal hover:bg-teal/90 text-white px-4 py-2 rounded-full text-xs lg:text-sm font-bold transition-all shadow-glow flex items-center gap-2 transform hover:scale-105">
                        <i class="fab fa-whatsapp"></i> <span class="hidden lg:inline" data-i18n="nav_whatsapp">WhatsApp directo</span>
                    </a>

                    <button id="lang-toggle" class="ml-2 px-3 py-1 rounded border border-gray-500 text-gray-300 hover:text-white hover:border-white transition-colors text-xs font-bold uppercase w-10 text-center">EN</button>
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center gap-4">
                     <button id="lang-toggle-mobile" class="px-2 py-1 rounded border border-gray-500 text-gray-300 text-xs font-bold uppercase w-8 text-center">EN</button>
                    <button id="mobile-menu-btn" class="text-gray-300 hover:text-white focus:outline-none">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Mobile Menu Panel -->
        <div id="mobile-menu" class="hidden md:hidden bg-navy border-t border-gray-800 absolute w-full">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 text-center">
                <a href="#hero" class="block px-3 py-2 text-gray-300 hover:text-white font-medium" data-i18n="nav_home">Inicio</a>
                <a href="#about" class="block px-3 py-2 text-gray-300 hover:text-white font-medium" data-i18n="nav_strategy">Estrategia</a>
                <a href="#legal-shield" class="block px-3 py-2 text-red-300 hover:text-white font-medium"><i class="fas fa-shield-halved text-xs"></i> <span data-i18n="nav_legal">Normatividad</span></a>
                <a href="#bi" class="block px-3 py-2 text-teal font-bold" data-i18n="nav_bi">Data & BI</a>
                <a href="#ai-simulator" class="block px-3 py-2 text-indigo-400 font-bold" data-i18n="nav_ai_full">AI Strategic Sim ✨</a>
                <a href="#trayectoria" class="block px-3 py-2 text-gray-300 hover:text-white font-medium" data-i18n="nav_career">Trayectoria</a>
            </div>
        </div>
    </nav>

    <!-- HERO SECTION -->
    <section id="hero" class="relative bg-navy pt-24 md:pt-32 lg:pt-36 pb-16 lg:pb-24 overflow-hidden">
        <div class="absolute top-0 right-0 -mr-20 -mt-20 w-96 h-96 bg-sky/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 -ml-20 -mb-20 w-80 h-80 bg-teal/10 rounded-full blur-3xl"></div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16 items-center">
                
                <div class="order-2 lg:order-1 text-center lg:text-left pt-2 lg:pt-0">
                    <span class="inline-block py-1 px-3 rounded-full bg-slate-800 border border-slate-700 text-sky text-[10px] lg:text-xs font-bold tracking-widest mb-4 uppercase" data-i18n="hero_badge">Salud Ocupacional y Bienestar Corporativo</span>
                    <h1 class="text-3xl sm:text-4xl lg:text-5xl xl:text-6xl font-heading font-extrabold text-white leading-tight mb-5" data-i18n="hero_h1">
                        Strategic Health, <br>
                        <span class="gradient-text">Wellness & Regulatory</span> Leader.
                    </h1>
                    <h2 class="text-base lg:text-lg text-gray-400 mb-8 font-light leading-relaxed max-w-2xl mx-auto lg:mx-0 text-justify hyphens-auto lg:text-left" data-i18n="hero_desc">
                        Soy el <strong class="text-white">Dr. Han</strong>. Lidero la transformación de la salud corporativa, alineando el cumplimiento normativo estricto con estrategias de bienestar que impulsan la rentabilidad y blindan la operación.
                    </h2>
                    
                    <div class="flex flex-col sm:flex-row gap-3 justify-center lg:justify-start">
                        <a href="#bi" class="px-6 py-3.5 bg-white text-navy font-bold rounded shadow hover:bg-gray-100 transition-colors text-sm sm:text-base border border-transparent hover:border-teal" data-i18n="hero_btn_vision">
                            Ver Dashboard Interactivo
                        </a>
                        <a href="#ai-simulator" class="px-6 py-3.5 bg-indigo-600 text-white font-bold rounded shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 transition-colors text-sm sm:text-base flex items-center gap-2 justify-center">
                            <i class="fas fa-robot"></i> <span data-i18n="hero_btn_ai">Probar AI Simulator</span>
                        </a>
                    </div>
                </div>

                <div class="order-1 lg:order-2 flex justify-center lg:justify-end">
                    <div class="relative w-full max-w-sm lg:max-w-md">
                        <div class="absolute inset-0 border-2 border-teal rounded-2xl transform translate-x-3 translate-y-3"></div>
                        <img 
                            src="https://drive.google.com/thumbnail?id=1VWqk33PEasus2aWjckWVViojvVw-cajS&sz=w1000" 
                            alt="Dr. Edgar Ivan Bañuelos Han" 
                            referrerpolicy="no-referrer"
                            class="relative rounded-2xl shadow-2xl w-full h-auto object-cover z-10 aspect-[4/5] object-top grayscale hover:grayscale-0 transition-all duration-700 ease-in-out bg-gray-800"
                        >
                        <div class="absolute bottom-8 -left-6 z-20 bg-white p-4 rounded-lg shadow-xl border-l-4 border-sky hidden sm:block">
                            <p class="text-navy font-bold text-sm" data-i18n="badge_id_label">Cédula profesional</p>
                            <p class="text-gray-600 text-xs">12210167</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION: SOBRE MÍ -->
    <section id="about" class="py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center max-w-3xl mx-auto mb-16">
                <h2 class="text-3xl lg:text-4xl font-heading font-bold text-navy mb-4" data-i18n="about_title">
                    Más allá de la medicina ocupacional: <span class="text-teal">gestión de riesgos.</span>
                </h2>
                <div class="w-24 h-1 bg-sky mx-auto rounded mb-6"></div>
                <p class="text-lg text-gray-600 leading-relaxed text-justify hyphens-auto px-4 lg:px-0" data-i18n="about_desc">
                    Elevo la salud ocupacional de un requisito operativo a una ventaja competitiva. Diseño e implemento estrategias de cumplimiento normativo y bienestar corporativo que no solo mitigan riesgos legales (STPS/ISO), sino que optimizan la productividad y aseguran la continuidad del negocio.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="p-8 rounded-xl bg-slate border border-gray-100 hover:shadow-xl transition-shadow group">
                    <div class="w-14 h-14 bg-navy rounded-lg flex items-center justify-center mb-6 group-hover:bg-sky transition-colors">
                        <i class="fas fa-scale-balanced text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-heading font-bold text-navy mb-3" data-i18n="card1_title">Liderazgo regulatorio</h3>
                    <p class="text-gray-600 text-sm leading-relaxed text-justify hyphens-auto" data-i18n="card1_desc">Implementación estricta de normatividad STPS e ISO 45001. Gestión proactiva para evitar multas y asegurar la continuidad operativa.</p>
                </div>

                <div class="p-8 rounded-xl bg-slate border border-gray-100 hover:shadow-xl transition-shadow group">
                    <div class="w-14 h-14 bg-navy rounded-lg flex items-center justify-center mb-6 group-hover:bg-teal transition-colors">
                        <i class="fas fa-heart-pulse text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-heading font-bold text-navy mb-3" data-i18n="card2_title">Wellness corporativo (ROI)</h3>
                    <p class="text-gray-600 text-sm leading-relaxed text-justify hyphens-auto" data-i18n="card2_desc">Programas de bienestar diseñados no solo para la salud, sino para mejorar la productividad, retención de talento y reducir la prima de riesgo.</p>
                </div>

                <div class="p-8 rounded-xl bg-slate border border-gray-100 hover:shadow-xl transition-shadow group">
                    <div class="w-14 h-14 bg-navy rounded-lg flex items-center justify-center mb-6 group-hover:bg-sky transition-colors">
                        <i class="fas fa-shield-virus text-white text-2xl"></i>
                    </div>
                    <h3 class="text-xl font-heading font-bold text-navy mb-3" data-i18n="card3_title">Gestión de crisis</h3>
                    <p class="text-gray-600 text-sm leading-relaxed text-justify hyphens-auto" data-i18n="card3_desc">Experiencia probada en vigilancia epidemiológica y respuesta rápida ante emergencias sanitarias en entornos de alto flujo como la aviación.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- NUEVA SECCIÓN: BLINDAJE REGULATORIO (STPS - COFEPRIS - SEMARNAT) -->
    <section id="legal-shield" class="py-20 bg-gradient-to-b from-gray-50 to-white border-y border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- Encabezado de la Sección -->
            <div class="mb-12 flex flex-col md:flex-row items-start md:items-end justify-between gap-6">
                <div class="max-w-3xl">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="px-2 py-1 rounded bg-navy text-white text-[10px] font-bold uppercase tracking-widest">
                            <i class="fas fa-balance-scale mr-1 text-teal"></i> <span data-i18n="legal_badge_1">Compliance 360°</span>
                        </span>
                        <span class="text-xs font-bold text-gray-500 uppercase tracking-widest border border-gray-200 px-2 py-1 rounded" data-i18n="legal_badge_2">
                            Derecho Sanitario & Normatividad
                        </span>
                    </div>
                    <h2 class="text-3xl font-heading font-bold text-navy" data-i18n="legal_title">
                        Blindaje Normativo: <span class="text-teal">STPS • COFEPRIS • SEMARNAT</span>
                    </h2>
                    <p class="mt-4 text-gray-600 leading-relaxed text-justify hyphens-auto" data-i18n="legal_desc">
                        La fiscalización digital es ahora integral. Mi consultoría unifica la gestión de seguridad laboral, responsabilidad sanitaria y cumplimiento ambiental, asegurando que tu operación resista auditorías cruzadas y el nuevo escrutinio del <strong>SIQAL</strong>.
                    </p>
                </div>
                <!-- Botón de llamada a la acción sutil -->
                <a href="#contact" class="hidden md:flex items-center gap-2 text-sm font-bold text-navy hover:text-teal transition-colors group border-b-2 border-transparent hover:border-teal pb-1">
                    <span data-i18n="legal_audit_link">Auditar mi cumplimiento</span> <i class="fas fa-arrow-right group-hover:translate-x-1 transition-transform"></i>
                </a>
            </div>

            <!-- Grid de Soluciones de Blindaje -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                
                <!-- Card 1: STPS (Laboral) -->
                <div class="group bg-white p-6 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-all hover:border-orange-500 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-16 h-16 bg-orange-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                    <div class="w-12 h-12 bg-slate-50 rounded-lg flex items-center justify-center mb-4 text-navy group-hover:bg-navy group-hover:text-white transition-colors">
                        <i class="fas fa-helmet-safety text-xl"></i>
                    </div>
                    <h3 class="font-heading font-bold text-lg text-navy mb-2" data-i18n="legal_card1_title">STPS & SIQAL</h3>
                    <p class="text-sm text-gray-500 mb-4 text-justify hyphens-auto" data-i18n="legal_card1_desc">
                        Gestión estratégica de <strong>Comisiones de Seguridad e Higiene</strong> como primer nivel de defensa. Atención experta a inspecciones del <strong>SIQAL</strong> y cumplimiento de NOMs críticas (030, 035, 036) para blindar la operación ante multas.
                    </p>
                    <div class="flex gap-2 text-[10px] font-bold uppercase text-gray-400">
                        <span class="bg-gray-100 px-2 py-1 rounded">NOM-030</span>
                        <span class="bg-gray-100 px-2 py-1 rounded">NOM-035</span>
                        <span class="bg-gray-100 px-2 py-1 rounded">SIQAL</span>
                    </div>
                </div>

                <!-- Card 2: COFEPRIS (Sanitario & Datos) -->
                <div class="group bg-white p-6 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-all hover:border-teal relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-16 h-16 bg-teal/5 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                    <div class="w-12 h-12 bg-slate-50 rounded-lg flex items-center justify-center mb-4 text-navy group-hover:bg-teal group-hover:text-white transition-colors">
                        <i class="fas fa-hospital-user text-xl"></i>
                    </div>
                    <h3 class="font-heading font-bold text-lg text-navy mb-2" data-i18n="legal_card2_title">COFEPRIS & Datos Personales</h3>
                    <p class="text-sm text-gray-500 mb-4 text-justify hyphens-auto" data-i18n="legal_card2_desc">
                        Gestión de Avisos de Funcionamiento y Licencias Sanitarias. Validación del Expediente Clínico (NOM-004) y cumplimiento estricto de la <strong>Ley Federal de Protección de Datos Personales (LFPDPPP)</strong> para el manejo seguro de información sensible de pacientes.
                    </p>
                    <div class="flex gap-2 text-[10px] font-bold uppercase text-gray-400">
                        <span class="bg-gray-100 px-2 py-1 rounded" data-i18n="legal_badge_avisos">Avisos</span>
                        <span class="bg-gray-100 px-2 py-1 rounded">LFPDPPP</span>
                    </div>
                </div>

                <!-- Card 3: SEMARNAT (Ambiental) -->
                <div class="group bg-white p-6 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-all hover:border-green-500 relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-16 h-16 bg-green-50 rounded-bl-full -mr-4 -mt-4 transition-transform group-hover:scale-110"></div>
                    <div class="w-12 h-12 bg-slate-50 rounded-lg flex items-center justify-center mb-4 text-navy group-hover:bg-green-600 group-hover:text-white transition-colors">
                        <i class="fas fa-recycle text-xl"></i>
                    </div>
                    <h3 class="font-heading font-bold text-lg text-navy mb-2" data-i18n="legal_card3_title">SEMARNAT (RPBI)</h3>
                    <p class="text-sm text-gray-500 mb-4 text-justify hyphens-auto" data-i18n="legal_card3_desc">
                        Gestión ambiental de la unidad médica. Clasificación, manejo y disposición final de Residuos Peligrosos Biológico-Infecciosos (NOM-087-ECOL-SSA1) y planes de manejo de residuos especiales.
                    </p>
                    <div class="flex gap-2 text-[10px] font-bold uppercase text-gray-400">
                        <span class="bg-gray-100 px-2 py-1 rounded">RPBI</span>
                        <span class="bg-gray-100 px-2 py-1 rounded">NOM-087</span>
                    </div>
                </div>

            </div>
        </div>
    </section>

    <!-- SECTION: BUSINESS INTELLIGENCE (OPTIMIZADO E INTERACTIVO) -->
    <section id="bi" class="py-24 bg-slate relative">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <!-- Header Sección BI -->
            <div class="text-center mb-12">
                <div class="flex items-center justify-center gap-2 mb-4">
                    <i class="fas fa-chart-line text-sky"></i>
                    <span class="text-sm font-bold text-gray-500 uppercase tracking-wide" data-i18n="bi_tag">Inteligencia de Datos</span>
                </div>
                <h2 class="text-3xl lg:text-4xl font-heading font-bold text-navy mb-6" data-i18n="bi_title">
                    Decisiones basadas en datos. <br>
                    <span class="text-sky">No en suposiciones.</span>
                </h2>
                <p class="text-gray-600 max-w-2xl mx-auto leading-relaxed" data-i18n="bi_desc">
                    Interactúa con este simulador real para ver cómo transformo indicadores médicos en decisiones financieras y operativas.
                </p>
            </div>

            <!-- DASHBOARD CONTAINER -->
            <div class="bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden flex flex-col md:flex-row min-h-[750px]">
                
                <!-- SIDEBAR -->
                <div class="w-full md:w-64 bg-navy text-white p-6 flex flex-col">
                    <div class="mb-10 flex items-center gap-3 px-2">
                        <!-- LOGO OFICIAL DEL PORTAFOLIO -->
                        <img src="https://drive.google.com/thumbnail?id=1oqMOYFDdIc47CKLMa3xCSSvptH9aJyeC&sz=w200" alt="Logo" class="h-10 w-auto bg-white rounded p-1" referrerpolicy="no-referrer">
                        <div>
                            <span class="font-heading font-bold text-lg tracking-wide block">DR. HAN</span>
                            <span class="text-[10px] text-teal tracking-wider uppercase">Analytics</span>
                        </div>
                    </div>

                    <nav class="space-y-2 flex-1">
                        <button onclick="switchDashTab('general')" id="tab-general" class="dash-sidebar-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg active text-left">
                            <i class="fas fa-chart-pie w-5"></i>
                            <span class="font-medium text-sm" data-i18n="bi_btn_general">Dashboard General</span>
                        </button>
                        <button onclick="switchDashTab('nom035')" id="tab-nom035" class="dash-sidebar-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 text-left">
                            <i class="fas fa-brain w-5"></i>
                            <span class="font-medium text-sm" data-i18n="bi_btn_035">Psicosocial NOM-035</span>
                        </button>
                        <button onclick="switchDashTab('riesgos')" id="tab-riesgos" class="dash-sidebar-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 text-left">
                            <i class="fas fa-people-carry-box w-5"></i>
                            <span class="font-medium text-sm" data-i18n="bi_btn_036">Ergonomía NOM-036</span>
                        </button>
                        <!-- NUEVO BOTÓN ISO 45001 -->
                         <button onclick="switchDashTab('iso45001')" id="tab-iso45001" class="dash-sidebar-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 text-left">
                            <i class="fas fa-clipboard-check w-5"></i>
                            <span class="font-medium text-sm" data-i18n="bi_btn_iso">Gestión ISO 45001</span>
                        </button>
                        <button onclick="switchDashTab('wellness')" id="tab-wellness" class="dash-sidebar-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 text-left">
                            <i class="fas fa-heart-pulse w-5"></i>
                            <span class="font-medium text-sm" data-i18n="bi_btn_wellness">Wellness & ROI</span>
                        </button>
                    </nav>

                    <div class="mt-auto pt-6 border-t border-gray-700">
                        <div class="flex items-center space-x-3">
                            <img src="https://drive.google.com/thumbnail?id=1VWqk33PEasus2aWjckWVViojvVw-cajS&sz=w200" alt="Dr. Han" class="w-8 h-8 rounded-full object-cover border border-teal" referrerpolicy="no-referrer">
                            <div>
                                <p class="text-xs font-bold text-white">Dr. Edgar Bañuelos</p>
                                <p class="text-[9px] text-gray-400">Admin EHS</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- MAIN DASHBOARD CONTENT -->
                <div class="flex-1 bg-slate-50 p-6 md:p-8 overflow-y-auto">
                    
                    <!-- Top Controls -->
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                        <div>
                            <h3 class="text-xl font-heading font-bold text-navy" id="dash-title" data-i18n="dash_header_title">Centro de Comando Estratégico</h3>
                            <p class="text-gray-400 text-xs mt-1" data-i18n="dash_header_status">Status: En línea • Datos actualizados</p>
                        </div>
                        <div class="flex items-center space-x-3">
                            <!-- Toggle Dr Han -->
                            <div class="flex items-center gap-4 bg-white p-2 rounded-lg shadow-sm border border-gray-200 mr-2">
                                <div class="text-right hidden sm:block">
                                    <span class="block text-[10px] font-bold text-gray-400 uppercase tracking-wide" data-i18n="dash_toggle_label">Estrategia</span>
                                    <span id="strategy-label" class="text-xs font-bold text-teal transition-colors">Con Gestión Dr. Han</span>
                                </div>
                                <div class="relative inline-block w-12 mr-2 align-middle select-none transition duration-200 ease-in">
                                    <input type="checkbox" name="toggle" id="han-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer border-gray-300" checked/>
                                    <label for="han-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                                </div>
                            </div>

                            <!-- Filtro administrativo actualizado -->
                            <select id="deptFilter" onchange="updateCharts()" class="bg-white border border-gray-200 text-navy text-sm rounded-lg focus:ring-teal focus:border-teal block w-full p-2.5 shadow-sm font-medium">
                                <option value="all">Global (Todos)</option>
                                <option value="rh">Recursos Humanos</option>
                                <option value="fin">Finanzas & Admin</option>
                                <option value="ti">Tecnología (TI)</option>
                                <option value="com">Comercial / Ventas</option>
                            </select>
                        </div>
                    </div>

                    <!-- VIEW: GENERAL -->
                    <div id="view-general" class="dash-view animate-fade-in">
                        <!-- KPIs -->
                        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 mb-8">
                            <div class="kpi-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden group">
                                <div class="absolute top-0 left-0 w-full h-1 bg-red-500"></div>
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="kpi_days">Días Incapacidad</span>
                                    <div class="w-8 h-8 rounded-lg bg-red-50 flex items-center justify-center text-red-500"><i class="fas fa-bed-pulse"></i></div>
                                </div>
                                <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-days">42</h4>
                                <span class="text-green-600 text-xs font-bold flex items-center"><i class="fas fa-arrow-down mr-1"></i>12% vs año ant</span>
                            </div>
                            <div class="kpi-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden group">
                                <div class="absolute top-0 left-0 w-full h-1 bg-teal"></div>
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="kpi_iso">Cumplimiento ISO</span>
                                    <div class="w-8 h-8 rounded-lg bg-teal/10 flex items-center justify-center text-teal"><i class="fas fa-check-circle"></i></div>
                                </div>
                                <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-compliance">98%</h4>
                                <span class="text-teal text-xs font-bold flex items-center">Audit Ready</span>
                            </div>
                             <div class="kpi-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden group">
                                <div class="absolute top-0 left-0 w-full h-1 bg-sky"></div>
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="kpi_risk">Prima de Riesgo</span>
                                    <div class="w-8 h-8 rounded-lg bg-sky/10 flex items-center justify-center text-sky"><i class="fas fa-chart-line"></i></div>
                                </div>
                                <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-risk">0.55</h4>
                                <span class="text-green-600 text-xs font-bold flex items-center"><i class="fas fa-arrow-down mr-1"></i> Optimizado</span>
                            </div>
                            <div class="kpi-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden group">
                                <div class="absolute top-0 left-0 w-full h-1 bg-orange-400"></div>
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="kpi_cost">Costo Siniestralidad</span>
                                    <div class="w-8 h-8 rounded-lg bg-orange-50 flex items-center justify-center text-orange-500"><i class="fas fa-sack-dollar"></i></div>
                                </div>
                                <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-cost">$35k</h4>
                                <span class="text-green-600 text-xs font-bold flex items-center">Bajo Presupuesto</span>
                            </div>
                        </div>

                        <!-- Main Trend Chart -->
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 mb-8">
                            <h5 class="font-bold text-navy mb-4 text-sm flex items-center">
                                <i class="fas fa-chart-area text-sky mr-2"></i> <span data-i18n="chart_trend_title">Tendencia de Incidencias vs Costos</span>
                            </h5>
                            <div class="h-64 w-full">
                                <canvas id="trendChart"></canvas>
                            </div>
                        </div>

                        <!-- Distribución -->
                        <div class="grid lg:grid-cols-2 gap-6">
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h5 class="font-bold text-navy mb-4 text-sm flex items-center">
                                    <i class="fas fa-building text-teal mr-2"></i> <span data-i18n="chart_dist_title">Distribución por Departamento</span>
                                </h5>
                                <div class="h-64 w-full flex items-center justify-center">
                                    <canvas id="deptChart"></canvas>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h5 class="font-bold text-navy mb-4 text-sm flex items-center">
                                    <i class="fas fa-id-card text-indigo-500 mr-2"></i> <span data-i18n="chart_job_title">Incidencias por Puesto</span>
                                </h5>
                                <div class="h-64 w-full">
                                    <canvas id="jobChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: PSICOSOCIAL NOM-035 -->
                    <div id="view-nom035" class="dash-view hidden animate-fade-in">
                         <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm mb-8 flex flex-col md:flex-row justify-between items-center gap-6">
                            <div class="flex-1 w-full">
                                <div class="flex justify-between items-end mb-2">
                                    <div>
                                        <h4 class="text-lg font-heading font-bold text-navy" data-i18n="nom035_goal_title">Objetivo de Cumplimiento NOM-035</h4>
                                        <p class="text-xs text-gray-500" data-i18n="nom035_goal_desc">Avance global de implementación</p>
                                    </div>
                                    <span class="text-2xl font-bold text-indigo-600" id="kpi-035-progress">92%</span>
                                </div>
                                <div class="w-full bg-gray-100 rounded-full h-3">
                                    <div class="bg-indigo-600 h-3 rounded-full" style="width: 92%" id="progress-bar-035"></div>
                                </div>
                            </div>
                            <div class="flex items-center gap-4 border-l border-gray-100 pl-6">
                                <div class="text-right">
                                    <p class="text-2xl font-bold text-red-500" id="kpi-035-ats">3</p>
                                    <p class="text-[10px] font-bold text-gray-400 uppercase" data-i18n="nom035_ats_cases">Casos ATS Activos</p>
                                </div>
                                <div class="w-10 h-10 rounded-full bg-red-50 flex items-center justify-center text-red-500"><i class="fas fa-user-nurse"></i></div>
                            </div>
                        </div>
                        <div class="grid lg:grid-cols-2 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h5 class="font-bold text-navy mb-4 text-sm flex items-center"><i class="fas fa-project-diagram text-indigo-500 mr-2"></i> <span data-i18n="nom035_radar">Dominios de Riesgo (Radar)</span></h5>
                                <div class="h-72 w-full flex items-center justify-center"><canvas id="nom035RadarChart"></canvas></div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h5 class="font-bold text-navy mb-4 text-sm flex items-center"><i class="fas fa-users text-teal mr-2"></i> <span data-i18n="nom035_pie">Nivel de Riesgo Poblacional</span></h5>
                                <div class="h-72 w-full flex items-center justify-center"><canvas id="nom035PieChart"></canvas></div>
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: ERGONOMÍA NOM-036 -->
                    <div id="view-riesgos" class="dash-view hidden animate-fade-in">
                        <!-- Top KPIs (NOM-036) -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                            <div class="kpi-card bg-white p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col justify-between h-full">
                                <div>
                                    <div class="flex justify-between items-start mb-3">
                                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="ergo_kpi_comp">Cumplimiento</span>
                                        <div class="w-8 h-8 rounded-lg bg-teal/10 flex items-center justify-center text-teal"><i class="fas fa-shield-check"></i></div>
                                    </div>
                                    <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-ergo-comp">92%</h4>
                                </div>
                                <span class="text-xs text-teal font-bold bg-teal/5 py-1 px-2 rounded w-fit mt-2" id="kpi-ergo-comp-text">Audit Ready</span>
                            </div>
                            <div class="kpi-card bg-white p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col justify-between h-full">
                                <div>
                                    <div class="flex justify-between items-start mb-3">
                                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="ergo_kpi_save">Ahorro TME</span>
                                        <div class="w-8 h-8 rounded-lg bg-green-50 flex items-center justify-center text-green-600"><i class="fas fa-sack-dollar"></i></div>
                                    </div>
                                    <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-ergo-save">$550k</h4>
                                </div>
                                <span class="text-xs text-green-600 font-bold bg-green-50 py-1 px-2 rounded w-fit mt-2">-3 Incapacidades</span>
                            </div>
                            <div class="kpi-card bg-white p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col justify-between h-full">
                                <div>
                                    <div class="flex justify-between items-start mb-3">
                                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="ergo_kpi_staff">Personal Expuesto</span>
                                        <div class="w-8 h-8 rounded-lg bg-blue-50 flex items-center justify-center text-blue-500"><i class="fas fa-users"></i></div>
                                    </div>
                                    <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-ergo-staff">45</h4>
                                </div>
                                <span class="text-xs text-gray-500 mt-2">15% de Plantilla</span>
                            </div>
                            <div class="kpi-card bg-white p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col justify-between h-full">
                                <div>
                                    <div class="flex justify-between items-start mb-3">
                                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="ergo_kpi_fatigue">Riesgo Fatiga</span>
                                        <div class="w-8 h-8 rounded-lg bg-red-50 flex items-center justify-center text-red-500"><i class="fas fa-triangle-exclamation"></i></div>
                                    </div>
                                    <h4 class="text-xl font-heading font-bold text-red-500 mb-1 mt-1" id="kpi-ergo-fatigue">ALTO</h4>
                                </div>
                                <span class="text-xs text-gray-500 mt-2">Almacén Turno C</span>
                            </div>
                        </div>

                        <!-- ESTACIÓN DE TRABAJO DE ERGONOMÍA (SIMULADOR Y VISUALIZADOR) -->
                        <div class="grid lg:grid-cols-12 gap-6 mb-8">
                             <!-- 1. PANEL DE CONTROL (IZQUIERDA) -->
                            <div class="lg:col-span-6 bg-navy text-white p-6 rounded-xl shadow-xl relative overflow-hidden flex flex-col border border-gray-800 h-full">
                                <!-- Fondo decorativo -->
                                <div class="absolute top-0 right-0 w-64 h-64 bg-teal/10 rounded-full blur-3xl -mr-10 -mt-10 pointer-events-none"></div>
                                
                                <div class="relative z-10 flex flex-col h-full">
                                    <div class="flex items-center justify-between mb-6">
                                        <h3 class="font-heading font-bold text-lg flex items-center gap-2 text-white">
                                            <i class="fas fa-sliders text-teal"></i> <span data-i18n="sim_panel_title">Panel de Variables</span>
                                        </h3>
                                        <!-- METHOD SELECTOR -->
                                        <select id="sim-method-select" class="bg-white border border-gray-300 text-gray-900 text-[10px] px-3 py-1.5 rounded font-bold outline-none focus:ring-2 focus:ring-teal cursor-pointer uppercase shadow-sm">
                                            <option value="nom036">NOM-036-1 (MAC)</option>
                                            <option value="reba">REBA (Cuerpo)</option>
                                            <option value="rula">RULA (Superior)</option>
                                        </select>
                                    </div>
                                    
                                    <!-- INPUTS SCROLLABLE AREA -->
                                    <div class="flex-1 overflow-y-auto pr-1 custom-scrollbar space-y-5">
                                        <!-- (Inputs sin cambios) -->
                                        <div id="inputs-nom036" class="method-inputs">
                                            <!-- 1. Peso y Frecuencia -->
                                            <div class="bg-slate-800/50 p-4 rounded-lg border border-white/5">
                                                <div class="flex justify-between mb-3 text-xs items-center">
                                                    <span class="text-gray-300 font-bold uppercase tracking-wide" data-i18n="sim_load">1. Carga Física</span>
                                                    <span class="font-mono font-bold text-teal bg-teal/10 px-2 py-0.5 rounded" id="sim-weight-val">20 kg</span>
                                                </div>
                                                <input type="range" min="2" max="50" value="20" id="sim-weight" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-teal hover:accent-teal-400 mb-4">
                                                
                                                <div class="grid grid-cols-3 gap-2">
                                                    <button class="sim-btn-freq flex flex-col items-center justify-center py-2.5 rounded-lg transition-all duration-300 border shadow-lg scale-[1.02] bg-teal border-teal text-white shadow-teal-500/20" data-val="low">
                                                        <span class="text-[10px] font-bold">Baja</span>
                                                        <span class="text-[8px] opacity-80">1/5 min</span>
                                                    </button>
                                                    <button class="sim-btn-freq flex flex-col items-center justify-center py-2.5 rounded-lg transition-all duration-300 border border-slate-700 bg-slate-800/50 text-gray-400 hover:bg-slate-700 hover:text-white" data-val="med">
                                                        <span class="text-[10px] font-bold">Media</span>
                                                        <span class="text-[8px] opacity-60">1/min</span>
                                                    </button>
                                                    <button class="sim-btn-freq flex flex-col items-center justify-center py-2.5 rounded-lg transition-all duration-300 border border-slate-700 bg-slate-800/50 text-gray-400 hover:bg-slate-700 hover:text-white" data-val="high">
                                                        <span class="text-[10px] font-bold">Alta</span>
                                                        <span class="text-[8px] opacity-60">>5/min</span>
                                                    </button>
                                                </div>
                                            </div>

                                            <!-- Modificadores -->
                                            <div class="space-y-3">
                                                <div>
                                                     <label class="text-gray-400 text-[10px] font-bold uppercase tracking-wider block mb-1" data-i18n="sim_hdist">2. Distancia Horizontal</label>
                                                     <select id="sim-h-dist" class="w-full bg-white text-gray-900 text-xs py-2.5 px-3 rounded-lg border border-gray-300 outline-none focus:ring-2 focus:ring-teal">
                                                          <option value="close">Cerca (Codos pegados)</option>
                                                          <option value="med">Media (Antebrazo)</option>
                                                          <option value="far">Lejos (Brazo extendido)</option>
                                                     </select>
                                                </div>
                                                <div>
                                                     <label class="text-gray-400 text-[10px] font-bold uppercase tracking-wider block mb-1" data-i18n="sim_vpos">3. Posición Vertical</label>
                                                     <select id="sim-v-pos" class="w-full bg-white text-gray-900 text-xs py-2.5 px-3 rounded-lg border border-gray-300 outline-none focus:ring-2 focus:ring-teal">
                                                          <option value="ideal">Nudillos (Ideal 75cm)</option>
                                                          <option value="bad">Hombros / Rodillas</option>
                                                          <option value="crit">Suelo / Cabeza</option>
                                                     </select>
                                                </div>
                                                <div class="grid grid-cols-2 gap-3">
                                                    <div>
                                                         <label class="text-gray-400 text-[10px] font-bold uppercase tracking-wider block mb-1" data-i18n="sim_twist">4. Torsión</label>
                                                         <div class="flex bg-slate-800/50 rounded-lg p-1 border border-slate-700">
                                                             <label class="cursor-pointer flex-1 text-center">
                                                                 <input type="radio" name="sim-twist" value="no" checked class="peer sr-only">
                                                                 <div class="text-[10px] py-1.5 rounded text-gray-400 peer-checked:bg-teal peer-checked:text-white font-bold transition-colors">0°</div>
                                                             </label>
                                                             <label class="cursor-pointer flex-1 text-center">
                                                                 <input type="radio" name="sim-twist" value="45" class="peer sr-only">
                                                                 <div class="text-[10px] py-1.5 rounded text-gray-400 peer-checked:bg-orange-500 peer-checked:text-white font-bold transition-colors">45°</div>
                                                             </label>
                                                             <label class="cursor-pointer flex-1 text-center">
                                                                 <input type="radio" name="sim-twist" value="90" class="peer sr-only">
                                                                 <div class="text-[10px] py-1.5 rounded text-gray-400 peer-checked:bg-red-500 peer-checked:text-white font-bold transition-colors">90°</div>
                                                             </label>
                                                         </div>
                                                    </div>
                                                    <div>
                                                         <label class="text-gray-400 text-[10px] font-bold uppercase tracking-wider block mb-1" data-i18n="sim_grip">5. Agarre</label>
                                                         <select id="sim-grip" class="w-full bg-white text-gray-900 text-xs py-2 px-3 rounded-lg border border-gray-300 outline-none focus:ring-2 focus:ring-teal">
                                                              <option value="good">Bueno</option>
                                                              <option value="fair">Regular</option>
                                                              <option value="poor">Malo</option>
                                                         </select>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <!-- (REBA y RULA igual que antes...) -->
                                        <div id="inputs-reba" class="method-inputs hidden space-y-4">
                                            <!-- ... (Contenido REBA) ... -->
                                             <div><label class="text-gray-300 text-xs font-bold uppercase tracking-wide block mb-1">A. Cuello y Tronco</label><select id="reba-trunk" class="w-full bg-white text-gray-900 text-xs py-2.5 px-3 rounded-lg border border-gray-300 outline-none focus:ring-2 focus:ring-teal"><option value="1">Erguido / Neutro</option><option value="2">Flexión Leve (0-20°)</option><option value="3">Flexión Media (20-60°)</option><option value="4">Flexión Severa (>60°)</option></select></div>
                                             <div><label class="text-gray-300 text-xs font-bold uppercase tracking-wide block mb-1">B. Piernas</label><select id="reba-legs" class="w-full bg-white text-gray-900 text-xs py-2.5 px-3 rounded-lg border border-gray-300 outline-none focus:ring-2 focus:ring-teal"><option value="1">Soporte Bilateral (Estable)</option><option value="2">Soporte Unilateral / Inestable</option></select></div>
                                             <div><label class="text-gray-300 text-xs font-bold uppercase tracking-wide block mb-1">C. Carga / Fuerza</label><select id="reba-load" class="w-full bg-white text-gray-900 text-xs py-2.5 px-3 rounded-lg border border-gray-300 outline-none focus:ring-2 focus:ring-teal"><option value="0">&lt; 5 Kg</option><option value="1">5 - 10 Kg</option><option value="2">&gt; 10 Kg</option></select></div>
                                             <div class="bg-slate-800/30 p-3 rounded-lg border border-white/5 hover:bg-slate-800/50 transition-colors"><label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" id="reba-twist" class="w-5 h-5 text-teal rounded bg-slate-700 border-slate-600 focus:ring-teal cursor-pointer"><span class="text-xs text-gray-300">¿Existe Torsión lateral del tronco?</span></label></div>
                                        </div>
                                        <div id="inputs-rula" class="method-inputs hidden space-y-4">
                                            <!-- ... (Contenido RULA) ... -->
                                            <div><label class="text-gray-300 text-xs font-bold uppercase tracking-wide block mb-1">A. Brazo (Hombro)</label><select id="rula-arm" class="w-full bg-white text-gray-900 text-xs py-2.5 px-3 rounded-lg border border-gray-300 outline-none focus:ring-2 focus:ring-teal"><option value="1">Neutro / Relajado</option><option value="2">Flexión (20-45°)</option><option value="3">Elevado (>45°)</option><option value="4">Muy Elevado / Extensión</option></select></div>
                                            <div><label class="text-gray-300 text-xs font-bold uppercase tracking-wide block mb-1">B. Antebrazo y Muñeca</label><select id="rula-wrist" class="w-full bg-white text-gray-900 text-xs py-2.5 px-3 rounded-lg border border-gray-300 outline-none focus:ring-2 focus:ring-teal"><option value="1">Neutro (0-15°)</option><option value="2">Desviación Moderada (>15°)</option><option value="3">Desviación Extrema / Giro</option></select></div>
                                            <div><label class="text-gray-300 text-xs font-bold uppercase tracking-wide block mb-1">C. Cuello</label><select id="rula-neck" class="w-full bg-white text-gray-900 text-xs py-2.5 px-3 rounded-lg border border-gray-300 outline-none focus:ring-2 focus:ring-teal"><option value="1">Neutro (0-10°)</option><option value="2">Flexión (10-20°)</option><option value="3">Extensión / Flexión >20°</option></select></div>
                                            <div class="bg-slate-800/30 p-3 rounded-lg border border-white/5 hover:bg-slate-800/50 transition-colors"><label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" id="rula-static" class="w-5 h-5 text-teal rounded bg-slate-700 border-slate-600 focus:ring-teal cursor-pointer"><span class="text-xs text-gray-300">¿Postura estática (>1min) o repetitiva?</span></label></div>
                                        </div>

                                    </div>
                                </div>
                            </div>
                            <!-- 2. VISUALIZADOR DE RESULTADOS (DERECHA) -->
                            <div class="lg:col-span-6 bg-white p-6 rounded-xl shadow-xl border border-gray-200 flex flex-col justify-center items-center text-center relative overflow-hidden h-full">
                                <h4 class="font-bold text-gray-400 text-xs uppercase tracking-widest absolute top-6 left-0 w-full text-center" data-i18n="sim_result_label">Nivel de Riesgo Detectado</h4>
                                <div id="sim-visual-score" class="relative z-10 my-6">
                                    <div class="w-48 h-48 rounded-full border-8 flex items-center justify-center mb-4 transition-all duration-500 ease-out mx-auto bg-gray-50" id="score-circle">
                                        <div>
                                            <span class="text-6xl font-heading font-extrabold block transition-colors" id="score-number">0</span>
                                            <span class="text-xs font-bold uppercase text-gray-400" data-i18n="sim_points">Puntos</span>
                                        </div>
                                    </div>
                                    <h3 class="text-3xl font-heading font-extrabold mb-1 transition-colors" id="score-label">RIESGO BAJO</h3>
                                    <p class="text-sm text-gray-500" data-i18n="sim_eval_pre">Evaluación Preliminar</p>
                                </div>
                                <div class="w-full max-w-sm h-4 bg-gray-100 rounded-full overflow-hidden mt-auto relative">
                                    <div id="risk-fill-bar" class="h-full bg-green-500 transition-all duration-700 ease-out" style="width: 0%"></div>
                                    <div class="absolute top-0 left-1/4 w-0.5 h-full bg-white/50"></div>
                                    <div class="absolute top-0 left-2/4 w-0.5 h-full bg-white/50"></div>
                                    <div class="absolute top-0 left-3/4 w-0.5 h-full bg-white/50"></div>
                                </div>
                                <div class="flex justify-between w-full max-w-sm text-[10px] text-gray-400 mt-2 font-bold uppercase">
                                    <span data-i18n="risk_low">Bajo</span>
                                    <span data-i18n="risk_med">Medio</span>
                                    <span data-i18n="risk_high">Alto</span>
                                    <span data-i18n="risk_crit">Crítico</span>
                                </div>
                            </div>
                        </div>
                        <div class="grid lg:grid-cols-2 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h5 class="font-bold text-navy mb-4 text-sm flex items-center justify-between"><span class="flex items-center"><i class="fas fa-chart-line text-blue-600 mr-2"></i> <span data-i18n="ergo_fin_title">Impacto Financiero ($)</span></span></h5>
                                <div class="h-64 w-full"><canvas id="ergoFinanceChart"></canvas></div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h5 class="font-bold text-navy mb-4 text-sm flex items-center justify-between"><span class="flex items-center"><i class="fas fa-scale-balanced text-purple-600 mr-2"></i> <span data-i18n="ergo_factor_title">Análisis Factorial</span></span></h5>
                                <div class="h-64 w-full flex items-center justify-center"><canvas id="ergoRadarChart"></canvas></div>
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: ISO 45001 (NUEVO E INTERACTIVO) -->
                    <div id="view-iso45001" class="dash-view hidden animate-fade-in">
                        
                        <!-- Top KPIs ISO (Autocalculados) -->
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                            <div class="kpi-card bg-white p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col justify-between relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-blue-50 rounded-bl-full -mr-4 -mt-4"></div>
                                <div>
                                    <div class="flex justify-between items-start mb-3">
                                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="iso_kpi_adherence">Adherencia Global</span>
                                        <div class="w-8 h-8 rounded-lg bg-blue-100 flex items-center justify-center text-blue-600"><i class="fas fa-globe"></i></div>
                                    </div>
                                    <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-iso-adherence">94%</h4>
                                </div>
                                <span class="text-xs text-blue-600 font-bold bg-blue-50 py-1 px-2 rounded w-fit mt-2" data-i18n="iso_status_cert">Certificable</span>
                            </div>
                            <div class="kpi-card bg-white p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col justify-between relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-orange-50 rounded-bl-full -mr-4 -mt-4"></div>
                                <div>
                                    <div class="flex justify-between items-start mb-3">
                                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="iso_kpi_nc">No Conformidades</span>
                                        <div class="w-8 h-8 rounded-lg bg-orange-100 flex items-center justify-center text-orange-500"><i class="fas fa-triangle-exclamation"></i></div>
                                    </div>
                                    <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-iso-nc">0</h4>
                                </div>
                                <span class="text-xs text-gray-500 mt-2" data-i18n="iso_nc_desc">Mayores (Críticas)</span>
                            </div>
                            <div class="kpi-card bg-white p-6 rounded-xl border border-gray-100 shadow-sm flex flex-col justify-between relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-teal/5 rounded-bl-full -mr-4 -mt-4"></div>
                                <div>
                                    <div class="flex justify-between items-start mb-3">
                                        <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="iso_kpi_review">Rev. por Dirección</span>
                                        <div class="w-8 h-8 rounded-lg bg-teal/10 flex items-center justify-center text-teal"><i class="fas fa-check-double"></i></div>
                                    </div>
                                    <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-iso-review">OK</h4>
                                </div>
                                <span class="text-xs text-teal font-bold bg-teal/5 py-1 px-2 rounded w-fit mt-2">Q2-2026</span>
                            </div>
                        </div>

                        <!-- Panel de Control y Visualización -->
                        <div class="grid lg:grid-cols-12 gap-6 mb-8">
                            
                            <!-- 1. SIMULADOR DE AUDITORÍA (Inputs Editables) -->
                            <div class="lg:col-span-4 bg-navy text-white p-6 rounded-xl shadow-xl border border-gray-800 flex flex-col h-full relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 rounded-full blur-3xl -mr-10 -mt-10 pointer-events-none"></div>
                                <div class="relative z-10 flex flex-col h-full">
                                    <div class="flex items-center justify-between mb-4">
                                        <h3 class="font-heading font-bold text-lg flex items-center gap-2 text-white">
                                            <i class="fas fa-sliders text-blue-400"></i> Panel de Auditoría
                                        </h3>
                                        <span class="text-[10px] uppercase font-bold text-gray-400 border border-gray-600 px-2 py-0.5 rounded">Anexo SL</span>
                                    </div>

                                    <div class="flex-1 overflow-y-auto pr-2 custom-scrollbar space-y-5">
                                        
                                        <!-- SECCIÓN: MADUREZ POR CAPÍTULO -->
                                        <div class="space-y-4">
                                            <div class="border-b border-gray-700 pb-2 mb-2">
                                                <span class="text-[10px] font-bold text-blue-400 uppercase tracking-widest">Nivel de Madurez (General)</span>
                                            </div>
                                            <div>
                                                <div class="flex justify-between text-xs mb-1">
                                                    <label class="text-gray-300 font-bold" data-i18n="iso_input_ctx">4. Contexto</label>
                                                    <span class="text-blue-400 font-mono font-bold" id="val-iso-4">100%</span>
                                                </div>
                                                <input type="range" id="iso-in-4" min="0" max="100" value="100" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                                            </div>
                                            <div>
                                                <div class="flex justify-between text-xs mb-1">
                                                    <label class="text-gray-300 font-bold" data-i18n="iso_input_lead">5. Liderazgo</label>
                                                    <span class="text-blue-400 font-mono font-bold" id="val-iso-5">95%</span>
                                                </div>
                                                <input type="range" id="iso-in-5" min="0" max="100" value="95" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                                            </div>
                                            <div>
                                                <div class="flex justify-between text-xs mb-1">
                                                    <label class="text-gray-300 font-bold" data-i18n="iso_input_plan">6. Planificación</label>
                                                    <span class="text-blue-400 font-mono font-bold" id="val-iso-6">90%</span>
                                                </div>
                                                <input type="range" id="iso-in-6" min="0" max="100" value="90" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                                            </div>
                                            <div>
                                                <div class="flex justify-between text-xs mb-1">
                                                    <label class="text-gray-300 font-bold" data-i18n="iso_input_sup">7. Apoyo</label>
                                                    <span class="text-blue-400 font-mono font-bold" id="val-iso-7">92%</span>
                                                </div>
                                                <input type="range" id="iso-in-7" min="0" max="100" value="92" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                                            </div>
                                            <div>
                                                <div class="flex justify-between text-xs mb-1">
                                                    <label class="text-gray-300 font-bold" data-i18n="iso_input_ops">8. Operación</label>
                                                    <span class="text-blue-400 font-mono font-bold" id="val-iso-8">98%</span>
                                                </div>
                                                <input type="range" id="iso-in-8" min="0" max="100" value="98" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                                            </div>
                                            <div>
                                                <div class="flex justify-between text-xs mb-1">
                                                    <label class="text-gray-300 font-bold" data-i18n="iso_input_eval">9. Evaluación</label>
                                                    <span class="text-blue-400 font-mono font-bold" id="val-iso-9">90%</span>
                                                </div>
                                                <input type="range" id="iso-in-9" min="0" max="100" value="90" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                                            </div>
                                            <div>
                                                <div class="flex justify-between text-xs mb-1">
                                                    <label class="text-gray-300 font-bold" data-i18n="iso_input_imp">10. Mejora</label>
                                                    <span class="text-blue-400 font-mono font-bold" id="val-iso-10">88%</span>
                                                </div>
                                                <input type="range" id="iso-in-10" min="0" max="100" value="88" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500">
                                            </div>
                                        </div>

                                        <!-- SECCIÓN: CONTROLES CRÍTICOS (KILLER CLAUSES) -->
                                        <div class="pt-4 border-t border-gray-700 mt-4">
                                            <div class="flex items-center gap-2 mb-3">
                                                <i class="fas fa-shield-halved text-orange-500"></i>
                                                <label class="text-[10px] font-bold text-orange-400 uppercase tracking-widest">Controles Críticos (Pass/Fail)</label>
                                            </div>
                                            
                                            <div class="space-y-3 bg-slate-800/50 p-3 rounded-lg border border-gray-700">
                                                <!-- 5.4 Consulta -->
                                                <div class="flex items-center justify-between group">
                                                    <div class="flex flex-col">
                                                        <span class="text-xs text-gray-200 font-medium">Consulta y Participación</span>
                                                        <span class="text-[9px] text-gray-500">Cláusula 5.4 (Impacta Liderazgo)</span>
                                                    </div>
                                                    <label class="relative inline-flex items-center cursor-pointer">
                                                        <input type="checkbox" id="iso-check-consult" class="sr-only peer" checked>
                                                        <div class="w-9 h-5 bg-gray-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-500"></div>
                                                    </label>
                                                </div>

                                                <!-- 6.1.3 Legal -->
                                                <div class="flex items-center justify-between group">
                                                    <div class="flex flex-col">
                                                        <span class="text-xs text-gray-200 font-medium">Matriz Legal Actualizada</span>
                                                        <span class="text-[9px] text-gray-500">Cláusula 6.1.3 (Impacta Planificación)</span>
                                                    </div>
                                                    <label class="relative inline-flex items-center cursor-pointer">
                                                        <input type="checkbox" id="iso-check-legal" class="sr-only peer" checked>
                                                        <div class="w-9 h-5 bg-gray-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-500"></div>
                                                    </label>
                                                </div>

                                                <!-- 8.2 Emergencias -->
                                                <div class="flex items-center justify-between group">
                                                    <div class="flex flex-col">
                                                        <span class="text-xs text-gray-200 font-medium">Prep. y Respuesta Emergencias</span>
                                                        <span class="text-[9px] text-gray-500">Cláusula 8.2 (Impacta Operación)</span>
                                                    </div>
                                                    <label class="relative inline-flex items-center cursor-pointer">
                                                        <input type="checkbox" id="iso-check-emergency" class="sr-only peer" checked>
                                                        <div class="w-9 h-5 bg-gray-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-500"></div>
                                                    </label>
                                                </div>

                                                <!-- 9.3 Revisión Dirección -->
                                                <div class="flex items-center justify-between group">
                                                    <div class="flex flex-col">
                                                        <span class="text-xs text-gray-200 font-medium">Revisión por la Dirección</span>
                                                        <span class="text-[9px] text-gray-500">Cláusula 9.3 (Impacta Evaluación)</span>
                                                    </div>
                                                    <label class="relative inline-flex items-center cursor-pointer">
                                                        <input type="checkbox" id="iso-check-mgmt" class="sr-only peer" checked>
                                                        <div class="w-9 h-5 bg-gray-600 peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-blue-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-4 after:w-4 after:transition-all peer-checked:bg-blue-500"></div>
                                                    </label>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- SECCIÓN: NO CONFORMIDADES (OPTIMIZADA) -->
                                        <div class="pt-4 border-t border-gray-700 mt-2">
                                            <div class="flex justify-between items-center mb-3">
                                                <div class="flex items-center gap-2">
                                                    <div class="w-2 h-2 rounded-full bg-red-500 animate-pulse" id="nc-pulse-dot" style="display: none;"></div>
                                                    <label class="text-red-400 font-bold uppercase text-[10px] tracking-widest">Hallazgos Mayores</label>
                                                </div>
                                                <span id="nc-status-badge" class="text-[9px] bg-slate-800 text-gray-400 px-2 py-0.5 rounded border border-gray-600 transition-colors">Sin Hallazgos</span>
                                            </div>
                                            
                                            <!-- Visual Counter with Danger styling -->
                                            <div class="flex items-center gap-0 mb-3 bg-slate-900 rounded-lg border border-gray-700 overflow-hidden group transition-colors shadow-inner" id="nc-container">
                                                <button class="w-10 h-10 flex items-center justify-center bg-slate-800 hover:bg-red-500/20 text-white font-bold transition-colors border-r border-gray-700 active:bg-red-500/40" onclick="adjustNC(-1)">
                                                    <i class="fas fa-minus text-xs"></i>
                                                </button>
                                                <div class="flex-1 text-center relative h-10 flex items-center justify-center">
                                                    <input type="number" id="iso-in-nc" value="0" min="0" class="w-full bg-transparent text-center text-white text-xl font-heading font-bold focus:outline-none z-10 relative appearance-none m-0" readonly>
                                                    <div class="absolute inset-0 bg-red-500/0 transition-all duration-300" id="nc-bg-overlay"></div>
                                                </div>
                                                <button class="w-10 h-10 flex items-center justify-center bg-slate-800 hover:bg-red-500/20 text-white font-bold transition-colors border-l border-gray-700 active:bg-red-500/40" onclick="adjustNC(1)">
                                                    <i class="fas fa-plus text-xs"></i>
                                                </button>
                                            </div>

                                            <!-- Quick Triggers (Simulador de Escenarios) -->
                                            <div class="grid grid-cols-2 gap-2">
                                                <button onclick="adjustNC(1)" class="text-[9px] px-2 py-2 rounded border border-red-900/30 bg-red-500/5 text-red-300 hover:bg-red-600 hover:text-white hover:border-red-500 transition-all text-center flex items-center justify-center gap-1 group">
                                                    <i class="fas fa-gavel text-[8px] opacity-50 group-hover:opacity-100"></i> + Incumplimiento Legal
                                                </button>
                                                <button onclick="adjustNC(1)" class="text-[9px] px-2 py-2 rounded border border-red-900/30 bg-red-500/5 text-red-300 hover:bg-red-600 hover:text-white hover:border-red-500 transition-all text-center flex items-center justify-center gap-1 group">
                                                    <i class="fas fa-fire text-[8px] opacity-50 group-hover:opacity-100"></i> + Riesgo Inminente
                                                </button>
                                            </div>
                                            <p class="text-[9px] text-gray-500 mt-2 text-center italic">* Una NC Mayor detiene el proceso de certificación.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- 2. Visualización (Radar y Ciclo) -->
                            <div class="lg:col-span-8 grid grid-rows-2 gap-6">
                                <!-- Radar Chart -->
                                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 relative">
                                    <h5 class="font-bold text-navy mb-4 text-sm flex items-center justify-between">
                                        <span class="flex items-center"><i class="fas fa-project-diagram text-blue-600 mr-2"></i> <span data-i18n="iso_radar_title">Nivel de Madurez (Anexo SL)</span></span>
                                    </h5>
                                    <div class="h-64 w-full flex items-center justify-center">
                                        <canvas id="isoRadarChart"></canvas>
                                    </div>
                                </div>

                                <!-- Ciclo PHVA & Checklist -->
                                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col">
                                    <h5 class="font-bold text-navy mb-4 text-sm flex items-center justify-between">
                                        <span class="flex items-center"><i class="fas fa-rotate text-teal mr-2"></i> <span data-i18n="iso_cycle_title">Ciclo PHVA (PDCA)</span></span>
                                    </h5>
                                    
                                    <div class="flex-1 flex flex-col justify-center space-y-3">
                                        <!-- Plan -->
                                        <div class="flex items-center gap-3">
                                            <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs">P</div>
                                            <div class="flex-1">
                                                <div class="flex justify-between mb-1">
                                                    <span class="text-[10px] font-bold text-gray-500 uppercase" data-i18n="iso_plan">Planificar</span>
                                                    <span class="text-[10px] font-bold text-blue-600" id="phva-p-val">95%</span>
                                                </div>
                                                <div class="w-full bg-gray-100 rounded-full h-1.5"><div id="phva-p-bar" class="bg-blue-500 h-1.5 rounded-full transition-all duration-500" style="width: 95%"></div></div>
                                            </div>
                                        </div>
                                        <!-- Do -->
                                        <div class="flex items-center gap-3">
                                            <div class="w-8 h-8 rounded-full bg-teal/20 text-teal flex items-center justify-center font-bold text-xs">H</div>
                                            <div class="flex-1">
                                                <div class="flex justify-between mb-1">
                                                    <span class="text-[10px] font-bold text-gray-500 uppercase" data-i18n="iso_do">Hacer</span>
                                                    <span class="text-[10px] font-bold text-teal" id="phva-d-val">95%</span>
                                                </div>
                                                <div class="w-full bg-gray-100 rounded-full h-1.5"><div id="phva-d-bar" class="bg-teal h-1.5 rounded-full transition-all duration-500" style="width: 95%"></div></div>
                                            </div>
                                        </div>
                                        <!-- Check -->
                                        <div class="flex items-center gap-3">
                                            <div class="w-8 h-8 rounded-full bg-orange-100 text-orange-500 flex items-center justify-center font-bold text-xs">V</div>
                                            <div class="flex-1">
                                                <div class="flex justify-between mb-1">
                                                    <span class="text-[10px] font-bold text-gray-500 uppercase" data-i18n="iso_check">Verificar</span>
                                                    <span class="text-[10px] font-bold text-orange-500" id="phva-c-val">90%</span>
                                                </div>
                                                <div class="w-full bg-gray-100 rounded-full h-1.5"><div id="phva-c-bar" class="bg-orange-500 h-1.5 rounded-full transition-all duration-500" style="width: 90%"></div></div>
                                            </div>
                                        </div>
                                        <!-- Act -->
                                        <div class="flex items-center gap-3">
                                            <div class="w-8 h-8 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center font-bold text-xs">A</div>
                                            <div class="flex-1">
                                                <div class="flex justify-between mb-1">
                                                    <span class="text-[10px] font-bold text-gray-500 uppercase" data-i18n="iso_act">Actuar</span>
                                                    <span class="text-[10px] font-bold text-purple-600" id="phva-a-val">88%</span>
                                                </div>
                                                <div class="w-full bg-gray-100 rounded-full h-1.5"><div id="phva-a-bar" class="bg-purple-600 h-1.5 rounded-full transition-all duration-500" style="width: 88%"></div></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VIEW: WELLNESS & ROI -->
                    <div id="view-wellness" class="dash-view hidden animate-fade-in">
                         <!-- ... (Contenido Wellness igual que antes) ... -->
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-5 mb-8">
                             <div class="kpi-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm">
                                <h4 class="text-3xl font-heading font-bold text-navy mb-1">8.4/10</h4>
                                <span class="text-xs text-green-600 font-bold" data-i18n="well_kpi_idx">Índice Salud</span>
                            </div>
                            <div class="kpi-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm">
                                <h4 class="text-3xl font-heading font-bold text-navy mb-1">100%</h4>
                                <span class="text-xs text-teal font-bold" data-i18n="well_kpi_comp">Cumplimiento 035</span>
                            </div>
                             <div class="kpi-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm">
                                <h4 class="text-3xl font-heading font-bold text-navy mb-1">18%</h4>
                                <span class="text-xs text-orange-500 font-bold" data-i18n="well_kpi_chronic">Crónicos</span>
                            </div>
                             <div class="kpi-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm">
                                <h4 class="text-3xl font-heading font-bold text-navy mb-1">$1.2M</h4>
                                <span class="text-xs text-green-600 font-bold" data-i18n="well_kpi_roi">ROI Wellness</span>
                            </div>
                        </div>
                        <div class="grid lg:grid-cols-2 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h5 class="font-bold text-navy mb-4 text-sm" data-i18n="well_chart_imc">Distribución IMC</h5>
                                <div class="h-64 w-full flex items-center justify-center"><canvas id="wellnessBMIChart"></canvas></div>
                            </div>
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100">
                                <h5 class="font-bold text-navy mb-4 text-sm" data-i18n="well_chart_path">Top Patologías</h5>
                                <div class="h-64 w-full"><canvas id="wellnessChronicChart"></canvas></div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </section>

     <!-- Documento Oficial / Reporte Ejecutivo (CONECTADO AL SIMULADOR) -->
    <section class="py-16 bg-white border-t border-gray-100" id="reporte-final-section">
        <div class="max-w-4xl mx-auto px-6 sm:px-8 bg-white shadow-xl rounded-none sm:rounded-lg border border-gray-200 min-h-[800px] relative overflow-hidden my-10 print:shadow-none print:border-none transition-all duration-500">
            
            <!-- Marca de agua de fondo -->
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] opacity-[0.03] pointer-events-none z-0">
                <img src="https://drive.google.com/thumbnail?id=1oqMOYFDdIc47CKLMa3xCSSvptH9aJyeC&sz=w200" class="w-full h-full object-contain filter grayscale" alt="Watermark">
            </div>

            <div class="relative z-10 p-8 sm:p-12">
                
                <!-- Header del Reporte -->
                <div class="flex justify-between items-start border-b-2 border-navy pb-6 mb-8">
                    <div>
                        <h6 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1" data-i18n="report_header_tag">Documento Oficial</h6>
                        <h2 class="text-2xl font-heading font-bold text-navy" data-i18n="report_title">Reporte Ejecutivo de Salud Corporativa</h2>
                        <p class="text-sm text-gray-500 mt-1"><span data-i18n="report_meta_period">Periodo: Enero - Junio 2026</span> | <span data-i18n="report_meta_for">Generado para:</span> <span class="font-bold text-navy" data-i18n="report_meta_target">Consejo Directivo</span></p>
                    </div>
                    <img src="https://drive.google.com/thumbnail?id=1oqMOYFDdIc47CKLMa3xCSSvptH9aJyeC&sz=w200" alt="Logo" class="h-12 w-auto" referrerpolicy="no-referrer">
                </div>

                <!-- Resumen Ejecutivo (KPIs Texto) -->
                <div class="grid grid-cols-3 gap-6 mb-10 bg-slate-50 p-6 rounded-lg border border-gray-100">
                    <div class="text-center border-r border-gray-200">
                        <p class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1" data-i18n="rep_kpi_status">Estatus Normativo</p>
                        <p class="text-2xl font-bold text-navy" id="rep-compliance">98%</p>
                        <p class="text-[10px] text-teal font-bold mt-1">Audit Ready (STPS/ISO)</p>
                    </div>
                    <div class="text-center border-r border-gray-200">
                        <p class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1" data-i18n="rep_kpi_fin">Impacto Financiero</p>
                        <p class="text-2xl font-bold text-navy" id="rep-savings">$550k</p>
                        <p class="text-[10px] text-green-600 font-bold mt-1" data-i18n="rep_kpi_fin_sub">Ahorro en prima de riesgo</p>
                    </div>
                    <div class="text-center">
                        <p class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1" data-i18n="rep_kpi_health">Salud Organizacional</p>
                        <p class="text-2xl font-bold text-navy" id="rep-health">8.4/10</p>
                        <p class="text-[10px] text-blue-500 font-bold mt-1" data-i18n="rep_kpi_health_sub">Estabilidad operativa alta</p>
                    </div>
                </div>

                <!-- Cuerpo del Reporte (DINÁMICO) -->
                <div class="space-y-8" id="rep-body-content">
                    <!-- Contenido se llena con JS -->
                </div>
                
                <!-- NUEVO CTA CONTEXTUAL -->
                <div class="mt-8 bg-indigo-50 border border-indigo-200 rounded-lg p-6 flex flex-col md:flex-row items-center justify-between gap-4">
                    <div>
                        <h5 class="font-bold text-navy text-sm" data-i18n="rep_cta_title">¿Su empresa enfrenta estos mismos desafíos?</h5>
                        <p class="text-xs text-gray-600" data-i18n="rep_cta_desc">Puedo implementar este mismo nivel de diagnóstico y solución en sus primeros 90 días.</p>
                    </div>
                    <a href="https://wa.me/525629846164" class="px-5 py-2.5 bg-navy text-white text-xs font-bold rounded shadow hover:bg-teal transition-colors whitespace-nowrap" data-i18n="rep_cta_btn">
                        Agendar Diagnóstico Breve
                    </a>
                </div>

                <!-- Footer del Reporte -->
                <div class="mt-16 pt-8 border-t border-gray-200 flex flex-col md:flex-row justify-between items-center gap-6">
                    <div class="text-xs text-gray-400">
                        <p class="font-mono">ID Documento: DH-REP-2026-001</p>
                        <p data-i18n="rep_footer_conf">Este reporte es confidencial y para uso exclusivo de la dirección.</p>
                    </div>
                    <div class="flex items-center gap-4">
                         <div class="text-right">
                            <p class="font-signature text-3xl text-navy mb-2 transform -rotate-2">Dr. Han</p>
                            <p class="font-bold text-navy text-sm">Dr. Edgar Ivan Bañuelos Han</p>
                            <p class="text-xs text-gray-500" data-i18n="rep_signature_role">Director Médico & Estratega</p>
                            <p class="text-[10px] text-gray-400" data-i18n="rep_signature_id">Céd. Prof. 12210167</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Print Actions -->
            <div class="absolute bottom-6 right-6 flex gap-2 no-print print:hidden z-20">
                 <button class="w-8 h-8 rounded-full bg-gray-100 hover:bg-gray-200 text-gray-600 flex items-center justify-center transition-colors" title="Imprimir"><i class="fas fa-print"></i></button>
                 <button class="w-8 h-8 rounded-full bg-navy hover:bg-teal text-white flex items-center justify-center transition-colors" title="Enviar a Dirección"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </section>

    <!-- NEW SECTION: GEMINI AI SIMULATOR -->
    <section id="ai-simulator" class="py-24 bg-gradient-to-br from-navy to-slate-900 relative text-white overflow-hidden">
        <div class="absolute inset-0 opacity-20">
            <div class="absolute top-10 left-10 w-64 h-64 bg-indigo-500 rounded-full blur-[100px]"></div>
            <div class="absolute bottom-10 right-10 w-96 h-96 bg-teal-500 rounded-full blur-[120px]"></div>
        </div>
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="text-center mb-12">
                <span class="inline-block py-1 px-3 rounded-full bg-indigo-900/50 border border-indigo-500 text-indigo-300 text-xs font-bold tracking-widest mb-4 uppercase">
                    <i class="fas fa-sparkles mr-1"></i> <span data-i18n="ai_badge">Powered by Gemini AI</span>
                </span>
                <h2 class="text-3xl lg:text-4xl font-heading font-bold mb-4" data-i18n="ai_section_title">AI Strategic Simulator</h2>
                <p class="text-gray-300 text-lg max-w-2xl mx-auto text-justify lg:text-center" data-i18n="ai_desc">
                    La tecnología es una extensión de la estrategia. Ingrese un desafío actual y obtenga un pre-análisis basado en datos y cumplimiento.
                </p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-5 gap-8 bg-white/5 backdrop-blur-lg border border-white/10 rounded-2xl p-6 md:p-8 shadow-2xl">
                <div class="md:col-span-2 flex flex-col gap-4">
                    <label for="ai-input" class="text-sm font-bold text-gray-300 uppercase tracking-wide" data-i18n="ai_input_label">Describa un reto</label>
                    <textarea id="ai-input" rows="6" class="w-full bg-navy/50 border border-gray-600 rounded-lg p-4 text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all resize-none text-sm" placeholder="Ej: Nuestra prima de riesgo aumentó un 10% el último año debido a accidentes en almacén. Necesitamos un plan de contención rápido." data-i18n="ai_input_placeholder"></textarea>
                    <button id="ai-generate-btn" class="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-bold rounded-lg shadow-lg shadow-indigo-500/30 transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2">
                        <span data-i18n="ai_btn_generate">Generar estrategia ✨</span>
                    </button>
                    <p class="text-[10px] text-gray-500 text-center italic" data-i18n="ai_disclaimer">Modelo: Gemini 2.5 Flash. Respuesta generada en tiempo real.</p>
                </div>
                <div class="md:col-span-3 bg-white text-gray-800 rounded-lg p-6 relative min-h-[300px] flex flex-col">
                    <div class="border-b border-gray-200 pb-3 mb-4 flex justify-between items-center">
                        <div class="flex items-center gap-2">
                            <div class="w-8 h-8 rounded-full bg-navy flex items-center justify-center text-white text-xs font-bold">DH</div>
                            <span class="font-heading font-bold text-navy text-sm" data-i18n="ai_preview_title">Strategic Report Preview</span>
                        </div>
                        <div id="ai-loader" class="hidden">
                            <div class="flex space-x-1">
                                <div class="w-2 h-2 bg-indigo-500 rounded-full animate-bounce"></div>
                                <div class="w-2 h-2 bg-indigo-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div>
                                <div class="w-2 h-2 bg-indigo-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                            </div>
                        </div>
                    </div>
                    <div id="ai-result" class="text-sm leading-relaxed text-gray-600 flex-1 overflow-y-auto ai-response">
                        <p class="text-gray-400 italic text-center mt-10" data-i18n="ai_waiting_text">"Esperando input estratégico para iniciar análisis..."</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION: TRAYECTORIA -->
    <section id="trayectoria" class="py-24 bg-white">
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8">
            <h2 class="text-3xl font-heading font-bold text-center text-navy mb-16" data-i18n="career_title">Highlights de trayectoria</h2>
            <div class="relative border-l-4 border-gray-100 ml-4 md:ml-0 space-y-12">
                <div class="relative flex flex-col md:flex-row gap-6 md:items-start pl-8 md:pl-0">
                    <div class="absolute -left-[11px] md:relative md:left-auto md:w-1/3 md:text-right md:pr-12 flex flex-col md:items-end">
                        <h4 class="text-lg font-bold text-navy" data-i18n="career_item1_title">Aeroméxico & Logística</h4>
                        <span class="text-sky font-medium text-sm">Occupational Health</span>
                    </div>
                    <div class="hidden md:block w-5 h-5 bg-teal rounded-full border-4 border-white absolute left-1/3 -translate-x-[10px] mt-1 shadow-sm z-10"></div>
                    <div class="md:w-2/3 bg-slate p-6 rounded-lg border border-gray-100">
                        <p class="text-gray-700 leading-relaxed text-justify" data-i18n="career_item1_desc">Gestión estratégica de servicios médicos. Optimización de la aptitud psicofísica y cumplimiento normativo (STPS/SCT).</p>
                    </div>
                </div>
                 <div class="relative flex flex-col md:flex-row gap-6 md:items-start pl-8 md:pl-0">
                    <div class="absolute -left-[11px] md:relative md:left-auto md:w-1/3 md:text-right md:pr-12 flex flex-col md:items-end">
                        <h4 class="text-lg font-bold text-navy" data-i18n="career_item2_title">Strategic Innovation</h4>
                        <span class="text-sky font-medium text-sm">Health Infrastructure</span>
                    </div>
                    <div class="hidden md:block w-5 h-5 bg-navy rounded-full border-4 border-white absolute left-1/3 -translate-x-[10px] mt-1 shadow-sm z-10"></div>
                    <div class="md:w-2/3 bg-slate p-6 rounded-lg border border-gray-100">
                        <p class="text-gray-700 leading-relaxed text-justify" data-i18n="career_item2_desc">Diseño soluciones donde la infraestructura y la salud convergen para generar impacto real, medible y humano.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer id="contact" class="bg-navy text-white pt-20 pb-10 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-3xl lg:text-4xl font-heading font-bold mb-6" data-i18n="footer_title">¿Hablamos de estrategia?</h2>
            <div class="flex flex-col sm:flex-row justify-center gap-4 mb-16">
                <a href="mailto:dr.hanmedical@gmail.com" class="px-8 py-4 bg-white text-navy font-bold rounded hover:bg-gray-100 transition-colors flex items-center justify-center gap-3">
                    <i class="fas fa-envelope"></i> <span data-i18n="footer_btn_email">Correo electrónico</span>
                </a>
                <a href="https://wa.me/525629846164" target="_blank" class="px-8 py-4 bg-whatsapp text-white font-bold rounded hover:bg-green-600 transition-colors flex items-center justify-center gap-3">
                    <i class="fab fa-whatsapp"></i> <span data-i18n="footer_btn_wa">WhatsApp directo</span>
                </a>
                <!-- NUEVO BOTÓN: DESCARGAR CV -->
                <a href="https://drive.google.com/file/d/1zPAhoGCNj7cHVxNoF2MLWUudHTGEP_4-/view?usp=sharing" target="_blank" class="px-8 py-4 bg-slate-700 text-white font-bold rounded hover:bg-slate-600 transition-colors flex items-center justify-center gap-3 border border-slate-600">
                    <i class="fas fa-file-pdf"></i> <span data-i18n="footer_btn_cv">Descargar CV Completo</span>
                </a>
            </div>
            <div class="border-t border-gray-800 pt-10 text-sm text-gray-400">
                <p class="font-heading font-bold text-white text-base">Dr. Han | Strategic Health</p>
                <p class="text-gray-600 pt-4 text-xs" data-i18n="footer_rights">© 2026 Dr. Han Medical. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script>
        // --- GLOBAL STATE ---
        let appState = {
            isDrHanStrategy: true,
            ergoRiskScore: 0,
            ergoRiskLabel: 'BAJO',
            currentMethod: 'NOM-036-1 (MAC)'
        };

        let currentLang = 'es';

        // --- DASHBOARD CHARTS & LOGIC ---
        let trendChartInstance, deptChartInstance, jobChartInstance;
        let nom035RadarChartInstance, nom035PieChartInstance;
        let wellnessBMIChartInstance, wellnessChronicChartInstance;
        // New NOM-036 Instances
        let ergoFinanceChartInstance, ergoRadarChartInstance;
        // NEW ISO 45001 Instances
        let isoRadarChartInstance;

        // Helper to safely create charts
        function createChart(id, config) {
            const ctx = document.getElementById(id);
            if (ctx) {
                return new Chart(ctx, config);
            }
            console.warn(`Canvas with id '${id}' not found. Skipping chart creation.`);
            return null;
        }

        function initDashboard() {
            // 1. GENERAL CHARTS
            trendChartInstance = createChart('trendChart', {
                type: 'line',
                data: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Costos ($)', data: [45000, 38000, 22000, 18000, 15000, 12000],
                        borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.1)', fill: true, tension: 0.4
                    }, {
                        label: 'Incidentes', data: [8, 6, 4, 3, 2, 1],
                        borderColor: '#0ea5e9', backgroundColor: 'rgba(14, 165, 233, 0.1)', fill: true, tension: 0.4, yAxisID: 'y1'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { display: false }, y1: { display: false, position: 'right' }, x: { grid: { display: false } } } }
            });

            deptChartInstance = createChart('deptChart', {
                type: 'doughnut',
                data: { labels: ['RH', 'Finanzas', 'TI', 'Ventas', 'Dirección'], datasets: [{ data: [15, 10, 25, 40, 10], backgroundColor: ['#0d9488', '#facc15', '#6366f1', '#f97316', '#0f172a'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { position: 'right' } } }
            });

            jobChartInstance = createChart('jobChart', {
                type: 'bar',
                data: { labels: ['Analista', 'Ejecutivo', 'Gerente', 'Becario', 'Director'], datasets: [{ label: 'Incidencias', data: [12, 8, 5, 3, 1], backgroundColor: '#0ea5e9', borderRadius: 4 }] },
                options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { grid: { display: false } } } }
            });

            // 2. NOM-035 CHARTS
            nom035RadarChartInstance = createChart('nom035RadarChart', {
                type: 'radar',
                data: {
                    labels: ['Ambiente', 'Carga', 'Jornada', 'Liderazgo', 'Relaciones', 'Violencia'],
                    datasets: [{ label: 'Riesgo', data: [3, 5, 4, 3, 2, 1], backgroundColor: 'rgba(99, 102, 241, 0.2)', borderColor: '#6366f1', pointBackgroundColor: '#6366f1' }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { suggestedMin: 0, suggestedMax: 5 } } }
            });
            nom035PieChartInstance = createChart('nom035PieChart', {
                type: 'pie',
                data: { labels: ['Nulo', 'Bajo', 'Medio', 'Alto', 'Muy Alto'], datasets: [{ data: [15, 45, 25, 10, 5], backgroundColor: ['#22c55e', '#84cc16', '#facc15', '#f97316', '#ef4444'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });

             // 3. NOM-036 CHARTS
            ergoFinanceChartInstance = createChart('ergoFinanceChart', {
                type: 'bar',
                data: {
                    labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
                    datasets: [{
                        label: 'Costo Lesiones ($)', data: [45000, 48000, 52000, 55000, 60000, 68000],
                        backgroundColor: '#ef4444', borderRadius: 4, order: 2
                    }, {
                        type: 'line', label: 'Inversión Ergo ($)', data: [15000, 15000, 20000, 20000, 25000, 25000],
                        borderColor: '#22c55e', borderWidth: 2, fill: false, tension: 0.3, order: 1
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true }, x: { grid: { display: false } } } }
            });

            ergoRadarChartInstance = createChart('ergoRadarChart', {
                type: 'radar',
                data: {
                    labels: ['Peso', 'Postura', 'Frecuencia', 'Duración', 'Distancia', 'Agarre'],
                    datasets: [{
                        label: 'Límite NOM-036', data: [100, 120, 110, 130, 100, 130],
                        borderColor: '#94a3b8', borderDash: [5, 5], fill: false, pointRadius: 0
                    }, {
                        label: 'Actual', data: [130, 90, 140, 80, 70, 110],
                        backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: '#3b82f6', pointBackgroundColor: '#3b82f6'
                    }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { r: { suggestedMin: 0, suggestedMax: 150, ticks: { display: false } } } }
            });
            
             // 4. ISO 45001 CHARTS (NUEVO)
            isoRadarChartInstance = createChart('isoRadarChart', {
                type: 'radar',
                data: {
                    labels: ['4. Contexto', '5. Liderazgo', '6. Planificación', '7. Apoyo', '8. Operación', '9. Evaluación', '10. Mejora'],
                    datasets: [{
                        label: 'Cumplimiento (%)',
                        data: [100, 95, 90, 92, 98, 90, 88], // Default Good Data
                        backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: '#3b82f6', pointBackgroundColor: '#3b82f6'
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    scales: { 
                        r: { 
                            suggestedMin: 0, 
                            suggestedMax: 100,
                             ticks: { stepSize: 20 }
                        } 
                    } 
                }
            });

            // 5. WELLNESS CHARTS
            wellnessBMIChartInstance = createChart('wellnessBMIChart', {
                type: 'doughnut',
                data: { labels: ['Normal', 'Sobrepeso', 'Obesidad G1', 'Obesidad G2'], datasets: [{ data: [45, 30, 15, 10], backgroundColor: ['#0d9488', '#facc15', '#f97316', '#ef4444'], borderWidth: 0 }] },
                options: { responsive: true, maintainAspectRatio: false, cutout: '60%', plugins: { legend: { position: 'right' } } }
            });
            wellnessChronicChartInstance = createChart('wellnessChronicChart', {
                type: 'bar',
                data: { labels: ['Hipertensión', 'Diabetes', 'TME', 'Dislipidemia'], datasets: [{ label: 'Casos', data: [12, 8, 25, 18], backgroundColor: '#0ea5e9', borderRadius: 4 }] },
                options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { grid: { display: false } } } }
            });
            
            // Init Simulator Listeners
            initSimulator();
            
            // Init Strategy Toggle
            initStrategyToggle();
            
            // Init ISO Simulator (NEW)
            initIsoSimulator();
            
            // First Global Update
            updateFinalReport();
        }
        
        // --- HELPER TRANSLATION FUNCTION FOR JS ---
        function t(key) {
             return translations[currentLang][key] || key;
        }

        // --- CENTRAL UPDATE FUNCTION (NEW) ---
        function updateFinalReport() {
            // 1. Determine Base Metrics (Strategy Toggle)
            let metrics = {
                compliance: appState.isDrHanStrategy ? 98 : 65,
                savings: appState.isDrHanStrategy ? 550 : 0, // in k
                health: appState.isDrHanStrategy ? 8.4 : 6.0
            };
            
            // 2. Apply Ergo Risk Modifiers (Interrelation)
            if(appState.ergoRiskLabel.includes('ALTO') || appState.ergoRiskLabel.includes('CRÍTICO')) {
                // High risk penalizes score even if strategy is on
                metrics.health -= 1.2; 
                metrics.savings -= 200; // Potential cost
                if(metrics.savings < 0) metrics.savings = 0;
            } else if (appState.ergoRiskLabel.includes('MEDIO')) {
                metrics.health -= 0.4;
                metrics.savings -= 50;
            }
            
            // Formatting
            let healthStr = metrics.health.toFixed(1) + "/10";
            let savingsStr = "$" + metrics.savings + "k";
            let compStr = metrics.compliance + "%";
            
            // 3. Update DOM Elements
            const domComp = document.getElementById('rep-compliance');
            const domSave = document.getElementById('rep-savings');
            const domHealth = document.getElementById('rep-health');
            
            if(domComp) domComp.innerText = compStr;
            if(domSave) {
                domSave.innerText = savingsStr;
                // Add color indication if negative impact
                if(appState.ergoRiskLabel.includes('ALTO')) {
                   domSave.classList.add('text-red-500');
                   domSave.classList.remove('text-navy');
                } else {
                   domSave.classList.remove('text-red-500');
                   domSave.classList.add('text-navy');
                }
            }
            if(domHealth) domHealth.innerText = healthStr;
            
            // 4. Update Report Text Logic
            const repBody = document.getElementById('rep-body-content');
            let findingText = "";
            let findingTitle = "";
            let findingColor = "";
            
            // Translations for dynamic report
            const rTxt = translations[currentLang];

            if(appState.ergoRiskLabel.includes("BAJO") || appState.ergoRiskLabel.includes("NIVEL 1")) {
                findingTitle = rTxt.rep_finding_opt_title;
                findingText = rTxt.rep_finding_opt_desc;
                findingColor = "bg-green-500";
            } else if (appState.ergoRiskLabel.includes("MEDIO") || appState.ergoRiskLabel.includes("NIVEL 2")) {
                findingTitle = rTxt.rep_finding_warn_title;
                findingText = rTxt.rep_finding_warn_desc;
                findingColor = "bg-yellow-500";
            } else {
                findingTitle = rTxt.rep_finding_crit_title;
                findingText = rTxt.rep_finding_crit_desc;
                findingColor = "bg-red-500";
            }
            
            // Get Specific Recommendation based on Method
            let recText = getRecommendationText(appState.currentMethod, appState.ergoRiskScore, appState.ergoRiskLabel);

             if (repBody) {
                repBody.innerHTML = `
                    <div>
                        <div class="flex justify-between items-center mb-3">
                            <h4 class="text-sm font-bold text-white ${findingColor} inline-block px-3 py-1 rounded">1 ${rTxt.rep_section1_title}</h4>
                            <span class="text-[10px] uppercase font-bold text-gray-400">${rTxt.rep_method_label}: ${appState.currentMethod}</span>
                        </div>
                        <p class="text-sm text-gray-700 leading-relaxed text-justify">
                            <strong>${findingTitle}:</strong> ${findingText} ${rTxt.rep_eval_text} <strong>${appState.ergoRiskLabel}</strong>.
                        </p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div>
                            <h4 class="text-sm font-bold text-white bg-navy inline-block px-3 py-1 rounded mb-3">2 ${rTxt.rep_section2_title}</h4>
                            <div class="bg-slate-50 border-l-4 border-navy p-4 rounded-r-lg">
                                <p class="text-sm text-gray-700 font-medium italic">"${recText}"</p>
                            </div>
                        </div>
                        <div>
                            <h4 class="text-sm font-bold text-white bg-teal inline-block px-3 py-1 rounded mb-3">3 ${rTxt.rep_section3_title}</h4>
                            <ul class="list-disc list-inside text-sm text-gray-700 space-y-2 pl-2">
                                <li>${(appState.ergoRiskLabel.includes('ALTO') || appState.ergoRiskLabel.includes('CRÍTICO')) ? rTxt.rep_strat_high1 : rTxt.rep_strat_low1}</li>
                                <li>${(appState.ergoRiskLabel.includes('ALTO') || appState.ergoRiskLabel.includes('CRÍTICO')) ? rTxt.rep_strat_high2 : rTxt.rep_strat_low2}</li>
                            </ul>
                        </div>
                    </div>
                `;
            }
        }
        
        function getRecommendationText(method, score, label) {
             const rTxt = translations[currentLang];
             let rec = "";
                if(method.includes('NOM')) {
                    if(label.includes('BAJO')) rec = rTxt.rec_nom_low;
                    else if(label.includes('MEDIO')) rec = rTxt.rec_nom_med;
                    else if(label.includes('ALTO')) rec = rTxt.rec_nom_high;
                    else rec = rTxt.rec_nom_crit;
                } else if (method.includes('REBA')) {
                     // Simplified logic for brevity/translation mapping
                    if(score <= 3) rec = rTxt.rec_reba_low;
                    else if(score <= 7) rec = rTxt.rec_reba_med;
                    else rec = rTxt.rec_reba_high;
                } else { // RULA
                    if(score <= 2) rec = rTxt.rec_rula_low;
                    else if(score <= 4) rec = rTxt.rec_rula_med;
                    else rec = rTxt.rec_rula_high;
                }
                return rec;
        }

        // --- NEW FEATURE: STRATEGY TOGGLE ---
        function initStrategyToggle() {
            const toggle = document.getElementById('han-toggle');
            const label = document.getElementById('strategy-label');
            
            const kpiDays = document.getElementById('kpi-days');
            const kpiComp = document.getElementById('kpi-compliance');
            const kpiRisk = document.getElementById('kpi-risk');
            const kpiCost = document.getElementById('kpi-cost');

            // Data Definitions
            const dataBad = { 
                kpiDays: 145, kpiComp: '65%', kpiRisk: 2.85, kpiCost: '$450k', 
                trendCost: [45000, 50000, 55000, 60000, 65000, 72000], trendInc: [8, 9, 11, 12, 14, 16], 
                kpi35Prog: '15%', kpi35Ats: 18, 
                kpiErgoComp: '40%', kpiErgoSave: '$0', kpiErgoStaff: 120, kpiErgoFatigue: 'CRÍTICO'
            };
            const dataGood = { 
                kpiDays: 42, kpiComp: '98%', kpiRisk: 0.55, kpiCost: '$35k', 
                trendCost: [45000, 38000, 22000, 18000, 15000, 12000], trendInc: [8, 6, 4, 3, 2, 1], 
                kpi35Prog: '92%', kpi35Ats: 3, 
                kpiErgoComp: '92%', kpiErgoSave: '$550k', kpiErgoStaff: 45, kpiErgoFatigue: 'ALTO'
            };

            if(toggle) {
                toggle.addEventListener('change', (e) => {
                    const isDrHan = e.target.checked;
                    appState.isDrHanStrategy = isDrHan; // Update Global State
                    const data = isDrHan ? dataGood : dataBad;
                    
                    if(label) {
                        label.innerText = isDrHan ? translations[currentLang].strat_label_on : translations[currentLang].strat_label_off;
                        label.className = `text-xs font-bold transition-colors ${isDrHan ? 'text-teal' : 'text-red-500'}`;
                    }

                    if(kpiDays) kpiDays.innerText = data.kpiDays;
                    if(kpiComp) kpiComp.innerText = data.kpiComp;
                    if(kpiRisk) kpiRisk.innerText = data.kpiRisk;
                    if(kpiCost) kpiCost.innerText = data.kpiCost;

                    document.querySelectorAll('.kpi-card').forEach(card => {
                        if(!isDrHan) card.classList.add('border-red-200', 'bg-red-50');
                        else card.classList.remove('border-red-200', 'bg-red-50');
                    });
                    
                    if(trendChartInstance) {
                        trendChartInstance.data.datasets[0].data = data.trendCost;
                        trendChartInstance.data.datasets[1].data = data.trendInc;
                        trendChartInstance.update();
                    }
                    
                    // Trigger ISO update to reflect "Strategy" toggle impact on sliders/chart
                    setIsoDefaults(isDrHan);

                    // Update Final Report based on new strategy state
                    updateFinalReport();
                });
            }
        }
        
        // --- ISO 45001 SIMULATOR LOGIC (UPDATED WITH CRITICAL CONTROLS) ---
        function initIsoSimulator() {
            // Inputs 4-10
            for(let i=4; i<=10; i++) {
                const el = document.getElementById(`iso-in-${i}`);
                if(el) {
                    el.addEventListener('input', (e) => {
                        // Update text value next to slider
                        document.getElementById(`val-iso-${i}`).innerText = e.target.value + '%';
                        updateIsoRealTime();
                    });
                }
            }
            // Critical Controls Listeners (New Specific Clauses)
            const checks = ['iso-check-consult', 'iso-check-legal', 'iso-check-emergency', 'iso-check-mgmt'];
            checks.forEach(id => {
                const el = document.getElementById(id);
                if(el) el.addEventListener('change', updateIsoRealTime);
            });
        }

        function adjustNC(delta) {
            const input = document.getElementById('iso-in-nc');
            if(input) {
                let val = parseInt(input.value) || 0;
                val += delta;
                if(val < 0) val = 0;
                input.value = val;
                updateIsoRealTime();
            }
        }
        
        function setIsoDefaults(isGood) {
            // Helper to set inputs programmatically when Strategy Toggle changes
            const defaults = isGood ? 
                {4:100, 5:95, 6:90, 7:92, 8:98, 9:90, 10:88, nc:0} : 
                {4:40, 5:40, 6:30, 7:40, 8:50, 9:20, 10:10, nc:12}; // Leadership dropped to 40
            
            for(let i=4; i<=10; i++) {
                const el = document.getElementById(`iso-in-${i}`);
                if(el) {
                    el.value = defaults[i];
                    document.getElementById(`val-iso-${i}`).innerText = defaults[i] + '%';
                }
            }
            // Use adjustNC to handle visual updates correctly instead of direct value set
            const ncInput = document.getElementById('iso-in-nc');
            if(ncInput) {
                ncInput.value = 0; // Reset first
                adjustNC(defaults.nc); // Set new value with visual logic
            }
            
            // Reset critical controls based on strategy
            // If strategy is BAD, critical controls fail
            const checkState = isGood;
            ['iso-check-consult', 'iso-check-legal', 'iso-check-emergency', 'iso-check-mgmt'].forEach(id => {
                const el = document.getElementById(id);
                if(el) el.checked = checkState;
            });
            
            updateIsoRealTime();
        }

        function updateIsoRealTime() {
            // 1. Get Base Maturity Values (Sliders)
            let v4 = parseInt(document.getElementById('iso-in-4').value); // Context
            let v5 = parseInt(document.getElementById('iso-in-5').value); // Leadership
            let v6 = parseInt(document.getElementById('iso-in-6').value); // Planning
            let v7 = parseInt(document.getElementById('iso-in-7').value); // Support
            let v8 = parseInt(document.getElementById('iso-in-8').value); // Operation
            let v9 = parseInt(document.getElementById('iso-in-9').value); // Evaluation
            let v10 = parseInt(document.getElementById('iso-in-10').value); // Improvement
            const nc = parseInt(document.getElementById('iso-in-nc').value);
            
            // 2. Check Critical Controls (Penalties)
            const hasConsult = document.getElementById('iso-check-consult').checked; // 5.4
            const hasLegal = document.getElementById('iso-check-legal').checked;     // 6.1.3
            const hasEmerg = document.getElementById('iso-check-emergency').checked; // 8.2
            const hasMgmt = document.getElementById('iso-check-mgmt').checked;       // 9.3

            // Apply Penalties (Expert Logic: Missing a critical clause caps the chapter score)
            if(!hasConsult) { v5 = Math.min(v5, 50); document.getElementById('val-iso-5').classList.add('text-red-500'); } 
            else { document.getElementById('val-iso-5').classList.remove('text-red-500'); }
            
            if(!hasLegal) { v6 = Math.min(v6, 40); document.getElementById('val-iso-6').classList.add('text-red-500'); } // No legal matrix = Planning fail
            else { document.getElementById('val-iso-6').classList.remove('text-red-500'); }

            if(!hasEmerg) { v8 = Math.min(v8, 60); document.getElementById('val-iso-8').classList.add('text-red-500'); }
            else { document.getElementById('val-iso-8').classList.remove('text-red-500'); }
            
            if(!hasMgmt) { v9 = Math.min(v9, 50); document.getElementById('val-iso-9').classList.add('text-red-500'); }
            else { document.getElementById('val-iso-9').classList.remove('text-red-500'); }

            // Update displayed % values to reflect penalty (Visual Feedback)
            document.getElementById('val-iso-5').innerText = v5 + '%';
            document.getElementById('val-iso-6').innerText = v6 + '%';
            document.getElementById('val-iso-8').innerText = v8 + '%';
            document.getElementById('val-iso-9').innerText = v9 + '%';

            // 3. Calculate Averages for PDCA
            const planAvg = Math.round((v4 + v5 + v6) / 3);
            const doAvg = Math.round((v7 + v8) / 2);
            const checkAvg = v9;
            const actAvg = v10;
            
            const globalAdherence = Math.round((planAvg + doAvg + checkAvg + actAvg) / 4);
            
            // 4. Update DOM KPIs
            const kpiAdh = document.getElementById('kpi-iso-adherence');
            const kpiNc = document.getElementById('kpi-iso-nc');
            const kpiRev = document.getElementById('kpi-iso-review');
            const statusCertText = document.querySelector('[data-i18n="iso_status_cert"]');
            
            // LOGIC OF NC IMPACT
            let isCertifiable = true;
            if (nc > 0) isCertifiable = false;

            // Visual Update for NC Section
            const ncContainer = document.getElementById('nc-container');
            const ncBadge = document.getElementById('nc-status-badge');
            const ncOverlay = document.getElementById('nc-bg-overlay');
            const ncPulse = document.getElementById('nc-pulse-dot');

            if (nc > 0) {
                if(ncContainer) ncContainer.classList.add('border-red-500');
                if(ncBadge) {
                    ncBadge.innerText = "CRÍTICO";
                    ncBadge.className = "text-[9px] bg-red-500 text-white px-2 py-0.5 rounded font-bold shadow-lg shadow-red-500/20";
                }
                if(ncOverlay) ncOverlay.classList.replace('bg-red-500/0', 'bg-red-500/10');
                if(ncPulse) ncPulse.style.display = 'block';
            } else {
                if(ncContainer) ncContainer.classList.remove('border-red-500');
                if(ncBadge) {
                    ncBadge.innerText = "Sin Hallazgos";
                    ncBadge.className = "text-[9px] bg-slate-800 text-gray-400 px-2 py-0.5 rounded border border-gray-600 transition-colors";
                }
                if(ncOverlay) ncOverlay.classList.replace('bg-red-500/10', 'bg-red-500/0');
                if(ncPulse) ncPulse.style.display = 'none';
            }

            // Update KPI Card (Adherence) based on NC
            if(kpiAdh) {
                kpiAdh.innerText = globalAdherence + '%';
                // If there are NCs, turn adherence red even if high score
                kpiAdh.className = `text-3xl font-heading font-bold mb-1 ${(!isCertifiable || globalAdherence < 85) ? 'text-red-500' : 'text-navy'}`;
                
                // Update Status Badge
                if(statusCertText) {
                    if(!isCertifiable) {
                        statusCertText.innerText = "NO CERTIFICABLE";
                        statusCertText.className = "text-xs text-white font-bold bg-red-500 py-1 px-2 rounded w-fit mt-2 shadow-sm";
                    } else if (globalAdherence >= 90) {
                        statusCertText.innerText = "Certificable";
                        statusCertText.className = "text-xs text-blue-600 font-bold bg-blue-50 py-1 px-2 rounded w-fit mt-2";
                    } else {
                        statusCertText.innerText = "Con Brechas";
                        statusCertText.className = "text-xs text-orange-500 font-bold bg-orange-50 py-1 px-2 rounded w-fit mt-2";
                    }
                }
            }

            if(kpiNc) {
                kpiNc.innerText = nc;
                kpiNc.className = `text-3xl font-heading font-bold mb-1 ${nc === 0 ? 'text-navy' : 'text-red-500'}`;
            }
            if(kpiRev) {
                // If Mgmt Review toggle is off or score low
                const revStatus = (hasMgmt && v9 > 80) ? "OK" : "PEND";
                kpiRev.innerText = revStatus;
                kpiRev.className = `text-3xl font-heading font-bold mb-1 ${revStatus === "OK" ? 'text-navy' : 'text-red-500'}`;
            }
            
            // 5. Update Charts (Radar)
            if(isoRadarChartInstance) {
                // If Not Certifiable, visually indicate danger in chart color? 
                // For now, keep data structure
                isoRadarChartInstance.data.datasets[0].data = [v4, v5, v6, v7, v8, v9, v10];
                if(!isCertifiable) {
                    isoRadarChartInstance.data.datasets[0].backgroundColor = 'rgba(239, 68, 68, 0.2)'; // Red
                    isoRadarChartInstance.data.datasets[0].borderColor = '#ef4444';
                } else {
                    isoRadarChartInstance.data.datasets[0].backgroundColor = 'rgba(59, 130, 246, 0.2)'; // Blue
                    isoRadarChartInstance.data.datasets[0].borderColor = '#3b82f6';
                }
                isoRadarChartInstance.update();
            }
            
            // 6. Update PDCA Visuals
            updatePDCABar('p', planAvg);
            updatePDCABar('d', doAvg);
            updatePDCABar('c', checkAvg);
            updatePDCABar('a', actAvg);
        }
        
        function updatePDCABar(letter, val) {
            const bar = document.getElementById(`phva-${letter}-bar`);
            const txt = document.getElementById(`phva-${letter}-val`);
            if(bar && txt) {
                bar.style.width = val + '%';
                txt.innerText = val + '%';
                if(val < 60) {
                     bar.classList.remove('bg-blue-500', 'bg-teal', 'bg-orange-500', 'bg-purple-600');
                     bar.classList.add('bg-red-500');
                } else {
                    bar.classList.remove('bg-red-500');
                    if(letter === 'p') bar.classList.add('bg-blue-500');
                    if(letter === 'd') bar.classList.add('bg-teal');
                    if(letter === 'c') bar.classList.add('bg-orange-500');
                    if(letter === 'a') bar.classList.add('bg-purple-600');
                }
            }
        }

        // --- SIMULATOR LOGIC (NOM-036) ---
        function initSimulator() {
            const methodSelect = document.getElementById('sim-method-select');
            if(!methodSelect) return;
            
            const inputsNom036 = document.getElementById('inputs-nom036');
            const inputsReba = document.getElementById('inputs-reba');
            const inputsRula = document.getElementById('inputs-rula');
            
            // --- HELPER: UPDATE REPORT DISPLAY (Updated to update GLOBAL STATE) ---
            function updateReport(score, maxScore, label, colorClass, colorHex, methodFull) {
                // Update Global State
                appState.ergoRiskScore = score;
                appState.ergoRiskLabel = label;
                appState.currentMethod = methodFull;
                
                // 1. Update Visual Circle (In Dashboard)
                const circle = document.getElementById('score-circle');
                const num = document.getElementById('score-number');
                const lab = document.getElementById('score-label');
                const bar = document.getElementById('risk-fill-bar');
                
                if (circle && num && lab && bar) {
                    let borderClass = colorClass.replace('text-', 'border-');
                    circle.className = `w-48 h-48 rounded-full border-8 flex items-center justify-center mb-4 transition-all duration-500 ease-out mx-auto bg-gray-50 ${borderClass}`;
                    num.innerText = score;
                    num.className = `text-6xl font-heading font-extrabold block transition-colors ${colorClass}`;
                    lab.innerText = label;
                    lab.className = `text-3xl font-heading font-extrabold mb-1 transition-colors ${colorClass}`;
                    
                    let widthPct = (score / maxScore) * 100;
                    if(widthPct > 100) widthPct = 100;
                    bar.style.width = `${widthPct}%`;
                    bar.style.backgroundColor = colorHex;
                }
                
                // Trigger Global Report Update
                updateFinalReport();
            }

            // === CALCULATE NOM-036 (MAC) ===
            function calcNom036() {
                const weightElem = document.getElementById('sim-weight');
                if(!weightElem) return;
                const weight = parseInt(weightElem.value);
                document.getElementById('sim-weight-val').innerText = `${weight} kg`;
                
                const freqBtn = document.querySelector('.sim-btn-freq[data-active="true"]');
                const freqVal = freqBtn ? freqBtn.dataset.val : 'low'; 
                
                const hDist = document.getElementById('sim-h-dist').value; 
                const vPos = document.getElementById('sim-v-pos').value; 
                const grip = document.getElementById('sim-grip').value; 
                const twistElem = document.querySelector('input[name="sim-twist"]:checked');
                const twist = twistElem ? twistElem.value : 'no'; 

                let score = 0;
                let weightScore = 0;
                if (weight <= 10) weightScore = (freqVal === 'high' ? 1 : 0);
                else if (weight <= 20) weightScore = (freqVal === 'low' ? 1 : 3);
                else if (weight <= 25) weightScore = (freqVal === 'low' ? 3 : 5);
                else weightScore = 5;
                score += weightScore;

                if (hDist === 'med') score += 1; else if (hDist === 'far') score += 3;
                if (vPos === 'bad') score += 1; else if (vPos === 'crit') score += 3;
                if (twist === '45') score += 1; else if (twist === '90') score += 2;
                if (grip === 'fair') score += 1; else if (grip === 'poor') score += 2;

                let label = "RIESGO BAJO";
                let colorClass = "text-green-500";
                let colorHex = "#22c55e";

                if (score > 4 && score <= 10) { label = "RIESGO MEDIO"; colorClass = "text-yellow-500"; colorHex = "#eab308"; }
                else if (score > 10 && score <= 14) { label = "RIESGO ALTO"; colorClass = "text-red-500"; colorHex = "#ef4444"; }
                else if (score > 14) { label = "MUY ALTO"; colorClass = "text-purple-500"; colorHex = "#a855f7"; }

                updateReport(score, 20, label, colorClass, colorHex, "NOM-036-1 (MAC)");
            }

            // === CALCULATE REBA ===
            function calcReba() {
                const trunk = parseInt(document.getElementById('reba-trunk').value);
                const legs = parseInt(document.getElementById('reba-legs').value);
                const load = parseInt(document.getElementById('reba-load').value);
                const twist = document.getElementById('reba-twist').checked ? 1 : 0;
                
                let score = trunk + legs + load + twist + 1;

                let label = "NIVEL 1";
                let colorClass = "text-green-500";
                let colorHex = "#22c55e";

                if (score >= 4 && score <= 7) { label = "NIVEL 2 (MEDIO)"; colorClass = "text-yellow-500"; colorHex = "#eab308"; }
                else if (score >= 8 && score <= 10) { label = "NIVEL 3 (ALTO)"; colorClass = "text-red-500"; colorHex = "#ef4444"; }
                else if (score >= 11) { label = "NIVEL 4 (CRÍTICO)"; colorClass = "text-purple-500"; colorHex = "#a855f7"; }

                updateReport(score, 15, label, colorClass, colorHex, "Método REBA");
            }

            // === CALCULATE RULA ===
            function calcRula() {
                const arm = parseInt(document.getElementById('rula-arm').value);
                const wrist = parseInt(document.getElementById('rula-wrist').value);
                const neck = parseInt(document.getElementById('rula-neck').value);
                const isStatic = document.getElementById('rula-static').checked ? 1 : 0;

                let score = Math.ceil((arm + wrist + neck)/3) + isStatic + Math.max(0, arm-1);
                if (score > 7) score = 7;

                let label = "NIVEL 1";
                let colorClass = "text-green-500";
                let colorHex = "#22c55e";

                if (score >= 3 && score <= 4) { label = "NIVEL 2 (INVESTIGAR)"; colorClass = "text-yellow-500"; colorHex = "#eab308"; }
                else if (score >= 5 && score <= 6) { label = "NIVEL 3 (CAMBIAR)"; colorClass = "text-red-500"; colorHex = "#ef4444"; }
                else if (score === 7) { label = "NIVEL 4 (URGENTE)"; colorClass = "text-purple-500"; colorHex = "#a855f7"; }

                updateReport(score, 7, label, colorClass, colorHex, "Método RULA");
            }

            // --- MASTER UPDATE FUNCTION ---
            function updateSimulation() {
                const method = methodSelect.value;
                if (method === 'nom036') calcNom036();
                else if (method === 'reba') calcReba();
                else if (method === 'rula') calcRula();
            }

            // --- UI HANDLERS ---
            
            // Method Switcher
            methodSelect.addEventListener('change', () => {
                const val = methodSelect.value;
                inputsNom036.classList.add('hidden');
                inputsReba.classList.add('hidden');
                inputsRula.classList.add('hidden');

                if (val === 'nom036') inputsNom036.classList.remove('hidden');
                if (val === 'reba') inputsReba.classList.remove('hidden');
                if (val === 'rula') inputsRula.classList.remove('hidden');
                
                updateSimulation();
            });

            // NOM-036 Listeners
            const simWeight = document.getElementById('sim-weight');
            if(simWeight) simWeight.addEventListener('input', updateSimulation);
            document.getElementById('sim-h-dist').addEventListener('change', updateSimulation);
            document.getElementById('sim-v-pos').addEventListener('change', updateSimulation);
            document.getElementById('sim-grip').addEventListener('change', updateSimulation);
            document.querySelectorAll('input[name="sim-twist"]').forEach(r => r.addEventListener('change', updateSimulation));
            
            // Freq Buttons (Custom Logic for Active State)
            document.querySelectorAll('.sim-btn-freq').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.sim-btn-freq').forEach(b => {
                        b.dataset.active = "false";
                        b.className = `sim-btn-freq flex flex-col items-center justify-center py-2.5 rounded-lg transition-all duration-300 border border-slate-700 bg-slate-800/50 text-gray-400 hover:bg-slate-700 hover:text-white`;
                        b.querySelector('span.opacity-80')?.classList.replace('opacity-80', 'opacity-60');
                    });
                    const target = e.currentTarget;
                    target.dataset.active = "true";
                    target.className = `sim-btn-freq flex flex-col items-center justify-center py-2.5 rounded-lg transition-all duration-300 border shadow-lg scale-[1.02] bg-teal border-teal text-white shadow-teal-500/20`;
                    target.querySelector('span.opacity-60')?.classList.replace('opacity-60', 'opacity-80');
                    
                    updateSimulation();
                });
            });
            // Set default active freq
            const defaultFreq = document.querySelector('.sim-btn-freq[data-val="low"]');
            if(defaultFreq) defaultFreq.dataset.active = "true";

            // REBA Listeners
            document.getElementById('reba-trunk').addEventListener('change', updateSimulation);
            document.getElementById('reba-legs').addEventListener('change', updateSimulation);
            document.getElementById('reba-load').addEventListener('change', updateSimulation);
            document.getElementById('reba-twist').addEventListener('change', updateSimulation);

            // RULA Listeners
            document.getElementById('rula-arm').addEventListener('change', updateSimulation);
            document.getElementById('rula-wrist').addEventListener('change', updateSimulation);
            document.getElementById('rula-neck').addEventListener('change', updateSimulation);
            document.getElementById('rula-static').addEventListener('change', updateSimulation);

            // Init
            updateSimulation();
        }

        function switchDashTab(tabName) {
            document.querySelectorAll('.dash-sidebar-btn').forEach(btn => {
                btn.classList.remove('active', 'text-white');
                btn.classList.add('text-gray-400');
            });
            const activeBtn = document.getElementById(`tab-${tabName}`);
            if(activeBtn) {
                activeBtn.classList.add('active', 'text-white');
                activeBtn.classList.remove('text-gray-400');
            }

            document.querySelectorAll('.dash-view').forEach(v => v.classList.add('hidden'));
            const view = document.getElementById(`view-${tabName}`);
            if(view) view.classList.remove('hidden');
        }

        function updateCharts() {
            // Placeholder para lógica de filtros futuros
            console.log("Filtro actualizado: " + document.getElementById('deptFilter').value);
        }

        // --- I18N & UI UTILS ---
        const langToggle = document.getElementById('lang-toggle');
        const langToggleMobile = document.getElementById('lang-toggle-mobile');
        
        const translations = {
            "es": { 
                "nav_home": "Inicio", 
                "nav_strategy": "Estrategia", 
                "nav_legal": "Normatividad",
                "nav_bi": "BI & Dashboard", 
                "nav_ai": "AI Sim", 
                "nav_career": "Trayectoria", 
                "nav_whatsapp": "WhatsApp directo",
                "nav_ai_full": "AI Strategic Sim ✨",

                "hero_badge": "Salud Ocupacional y Bienestar Corporativo",
                "hero_h1": "Strategic Health, <br> <span class=\"gradient-text\">Wellness & Regulatory</span> Leader.",
                "hero_desc": "Soy el <strong class=\"text-white\">Dr. Han</strong>. Lidero la transformación de la salud corporativa, alineando el cumplimiento normativo estricto con estrategias de bienestar que impulsan la rentabilidad y blindan la operación.",
                "hero_btn_vision": "Ver Dashboard Interactivo",
                "hero_btn_ai": "Probar AI Simulator",
                "badge_id_label": "Cédula profesional",

                "about_title": "Más allá de la medicina ocupacional: <span class=\"text-teal\">gestión de riesgos.</span>",
                "about_desc": "Elevo la salud ocupacional de un requisito operativo a una ventaja competitiva. Diseño e implemento estrategias de cumplimiento normativo y bienestar corporativo que no solo mitigan riesgos legales (STPS/ISO), sino que optimizan la productividad y aseguran la continuidad del negocio.",
                "card1_title": "Liderazgo regulatorio",
                "card1_desc": "Implementación estricta de normatividad STPS e ISO 45001. Gestión proactiva para evitar multas y asegurar la continuidad operativa.",
                "card2_title": "Wellness corporativo (ROI)",
                "card2_desc": "Programas de bienestar diseñados no solo para la salud, sino para mejorar la productividad, retención de talento y reducir la prima de riesgo.",
                "card3_title": "Gestión de crisis",
                "card3_desc": "Experiencia probada en vigilancia epidemiológica y respuesta rápida ante emergencias sanitarias en entornos de alto flujo como la aviación.",

                "legal_badge_1": "Compliance 360°",
                "legal_badge_2": "Derecho Sanitario & Normatividad",
                "legal_title": "Blindaje Normativo: <span class=\"text-teal\">STPS • COFEPRIS • SEMARNAT</span>",
                "legal_desc": "La fiscalización digital es ahora integral. Mi consultoría unifica la gestión de seguridad laboral, responsabilidad sanitaria y cumplimiento ambiental, asegurando que tu operación resista auditorías cruzadas y el nuevo escrutinio del <strong>SIQAL</strong>.",
                "legal_audit_link": "Auditar mi cumplimiento",
                "legal_card1_title": "STPS & SIQAL",
                "legal_card1_desc": "Gestión estratégica de <strong>Comisiones de Seguridad e Higiene</strong> como primer nivel de defensa. Atención experta a inspecciones del <strong>SIQAL</strong> y cumplimiento de NOMs críticas (030, 035, 036) para blindar la operación ante multas.",
                "legal_card2_title": "COFEPRIS & Datos Personales",
                "legal_card2_desc": "Gestión de Avisos de Funcionamiento y Licencias Sanitarias. Validación del Expediente Clínico (NOM-004) y cumplimiento estricto de la <strong>Ley Federal de Protección de Datos Personales (LFPDPPP)</strong> para el manejo seguro de información sensible de pacientes.",
                "legal_badge_avisos": "Avisos",
                "legal_card3_title": "SEMARNAT (RPBI)",
                "legal_card3_desc": "Gestión ambiental de la unidad médica. Clasificación, manejo y disposición final de Residuos Peligrosos Biológico-Infecciosos (NOM-087-ECOL-SSA1) y planes de manejo de residuos especiales.",

                "bi_tag": "Inteligencia de Datos",
                "bi_title": "Decisiones basadas en datos. <br> <span class=\"text-sky\">No en suposiciones.</span>",
                "bi_desc": "Interactúa con este simulador real para ver cómo transformo indicadores médicos en decisiones financieras y operativas.",
                "bi_btn_general": "Dashboard General",
                "bi_btn_035": "Psicosocial NOM-035",
                "bi_btn_036": "Ergonomía NOM-036",
                "bi_btn_iso": "Gestión ISO 45001",
                "bi_btn_wellness": "Wellness & ROI",

                "dash_header_title": "Centro de Comando Estratégico",
                "dash_header_status": "Status: En línea • Datos actualizados",
                "dash_toggle_label": "Estrategia",
                "strat_label_on": "Con Gestión Dr. Han",
                "strat_label_off": "Sin Gestión Estratégica",
                
                "kpi_days": "Días Incapacidad",
                "kpi_iso": "Cumplimiento ISO",
                "kpi_risk": "Prima de Riesgo",
                "kpi_cost": "Costo Siniestralidad",
                "chart_trend_title": "Tendencia de Incidencias vs Costos",
                "chart_dist_title": "Distribución por Departamento",
                "chart_job_title": "Incidencias por Puesto",

                "nom035_goal_title": "Objetivo de Cumplimiento NOM-035",
                "nom035_goal_desc": "Avance global de implementación",
                "nom035_ats_cases": "Casos ATS Activos",
                "nom035_radar": "Dominios de Riesgo (Radar)",
                "nom035_pie": "Nivel de Riesgo Poblacional",

                "ergo_kpi_comp": "Cumplimiento",
                "ergo_kpi_save": "Ahorro TME",
                "ergo_kpi_staff": "Personal Expuesto",
                "ergo_kpi_fatigue": "Riesgo Fatiga",
                "ergo_fin_title": "Impacto Financiero ($)",
                "ergo_factor_title": "Análisis Factorial",

                "iso_kpi_adherence": "Adherencia Global",
                "iso_status_cert": "Certificable",
                "iso_kpi_nc": "No Conformidades",
                "iso_nc_desc": "Mayores (Críticas)",
                "iso_kpi_review": "Rev. por Dirección",
                "iso_radar_title": "Nivel de Madurez (Anexo SL)",
                "iso_cycle_title": "Ciclo PHVA (PDCA)",
                "iso_plan": "Planificar (Contexto, Liderazgo)",
                "iso_do": "Hacer (Apoyo, Operación)",
                "iso_check": "Verificar (Evaluación)",
                "iso_act": "Actuar (Mejora)",
                
                "iso_input_ctx": "4. Contexto",
                "iso_input_lead": "5. Liderazgo",
                "iso_input_plan": "6. Planificación",
                "iso_input_sup": "7. Apoyo",
                "iso_input_ops": "8. Operación",
                "iso_input_eval": "9. Evaluación",
                "iso_input_imp": "10. Mejora",

                "sim_panel_title": "Panel de Variables",
                "sim_load": "1. Carga Física",
                "sim_hdist": "2. Distancia Horizontal",
                "sim_vpos": "3. Posición Vertical",
                "sim_twist": "4. Torsión",
                "sim_grip": "5. Agarre",
                "sim_result_label": "Nivel de Riesgo Detectado",
                "sim_points": "Puntos",
                "sim_eval_pre": "Evaluación Preliminar",
                "risk_low": "Bajo",
                "risk_med": "Medio",
                "risk_high": "Alto",
                "risk_crit": "Crítico",

                "well_kpi_idx": "Índice Salud",
                "well_kpi_comp": "Cumplimiento 035",
                "well_kpi_chronic": "Crónicos",
                "well_kpi_roi": "ROI Wellness",
                "well_chart_imc": "Distribución IMC",
                "well_chart_path": "Top Patologías",

                "report_header_tag": "Documento Oficial",
                "report_title": "Reporte Ejecutivo de Salud Corporativa",
                "report_meta_period": "Periodo: Enero - Junio 2026",
                "report_meta_for": "Generado para:",
                "report_meta_target": "Consejo Directivo",
                "rep_kpi_status": "Estatus Normativo",
                "rep_kpi_fin": "Impacto Financiero",
                "rep_kpi_fin_sub": "Ahorro en prima de riesgo",
                "rep_kpi_health": "Salud Organizacional",
                "rep_kpi_health_sub": "Estabilidad operativa alta",
                "rep_cta_title": "¿Su empresa enfrenta estos mismos desafíos?",
                "rep_cta_desc": "Puedo implementar este mismo nivel de diagnóstico y solución en sus primeros 90 días.",
                "rep_cta_btn": "Agendar Diagnóstico Breve",
                "rep_footer_conf": "Este reporte es confidencial y para uso exclusivo de la dirección.",
                "rep_signature_role": "Director Médico & Estratega",
                "rep_signature_id": "Céd. Prof. 12210167",

                "rep_section1_title": "Diagnóstico de Riesgo en Tiempo Real",
                "rep_method_label": "Método",
                "rep_finding_opt_title": "Condiciones Óptimas",
                "rep_finding_opt_desc": "El análisis ergonómico indica que el puesto opera dentro de los rangos de seguridad biomecánica. El nivel de riesgo es bajo, favoreciendo la productividad sostenible.",
                "rep_finding_warn_title": "Alerta Operativa",
                "rep_finding_warn_desc": "Se detectan desviaciones moderadas en la carga postural o de fuerza. Existe potencial de fatiga acumulada si no se implementan pausas o rotaciones.",
                "rep_finding_crit_title": "Riesgo Crítico Detectado",
                "rep_finding_crit_desc": "Los indicadores biomecánicos superan los límites de seguridad recomendados. Existe un riesgo inminente de trastorno musculoesquelético que impactará en costos por incapacidad.",
                "rep_eval_text": "La evaluación actual sitúa la tarea en un nivel de",
                "rep_section2_title": "Recomendación Técnica",
                "rep_section3_title": "Estrategia de Intervención",
                "rep_strat_high1": "Programar reingeniería del puesto inmediata.",
                "rep_strat_high2": "Capacitación urgente en higiene de columna.",
                "rep_strat_low1": "Mantener vigilancia epidemiológica estándar.",
                "rep_strat_low2": "Reforzar programa de pausas activas.",

                "rec_nom_low": "Condiciones aceptables. No se requieren acciones correctivas inmediatas.",
                "rec_nom_med": "Examinar la tarea. Considerar uso de ayudas mecánicas o rotación de personal cada 2 horas.",
                "rec_nom_high": "ACCIÓN PRONTA REQUERIDA. Reducir peso de carga, mejorar agarres o modificar altura de levantamiento.",
                "rec_nom_crit": "Riesgo Crítico. DETENER ACTIVIDAD. Rediseño inmediato del proceso requerido por norma.",
                "rec_reba_low": "Riesgo bajo. Puede ser necesaria una actuación.",
                "rec_reba_med": "Riesgo medio. Es necesaria la actuación.",
                "rec_reba_high": "Riesgo alto/crítico. Actuación inmediata necesaria.",
                "rec_rula_low": "Postura aceptable.",
                "rec_rula_med": "Se requieren cambios pronto.",
                "rec_rula_high": "Se requieren cambios INMEDIATAMENTE.",

                "ai_badge": "Powered by Gemini AI",
                "ai_section_title": "AI Strategic Simulator",
                "ai_desc": "La tecnología es una extensión de la estrategia. Ingrese un desafío actual y obtenga un pre-análisis basado en datos y cumplimiento.",
                "ai_input_label": "Describa un reto",
                "ai_input_placeholder": "Ej: Nuestra prima de riesgo aumentó un 10% el último año debido a accidentes en almacén. Necesitamos un plan de contención rápido.",
                "ai_btn_generate": "Generar estrategia ✨",
                "ai_disclaimer": "Modelo: Gemini 2.5 Flash. Respuesta generada en tiempo real.",
                "ai_preview_title": "Strategic Report Preview",
                "ai_waiting_text": "\"Esperando input estratégico para iniciar análisis...\"",
                "ai_res_diag": "Diagnóstico",
                "ai_res_act": "Acción",
                "ai_res_txt1": "El reto sugiere desviación en controles operativos.",
                "ai_res_li1": "Auditoría NOM-030-STPS.",
                "ai_res_li2": "Protocolo Stop-Work.",
                "ai_alert_empty": "Por favor describa un reto.",
                "ai_analyzing": "Analizando datos regulatorios...",

                "career_title": "Career Highlights",
                "career_item1_title": "Aeroméxico & Logística",
                "career_item1_desc": "Gestión estratégica de servicios médicos. Optimización de la aptitud psicofísica y cumplimiento normativo (STPS/SCT).",
                "career_item2_title": "Strategic Innovation",
                "career_item2_desc": "Diseño soluciones donde la infraestructura y la salud convergen para generar impacto real, medible y humano.",

                "footer_title": "¿Hablamos de estrategia?",
                "footer_btn_email": "Correo electrónico",
                "footer_btn_wa": "WhatsApp directo",
                "footer_btn_cv": "Descargar CV Completo",
                "footer_rights": "© 2026 Dr. Han Medical. Todos los derechos reservados."
            },
            "en": { 
                "nav_home": "Home", 
                "nav_strategy": "Strategy", 
                "nav_legal": "Compliance",
                "nav_bi": "BI & Dashboard", 
                "nav_ai": "AI Sim", 
                "nav_career": "Career", 
                "nav_whatsapp": "Direct WhatsApp",
                "nav_ai_full": "AI Strategic Sim ✨",

                "hero_badge": "Occupational Health and Corporate Wellness",
                "hero_h1": "Strategic Health, <br> <span class=\"gradient-text\">Wellness & Regulatory</span> Leader.",
                "hero_desc": "I am <strong class=\"text-white\">Dr. Han</strong>. I lead the transformation of corporate health, aligning strict regulatory compliance with wellness strategies that drive profitability and shield operations.",
                "hero_btn_vision": "View Interactive Dashboard",
                "hero_btn_ai": "Try AI Simulator",
                "badge_id_label": "Professional License",

                "about_title": "Beyond Occupational Medicine: <span class=\"text-teal\">Risk Management.</span>",
                "about_desc": "I elevate occupational health from an operational requirement to a competitive advantage. I design and implement regulatory compliance and corporate wellness strategies that not only mitigate legal risks (STPS/ISO), but optimize productivity and ensure business continuity.",
                "card1_title": "Regulatory Leadership",
                "card1_desc": "Strict implementation of STPS and ISO 45001 standards. Proactive management to avoid fines and ensure operational continuity.",
                "card2_title": "Corporate Wellness (ROI)",
                "card2_desc": "Wellness programs designed not just for health, but to improve productivity, talent retention, and reduce risk premiums.",
                "card3_title": "Crisis Management",
                "card3_desc": "Proven experience in epidemiological surveillance and rapid response to health emergencies in high-flow environments like aviation.",

                "legal_badge_1": "360° Compliance",
                "legal_badge_2": "Health Law & Regulations",
                "legal_title": "Regulatory Shield: <span class=\"text-teal\">STPS • COFEPRIS • SEMARNAT</span>",
                "legal_desc": "Digital auditing is now comprehensive. My consulting unifies labor safety management, sanitary responsibility, and environmental compliance, ensuring your operation withstands cross-audits and new <strong>SIQAL</strong> scrutiny.",
                "legal_audit_link": "Audit my compliance",
                "legal_card1_title": "STPS & SIQAL",
                "legal_card1_desc": "Strategic management of <strong>Safety and Hygiene Commissions</strong> as a first line of defense. Expert attention to <strong>SIQAL</strong> inspections and compliance with critical NOMs (030, 035, 036) to shield the operation from fines.",
                "legal_card2_title": "COFEPRIS & Personal Data",
                "legal_card2_desc": "Management of Operating Notices and Sanitary Licenses. Validation of Clinical Records (NOM-004) and strict compliance with the <strong>Federal Law on Protection of Personal Data (LFPDPPP)</strong> for secure handling of sensitive patient information.",
                "legal_badge_avisos": "Notices",
                "legal_card3_title": "SEMARNAT (RPBI)",
                "legal_card3_desc": "Environmental management of the medical unit. Classification, handling, and final disposal of Biological-Infectious Hazardous Waste (NOM-087-ECOL-SSA1) and special waste management plans.",

                "bi_tag": "Data Intelligence",
                "bi_title": "Data-driven decisions. <br> <span class=\"text-sky\">Not assumptions.</span>",
                "bi_desc": "Interact with this real simulator to see how I transform medical indicators into financial and operational decisions.",
                "bi_btn_general": "General Dashboard",
                "bi_btn_035": "Psychosocial NOM-035",
                "bi_btn_036": "Ergonomics NOM-036",
                "bi_btn_iso": "ISO 45001 Management",
                "bi_btn_wellness": "Wellness & ROI",

                "dash_header_title": "Strategic Command Center",
                "dash_header_status": "Status: Online • Data Updated",
                "dash_toggle_label": "Strategy",
                "strat_label_on": "With Dr. Han Management",
                "strat_label_off": "Without Strategic Management",

                "kpi_days": "Disability Days",
                "kpi_iso": "ISO Compliance",
                "kpi_risk": "Risk Premium",
                "kpi_cost": "Claim Cost",
                "chart_trend_title": "Incidents vs Costs Trend",
                "chart_dist_title": "Distribution by Department",
                "chart_job_title": "Incidents by Position",

                "nom035_goal_title": "NOM-035 Compliance Goal",
                "nom035_goal_desc": "Global implementation progress",
                "nom035_ats_cases": "Active ATS Cases",
                "nom035_radar": "Risk Domains (Radar)",
                "nom035_pie": "Population Risk Level",

                "ergo_kpi_comp": "Compliance",
                "ergo_kpi_save": "MSD Savings",
                "ergo_kpi_staff": "Exposed Staff",
                "ergo_kpi_fatigue": "Fatigue Risk",
                "ergo_fin_title": "Financial Impact ($)",
                "ergo_factor_title": "Factor Analysis",

                "iso_kpi_adherence": "Global Adherence",
                "iso_status_cert": "Certifiable",
                "iso_kpi_nc": "Non-Conformities",
                "iso_nc_desc": "Major (Critical)",
                "iso_kpi_review": "Mgmt. Review",
                "iso_radar_title": "Maturity Level (Annex SL)",
                "iso_cycle_title": "PDCA Cycle",
                "iso_plan": "Plan (Context, Leadership)",
                "iso_do": "Do (Support, Operation)",
                "iso_check": "Check (Evaluation)",
                "iso_act": "Act (Improvement)",

                "iso_input_ctx": "4. Context",
                "iso_input_lead": "5. Leadership",
                "iso_input_plan": "6. Planning",
                "iso_input_sup": "7. Support",
                "iso_input_ops": "8. Operation",
                "iso_input_eval": "9. Evaluation",
                "iso_input_imp": "10. Improvement",

                "sim_panel_title": "Variables Panel",
                "sim_load": "1. Physical Load",
                "sim_hdist": "2. Horizontal Distance",
                "sim_vpos": "3. Vertical Position",
                "sim_twist": "4. Twist",
                "sim_grip": "5. Grip",
                "sim_result_label": "Detected Risk Level",
                "sim_points": "Points",
                "sim_eval_pre": "Preliminary Eval",
                "risk_low": "Low",
                "risk_med": "Med",
                "risk_high": "High",
                "risk_crit": "Crit",

                "well_kpi_idx": "Health Index",
                "well_kpi_comp": "035 Compliance",
                "well_kpi_chronic": "Chronic",
                "well_kpi_roi": "Wellness ROI",
                "well_chart_imc": "BMI Distribution",
                "well_chart_path": "Top Pathologies",

                "report_header_tag": "Official Document",
                "report_title": "Corporate Health Executive Report",
                "report_meta_period": "Period: January - June 2026",
                "report_meta_for": "Generated for:",
                "report_meta_target": "Board of Directors",
                "rep_kpi_status": "Regulatory Status",
                "rep_kpi_fin": "Financial Impact",
                "rep_kpi_fin_sub": "Risk premium savings",
                "rep_kpi_health": "Org. Health",
                "rep_kpi_health_sub": "High operational stability",
                "rep_cta_title": "Does your company face these challenges?",
                "rep_cta_desc": "I can implement this same level of diagnosis and solution in your first 90 days.",
                "rep_cta_btn": "Book Brief Diagnosis",
                "rep_footer_conf": "This report is confidential and for executive use only.",
                "rep_signature_role": "Medical Director & Strategist",
                "rep_signature_id": "Prof. Lic. 12210167",

                "rep_section1_title": "Real-Time Risk Diagnosis",
                "rep_method_label": "Method",
                "rep_finding_opt_title": "Optimal Conditions",
                "rep_finding_opt_desc": "Ergonomic analysis indicates the station operates within biomechanical safety ranges. Risk level is low, favoring sustainable productivity.",
                "rep_finding_warn_title": "Operational Alert",
                "rep_finding_warn_desc": "Moderate deviations in postural load or force detected. Potential for accumulated fatigue exists if pauses or rotations are not implemented.",
                "rep_finding_crit_title": "Critical Risk Detected",
                "rep_finding_crit_desc": "Biomechanical indicators exceed recommended safety limits. Imminent risk of musculoskeletal disorder exists, impacting disability costs.",
                "rep_eval_text": "Current evaluation places the task at a level of",
                "rep_section2_title": "Technical Recommendation",
                "rep_section3_title": "Intervention Strategy",
                "rep_strat_high1": "Schedule immediate station re-engineering.",
                "rep_strat_high2": "Urgent training in spine hygiene.",
                "rep_strat_low1": "Maintain standard epidemiological surveillance.",
                "rep_strat_low2": "Reinforce active pause program.",

                "rec_nom_low": "Acceptable conditions. No immediate corrective actions required.",
                "rec_nom_med": "Examine task. Consider mechanical aids or staff rotation every 2 hours.",
                "rec_nom_high": "PROMPT ACTION REQUIRED. Reduce load weight, improve grips, or modify lift height.",
                "rec_nom_crit": "Critical Risk. STOP ACTIVITY. Immediate process redesign required by regulation.",
                "rec_reba_low": "Low risk. Action may be necessary.",
                "rec_reba_med": "Medium risk. Action is necessary.",
                "rec_reba_high": "High/Critical risk. Immediate action necessary.",
                "rec_rula_low": "Acceptable posture.",
                "rec_rula_med": "Changes required soon.",
                "rec_rula_high": "Changes required IMMEDIATELY.",

                "ai_badge": "Powered by Gemini AI",
                "ai_section_title": "AI Strategic Simulator",
                "ai_desc": "Technology is an extension of strategy. Enter a current challenge and get a pre-analysis based on data and compliance.",
                "ai_input_label": "Describe a challenge",
                "ai_input_placeholder": "Ex: Our risk premium increased 10% last year due to warehouse accidents. We need a rapid containment plan.",
                "ai_btn_generate": "Generate Strategy ✨",
                "ai_disclaimer": "Model: Gemini 2.5 Flash. Response generated in real-time.",
                "ai_preview_title": "Strategic Report Preview",
                "ai_waiting_text": "\"Waiting for strategic input to start analysis...\"",
                "ai_res_diag": "Diagnosis",
                "ai_res_act": "Action",
                "ai_res_txt1": "The challenge suggests deviation in operational controls.",
                "ai_res_li1": "NOM-030-STPS Audit.",
                "ai_res_li2": "Stop-Work Protocol.",
                "ai_alert_empty": "Please describe a challenge.",
                "ai_analyzing": "Analyzing regulatory data...",

                "career_title": "Career Highlights",
                "career_item1_title": "Aeroméxico & Logistics",
                "career_item1_desc": "Strategic management of medical services. Optimization of psychophysical aptitude and regulatory compliance (STPS/SCT).",
                "career_item2_title": "Strategic Innovation",
                "career_item2_desc": "Designing solutions where infrastructure and health converge to generate real, measurable, and human impact.",

                "footer_title": "Let's talk strategy?",
                "footer_btn_email": "Email",
                "footer_btn_wa": "Direct WhatsApp",
                "footer_btn_cv": "Download Full CV",
                "footer_rights": "© 2026 Dr. Han Medical. All rights reserved."
            }
        };

        function toggleLanguage() {
            currentLang = currentLang === 'es' ? 'en' : 'es';
            const nextLang = currentLang === 'es' ? 'EN' : 'ES';
            if (langToggle) langToggle.innerText = nextLang;
            if (langToggleMobile) langToggleMobile.innerText = nextLang;
            
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[currentLang][key]) {
                    // Check if it's an input with placeholder
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') {
                        el.placeholder = translations[currentLang][key];
                    } else {
                        el.innerHTML = translations[currentLang][key];
                    }
                }
            });
            
            // Re-render Dynamic components that depend on lang
            updateFinalReport();
            
            // Re-update Strategy Label manually if needed (covered by updateFinalReport/listeners usually, but let's be safe)
            const label = document.getElementById('strategy-label');
             if(label) {
                label.innerText = appState.isDrHanStrategy ? translations[currentLang].strat_label_on : translations[currentLang].strat_label_off;
            }
        }
        if (langToggle) langToggle.addEventListener('click', toggleLanguage);
        if (langToggleMobile) langToggleMobile.addEventListener('click', toggleLanguage);

        // Mobile Menu
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        if (mobileMenuBtn) {
            mobileMenuBtn.addEventListener('click', () => {
                document.getElementById('mobile-menu').classList.toggle('hidden');
            });
        }

        // Initialize
        window.onload = () => { initDashboard(); };
        
        // --- GEMINI AI (Placeholder) ---
        const generateBtn = document.getElementById('ai-generate-btn');
        const aiLoader = document.getElementById('ai-loader');
        const aiResult = document.getElementById('ai-result');
        
        if (generateBtn) {
            generateBtn.addEventListener('click', async () => {
                const val = document.getElementById('ai-input').value.trim();
                const rTxt = translations[currentLang];
                
                if (!val) return alert(rTxt.ai_alert_empty);
                generateBtn.disabled = true;
                aiLoader.classList.remove('hidden');
                aiResult.innerHTML = `<p class="text-gray-400 italic">${rTxt.ai_analyzing}</p>`;
                
                setTimeout(() => {
                    aiResult.innerHTML = `<p><strong>${rTxt.ai_res_diag}:</strong> ${rTxt.ai_res_txt1}</p><p><strong>${rTxt.ai_res_act}:</strong><ul><li>${rTxt.ai_res_li1}</li><li>${rTxt.ai_res_li2}</li></ul>`;
                    aiLoader.classList.add('hidden');
                    generateBtn.disabled = false;
                }, 2000);
            });
        }
    </script>
</body>
</html>
