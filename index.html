<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Han | Strategic Health, Wellness & Regulatory Leader</title>
    <meta name="description" content="Sitio Oficial del Dr. Edgar Ivan Bañuelos Han. Liderazgo estratégico en Salud Ocupacional, Bienestar Corporativo y Cumplimiento Normativo.">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&family=Inter:wght@300;400;500;600&family=Montserrat:wght@600;700;800&display=swap" rel="stylesheet">

    <!-- FontAwesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        navy: '#0f172a',
                        slate: '#f8fafc',
                        sky: '#0ea5e9',
                        teal: '#0d9488',
                        whatsapp: '#25D366',
                        ai: '#6366f1',
                        orange: '#f97316'
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        heading: ['Montserrat', 'sans-serif'],
                        signature: ['Dancing Script', 'cursive'],
                    },
                    boxShadow: {
                        'glow': '0 4px 20px -2px rgba(13, 148, 136, 0.5)',
                        'ai-glow': '0 4px 25px -5px rgba(99, 102, 241, 0.5)',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out'
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; -webkit-font-smoothing: antialiased; }
        h1, h2, h3, h4, .font-heading { font-family: 'Montserrat', sans-serif; }
        .font-signature { font-family: 'Dancing Script', cursive; }
        .gradient-text { background: linear-gradient(to right, #0ea5e9, #0d9488); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        /* REGLA GLOBAL PARA EVITAR SILABEO EN TEXTO JUSTIFICADO */
        .text-justify {
            hyphens: none !important;
            -webkit-hyphens: none !important;
            -ms-hyphens: none !important;
        }

        .dash-sidebar-btn { transition: all 0.3s ease; }
        .dash-sidebar-btn.active { background-color: rgba(255, 255, 255, 0.1); border-left: 4px solid #0d9488; color: white; }
        .dash-sidebar-btn:hover:not(.active) { background-color: rgba(255, 255, 255, 0.05); }
        .kpi-card { transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .kpi-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04); }
        
        input[type=range] { -webkit-appearance: none; background: transparent; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 16px; width: 16px; border-radius: 50%; background: #ffffff; cursor: pointer; margin-top: -6px; box-shadow: 0 1px 3px rgba(0,0,0,0.3); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 4px; cursor: pointer; background: rgba(255,255,255,0.3); border-radius: 2px; }
        
        .toggle-checkbox:checked { right: 0; border-color: #0d9488; }
        .toggle-checkbox:checked + .toggle-label { background-color: #0d9488; }
        
        /* Scrollbar custom */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: rgba(255,255,255,0.05); }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.4); }

        select option { color: #000000 !important; background-color: #ffffff !important; }
        .ai-response ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 1rem; }
        .ai-response strong { color: #0f172a; font-weight: 700; }
        .ai-response p { margin-bottom: 0.75rem; }
    </style>
</head>
<body class="bg-white text-gray-800 antialiased">

    <!-- NAVBAR FIXED -->
    <nav class="fixed w-full z-50 bg-navy/95 backdrop-blur-md shadow-lg border-b border-gray-800 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16 md:h-20 gap-4 lg:gap-8">
                <!-- Logo -->
                <div class="flex-shrink-0 flex items-center">
                    <a href="#" class="text-white font-heading font-bold text-xl tracking-wide flex items-center">
                        <img src="https://drive.google.com/thumbnail?id=1oqMOYFDdIc47CKLMa3xCSSvptH9aJyeC&sz=w200" alt="Logo Dr. Han" class="h-10 mr-3" referrerpolicy="no-referrer">
                        <div class="flex flex-col sm:flex-row sm:items-center">
                            <span>DR. HAN</span> 
                            <span class="text-sky font-light sm:ml-2 text-xs sm:text-sm tracking-normal opacity-90 hidden lg:inline-block border-l border-gray-600 pl-2 ml-2">STRATEGIC HEALTH LEADER</span>
                        </div>
                    </a>
                </div>
                
                <!-- Desktop Menu -->
                <div class="hidden md:flex space-x-4 lg:space-x-8 items-center">
                    <a href="#hero" class="text-gray-300 hover:text-white transition-colors text-sm font-medium tracking-wide" data-i18n="nav_home">Inicio</a>
                    <a href="#about" class="text-gray-300 hover:text-white transition-colors text-sm font-medium tracking-wide" data-i18n="nav_strategy">Estrategia</a>
                    <a href="#legal-shield" class="text-red-300 hover:text-red-100 transition-colors text-sm font-bold tracking-wide flex items-center gap-1"><i class="fas fa-shield-halved text-xs"></i> <span data-i18n="nav_legal">Normatividad</span></a>
                    <a href="#bi" class="text-teal hover:text-white transition-colors text-sm font-bold tracking-wide" data-i18n="nav_bi">BI & Dashboard</a>
                    <a href="#ai-simulator" class="text-indigo-400 hover:text-indigo-300 transition-colors text-sm font-bold tracking-wide flex items-center gap-1"><i class="fas fa-robot"></i> <span data-i18n="nav_ai">AI Sim</span></a>
                    <a href="#trayectoria" class="text-gray-300 hover:text-white transition-colors text-sm font-medium tracking-wide" data-i18n="nav_career">Trayectoria</a>
                    
                    <a href="https://wa.me/525629846164" target="_blank" class="bg-teal hover:bg-teal/90 text-white px-4 py-2 rounded-full text-xs lg:text-sm font-bold transition-all shadow-glow flex items-center gap-2 transform hover:scale-105">
                        <i class="fab fa-whatsapp"></i> <span class="hidden lg:inline" data-i18n="nav_whatsapp">WhatsApp directo</span>
                    </a>

                    <button id="lang-toggle" class="ml-2 px-3 py-1 rounded border border-gray-500 text-gray-300 hover:text-white hover:border-white transition-colors text-xs font-bold uppercase w-10 text-center">EN</button>
                </div>

                <!-- Mobile menu button -->
                <div class="md:hidden flex items-center gap-4">
                     <button id="lang-toggle-mobile" class="px-2 py-1 rounded border border-gray-500 text-gray-300 text-xs font-bold uppercase w-8 text-center">EN</button>
                    <button id="mobile-menu-btn" class="text-gray-300 hover:text-white focus:outline-none">
                        <i class="fas fa-bars text-2xl"></i>
                    </button>
                </div>
            </div>
        </div>
        <!-- Mobile Menu Panel -->
        <div id="mobile-menu" class="hidden md:hidden bg-navy border-t border-gray-800 absolute w-full">
            <div class="px-2 pt-2 pb-3 space-y-1 sm:px-3 text-center">
                <a href="#hero" class="block px-3 py-2 text-gray-300 hover:text-white font-medium" data-i18n="nav_home">Inicio</a>
                <a href="#about" class="block px-3 py-2 text-gray-300 hover:text-white font-medium" data-i18n="nav_strategy">Estrategia</a>
                <a href="#legal-shield" class="block px-3 py-2 text-red-300 hover:text-white font-medium"><i class="fas fa-shield-halved text-xs"></i> <span data-i18n="nav_legal">Normatividad</span></a>
                <a href="#bi" class="block px-3 py-2 text-teal font-bold" data-i18n="nav_bi">Data & BI</a>
                <a href="#ai-simulator" class="block px-3 py-2 text-indigo-400 font-bold" data-i18n="nav_ai_full">AI Strategic Sim ✨</a>
                <a href="#trayectoria" class="block px-3 py-2 text-gray-300 hover:text-white font-medium" data-i18n="nav_career">Trayectoria</a>
            </div>
        </div>
    </nav>

    <!-- HERO SECTION -->
    <section id="hero" class="relative bg-navy pt-24 md:pt-32 lg:pt-36 pb-16 lg:pb-24 overflow-hidden">
        <div class="absolute top-0 right-0 -mr-20 -mt-20 w-96 h-96 bg-sky/10 rounded-full blur-3xl"></div>
        <div class="absolute bottom-0 left-0 -ml-20 -mb-20 w-80 h-80 bg-teal/10 rounded-full blur-3xl"></div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-16 items-center">
                <div class="order-2 lg:order-1 text-center lg:text-left pt-2 lg:pt-0">
                    <span class="inline-block py-1 px-3 rounded-full bg-slate-800 border border-slate-700 text-sky text-[10px] lg:text-xs font-bold tracking-widest mb-4 uppercase" data-i18n="hero_badge">Salud Ocupacional y Bienestar Corporativo</span>
                    <h1 class="text-3xl sm:text-4xl lg:text-5xl xl:text-6xl font-heading font-extrabold text-white leading-tight mb-5" data-i18n="hero_h1">
                        Strategic Health, <br>
                        <span class="gradient-text">Wellness & Regulatory</span> Leader.
                    </h1>
                    <!-- UPDATED: Added hyphens-none class -->
                    <h2 class="text-base lg:text-lg text-gray-400 mb-8 font-light leading-relaxed max-w-2xl mx-auto lg:mx-0 text-justify lg:text-left hyphens-none" data-i18n="hero_desc">
                        Soy el <strong class="text-white">Dr. Han</strong>. Lidero la transformación de la salud corporativa, alineando el cumplimiento normativo estricto con estrategias de bienestar que impulsan la rentabilidad y blindan la operación.
                    </h2>
                    <div class="flex flex-col sm:flex-row gap-3 justify-center lg:justify-start">
                        <a href="#bi" class="px-6 py-3.5 bg-white text-navy font-bold rounded shadow hover:bg-gray-100 transition-colors text-sm sm:text-base border border-transparent hover:border-teal" data-i18n="hero_btn_vision">
                            Ver Dashboard Interactivo
                        </a>
                        <a href="#ai-simulator" class="px-6 py-3.5 bg-indigo-600 text-white font-bold rounded shadow-lg shadow-indigo-500/30 hover:bg-indigo-700 transition-colors text-sm sm:text-base flex items-center gap-2 justify-center">
                            <i class="fas fa-robot"></i> <span data-i18n="hero_btn_ai">Probar AI Simulator</span>
                        </a>
                    </div>
                </div>
                <div class="order-1 lg:order-2 flex justify-center lg:justify-end">
                    <div class="relative w-full max-w-sm lg:max-w-md">
                        <div class="absolute inset-0 border-2 border-teal rounded-2xl transform translate-x-3 translate-y-3"></div>
                        <img src="https://drive.google.com/thumbnail?id=1VWqk33PEasus2aWjckWVViojvVw-cajS&sz=w1000" alt="Dr. Edgar Ivan Bañuelos Han" class="relative rounded-2xl shadow-2xl w-full h-auto object-cover z-10 aspect-[4/5] object-top grayscale hover:grayscale-0 transition-all duration-700 ease-in-out bg-gray-800">
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION: ESTRATEGIA (Optimizado para Ingenieros) -->
    <section id="about" class="py-24 bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center max-w-3xl mx-auto mb-16">
                <h2 class="text-3xl lg:text-4xl font-heading font-bold text-navy mb-4" data-i18n="about_title">Ingeniería de Salud Operativa y <span class="text-teal">Mejora Continua.</span></h2>
                <div class="w-24 h-1 bg-sky mx-auto rounded mb-6"></div>
                <!-- UPDATED: Added hyphens-none class -->
                <p class="text-lg text-gray-600 leading-relaxed text-justify px-4 lg:px-0 hyphens-none" data-i18n="about_desc">Integro principios de medicina laboral con metodologías de ingeniería (Lean Six Sigma, Análisis de Causa Raíz) para transformar la salud en un KPI medible. Mi enfoque no es solo clínico, es estructural: optimizo procesos para garantizar continuidad operativa y cumplimiento ISO/STPS.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div class="p-8 rounded-xl bg-slate border border-gray-100 hover:shadow-xl transition-shadow group">
                    <div class="w-14 h-14 bg-navy rounded-lg flex items-center justify-center mb-6 group-hover:bg-sky transition-colors"><i class="fas fa-clipboard-check text-white text-2xl"></i></div>
                    <h3 class="text-xl font-heading font-bold text-navy mb-3" data-i18n="card1_title">Auditoría & Estándares</h3>
                    <!-- UPDATED: Added hyphens-none class -->
                    <p class="text-gray-600 text-sm leading-relaxed text-justify hyphens-none" data-i18n="card1_desc">Competencias probadas en ISO 9001, 19011 y 45001. Gestión basada en evidencia para "Zero Fines" en inspecciones STPS.</p>
                </div>
                <div class="p-8 rounded-xl bg-slate border border-gray-100 hover:shadow-xl transition-shadow group">
                    <div class="w-14 h-14 bg-navy rounded-lg flex items-center justify-center mb-6 group-hover:bg-teal transition-colors"><i class="fas fa-chart-line text-white text-2xl"></i></div>
                    <h3 class="text-xl font-heading font-bold text-navy mb-3" data-i18n="card2_title">ROI & Siniestralidad</h3>
                    <!-- UPDATED: Added hyphens-none class -->
                    <p class="text-gray-600 text-sm leading-relaxed text-justify hyphens-none" data-i18n="card2_desc">Control agresivo de formatos ST-7/ST-9 ante el IMSS. Reducción directa de la Prima de Riesgo mediante análisis de datos y prevención técnica.</p>
                </div>
                <div class="p-8 rounded-xl bg-slate border border-gray-100 hover:shadow-xl transition-shadow group">
                    <div class="w-14 h-14 bg-navy rounded-lg flex items-center justify-center mb-6 group-hover:bg-sky transition-colors"><i class="fas fa-hard-hat text-white text-2xl"></i></div>
                    <h3 class="text-xl font-heading font-bold text-navy mb-3" data-i18n="card3_title">Seguridad Operativa</h3>
                    <!-- UPDATED: Added hyphens-none class -->
                    <p class="text-gray-600 text-sm leading-relaxed text-justify hyphens-none" data-i18n="card3_desc">Gestión de riesgos en entornos de alta demanda (Aviación, Logística). Protocolos de fatiga y aptitud psicofísica para personal crítico.</p>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION: NORMATIVIDAD (Híbrido: Legal + ISO + Procesos) -->
    <section id="legal-shield" class="py-24 bg-slate-50 relative overflow-hidden">
        <div class="absolute top-0 left-0 w-full h-full overflow-hidden pointer-events-none">
            <div class="absolute -top-24 -left-24 w-96 h-96 bg-gray-200 rounded-full mix-blend-multiply filter blur-3xl opacity-50"></div>
            <div class="absolute -bottom-24 -right-24 w-96 h-96 bg-gray-200 rounded-full mix-blend-multiply filter blur-3xl opacity-50"></div>
        </div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="text-center mb-16">
                <span class="text-teal font-bold tracking-widest uppercase text-xs" data-i18n="legal_badge">COMPLIANCE & EHS</span>
                <h2 class="text-3xl lg:text-4xl font-heading font-bold text-navy mt-2 mb-6" data-i18n="legal_title">Marco Normativo: <span class="text-indigo-600">Datos, ISO & STPS</span></h2>
                <p class="text-gray-600 max-w-2xl mx-auto text-lg" data-i18n="legal_desc">
                    Un sistema de gestión integrado que une la seguridad jurídica (LFPDPPP) con la excelencia operativa (ISO/Lean). Protejo la licencia sanitaria y optimizo los procesos de EHS.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                <!-- Card 1: ISO & Lean -->
                <div class="bg-white rounded-xl shadow-lg border-b-4 border-teal p-6 hover:transform hover:-translate-y-2 transition-all duration-300">
                    <div class="flex items-center justify-between mb-4">
                        <span class="font-bold text-2xl text-gray-200">01</span>
                        <i class="fas fa-project-diagram text-teal text-2xl"></i>
                    </div>
                    <h3 class="font-heading font-bold text-navy text-lg mb-2">Sistemas de Gestión</h3>
                    <p class="text-sm text-gray-600 mb-4" data-i18n="legal_c1_desc">Auditoría interna ISO 45001/9001 y mejora continua con Lean Six Sigma.</p>
                    <ul class="text-xs text-gray-500 space-y-2">
                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i> ISO 45001:2018</li>
                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i> Lean Six Sigma</li>
                    </ul>
                </div>

                <!-- Card 2: LFPDPPP (Datos) -->
                <div class="bg-white rounded-xl shadow-lg border-b-4 border-indigo-500 p-6 hover:transform hover:-translate-y-2 transition-all duration-300">
                    <div class="flex items-center justify-between mb-4">
                        <span class="font-bold text-2xl text-gray-200">02</span>
                        <i class="fas fa-user-shield text-indigo-500 text-2xl"></i>
                    </div>
                    <h3 class="font-heading font-bold text-navy text-lg mb-2">Privacidad de Datos</h3>
                    <p class="text-sm text-gray-600 mb-4" data-i18n="legal_c2_desc">Cumplimiento estricto de LFPDPPP para manejo de datos sensibles de colaboradores.</p>
                    <ul class="text-xs text-gray-500 space-y-2">
                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i> Avisos de Privacidad</li>
                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i> Derechos ARCO</li>
                    </ul>
                </div>

                <!-- Card 3: NOM-004 Expediente -->
                <div class="bg-white rounded-xl shadow-lg border-b-4 border-orange-500 p-6 hover:transform hover:-translate-y-2 transition-all duration-300">
                    <div class="flex items-center justify-between mb-4">
                        <span class="font-bold text-2xl text-gray-200">03</span>
                        <i class="fas fa-file-medical text-orange-500 text-2xl"></i>
                    </div>
                    <h3 class="font-heading font-bold text-navy text-lg mb-2" data-i18n="legal_c3_title">NOM-004-SSA3</h3>
                    <p class="text-sm text-gray-600 mb-4" data-i18n="legal_c3_desc">Integración clínica robusta para defensa legal ante controversias o auditorías sanitarias.</p>
                    <ul class="text-xs text-gray-500 space-y-2">
                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i> Trazabilidad Legal</li>
                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i> Custodia 5 Años</li>
                    </ul>
                </div>

                <!-- Card 4: Normas STPS -->
                <div class="bg-white rounded-xl shadow-lg border-b-4 border-navy p-6 hover:transform hover:-translate-y-2 transition-all duration-300">
                    <div class="flex items-center justify-between mb-4">
                        <span class="font-bold text-2xl text-gray-200">04</span>
                        <i class="fas fa-helmet-safety text-navy text-2xl"></i>
                    </div>
                    <h3 class="font-heading font-bold text-navy text-lg mb-2" data-i18n="legal_c4_title">Normatividad STPS</h3>
                    <p class="text-sm text-gray-600 mb-4" data-i18n="legal_c4_desc">Implementación técnica de NOMs críticas para seguridad e higiene industrial.</p>
                    <ul class="text-xs text-gray-500 space-y-2">
                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i> NOM-030 (Servicios Prev.)</li>
                        <li class="flex items-center gap-2"><i class="fas fa-check text-green-500"></i> NOM-035 / NOM-036</li>
                    </ul>
                </div>
            </div>

            <!-- Bottom CTA / Compliance Seal -->
            <div class="mt-16 bg-white rounded-2xl p-8 shadow-xl border border-gray-100 flex flex-col md:flex-row items-center justify-between gap-8">
                <div class="flex items-center gap-6">
                    <div class="w-16 h-16 bg-indigo-100 rounded-full flex items-center justify-center text-indigo-600 text-3xl">
                        <i class="fas fa-file-contract"></i>
                    </div>
                    <div>
                        <h4 class="font-heading font-bold text-navy text-xl" data-i18n="legal_cta_title">¿Listo para una auditoría?</h4>
                        <p class="text-sm text-gray-600" data-i18n="legal_cta_desc">Simulacros de inspección STPS y auditoría de expedientes clínicos para asegurar cumplimiento total.</p>
                    </div>
                </div>
                <a href="#contact" class="px-8 py-4 bg-navy text-white font-bold rounded-lg shadow-lg hover:bg-teal transition-all duration-300 whitespace-nowrap" data-i18n="legal_btn">
                    Auditar Cumplimiento
                </a>
            </div>
        </div>
    </section>

    <!-- SECTION: BUSINESS INTELLIGENCE -->
    <section id="bi" class="py-24 bg-slate relative">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl lg:text-4xl font-heading font-bold text-navy mb-6" data-i18n="bi_title">Decisiones basadas en datos.<br><span class="text-sky">No en suposiciones.</span></h2>
                <p class="text-gray-600 max-w-2xl mx-auto leading-relaxed" data-i18n="bi_desc">Interactúa con este simulador real para ver cómo transformo indicadores médicos en decisiones financieras y operativas.</p>
            </div>

            <div class="bg-white rounded-2xl shadow-2xl border border-gray-200 overflow-hidden flex flex-col md:flex-row min-h-[750px]">
                
                <!-- SIDEBAR -->
                <div class="w-full md:w-64 bg-navy text-white p-6 flex flex-col">
                    <div class="mb-10 flex items-center gap-3 px-2">
                        <span class="font-heading font-bold text-lg tracking-wide block">DR. HAN</span>
                        <span class="text-[10px] text-teal tracking-wider uppercase">Analytics</span>
                    </div>
                    <nav class="space-y-2 flex-1">
                        <button onclick="switchDashTab('general')" id="tab-general" class="dash-sidebar-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg active text-left"><i class="fas fa-chart-pie w-5"></i> <span data-i18n="bi_btn_general">Dashboard General</span></button>
                        <button onclick="switchDashTab('nom035')" id="tab-nom035" class="dash-sidebar-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 text-left"><i class="fas fa-brain w-5"></i> <span data-i18n="bi_btn_035">Psicosocial NOM-035</span></button>
                        <button onclick="switchDashTab('riesgos')" id="tab-riesgos" class="dash-sidebar-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 text-left"><i class="fas fa-people-carry-box w-5"></i> <span data-i18n="bi_btn_036">Ergonomía NOM-036</span></button>
                        <button onclick="switchDashTab('iso45001')" id="tab-iso45001" class="dash-sidebar-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 text-left"><i class="fas fa-clipboard-check w-5"></i> <span data-i18n="bi_btn_iso">Gestión ISO 45001</span></button>
                        <button onclick="switchDashTab('wellness')" id="tab-wellness" class="dash-sidebar-btn w-full flex items-center space-x-3 px-4 py-3 rounded-lg text-gray-400 text-left"><i class="fas fa-heart-pulse w-5"></i> <span data-i18n="bi_btn_wellness">Wellness & Retención</span></button>
                    </nav>
                </div>

                <!-- MAIN CONTENT -->
                <div class="flex-1 bg-slate-50 p-6 md:p-8 overflow-y-auto">
                    <!-- CONTROLS -->
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
                        <div>
                            <h3 class="text-xl font-heading font-bold text-navy" id="dash-title" data-i18n="dash_header_title">Centro de Comando Estratégico</h3>
                            <p class="text-gray-400 text-xs mt-1" data-i18n="dash_header_status">Status: En línea • Datos actualizados</p>
                        </div>
                        <div class="flex items-center space-x-3">
                            <div class="flex items-center gap-4 bg-white p-2 rounded-lg shadow-sm border border-gray-200 mr-2">
                                <div class="text-right hidden sm:block">
                                    <span class="block text-[10px] font-bold text-gray-400 uppercase tracking-wide" data-i18n="dash_toggle_label">Estrategia</span>
                                    <span id="strategy-label" class="text-xs font-bold text-teal transition-colors">Con Gestión Dr. Han</span>
                                </div>
                                <div class="relative inline-block w-12 mr-2 align-middle select-none transition duration-200 ease-in">
                                    <input type="checkbox" name="toggle" id="han-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer border-gray-300" checked/>
                                    <label for="han-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"></label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- VIEWS -->
                    <div id="view-general" class="dash-view animate-fade-in">
                         <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-5 mb-8">
                            <div class="kpi-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden group">
                                <div class="absolute top-0 left-0 w-full h-1 bg-red-500 transition-colors duration-300" id="kpi-days-bar"></div>
                                <div class="flex justify-between items-start mb-2"><span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="kpi_days">Días Incapacidad</span><div class="w-8 h-8 rounded-lg bg-red-50 flex items-center justify-center text-red-500 transition-colors duration-300" id="kpi-days-icon"><i class="fas fa-bed-pulse"></i></div></div>
                                <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-days">42</h4>
                            </div>
                            <div class="kpi-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden group">
                                <div class="absolute top-0 left-0 w-full h-1 bg-teal transition-colors duration-300" id="kpi-compliance-bar"></div>
                                <div class="flex justify-between items-start mb-2"><span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="kpi_compliance">Cumplimiento ISO</span><div class="w-8 h-8 rounded-lg bg-teal/10 flex items-center justify-center text-teal transition-colors duration-300" id="kpi-compliance-icon"><i class="fas fa-check-circle"></i></div></div>
                                <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-compliance">98%</h4>
                            </div>
                            <!-- MODIFIED KPI 1: BURNOUT -->
                            <div class="kpi-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden group">
                                <div class="absolute top-0 left-0 w-full h-1 bg-sky transition-colors duration-300" id="kpi-risk-bar"></div>
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="kpi_risk">Índice de Burnout (035)</span>
                                    <div class="w-8 h-8 rounded-lg bg-sky/10 flex items-center justify-center text-sky transition-colors duration-300" id="kpi-risk-icon">
                                        <i class="fas fa-fire-flame-curved"></i>
                                    </div>
                                </div>
                                <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-risk">2.1</h4>
                            </div>
                            <!-- MODIFIED KPI 2: ROTACIÓN -->
                            <div class="kpi-card bg-white p-5 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden group">
                                <div class="absolute top-0 left-0 w-full h-1 bg-orange-400 transition-colors duration-300" id="kpi-cost-bar"></div>
                                <div class="flex justify-between items-start mb-2">
                                    <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="kpi_cost">Riesgo de Rotación</span>
                                    <div class="w-8 h-8 rounded-lg bg-orange-50 flex items-center justify-center text-orange-500 transition-colors duration-300" id="kpi-cost-icon">
                                        <i class="fas fa-person-walking-dashed"></i>
                                    </div>
                                </div>
                                <h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-cost">Bajo</h4>
                            </div>
                        </div>
                        <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 mb-8">
                            <h5 class="font-bold text-navy mb-4 text-sm flex items-center"><i class="fas fa-chart-area text-sky mr-2"></i> <span data-i18n="chart_trend_title">Tendencia</span></h5>
                            <div class="h-64 w-full"><canvas id="trendChart"></canvas></div>
                        </div>
                    </div>

                    <div id="view-nom035" class="dash-view hidden animate-fade-in">
                        <div class="bg-white p-6 rounded-xl border border-gray-100 shadow-sm mb-8 flex flex-col md:flex-row justify-between items-center gap-6">
                            <div class="flex-1 w-full">
                                <div class="flex justify-between items-end mb-2"><div><h4 class="text-lg font-heading font-bold text-navy" data-i18n="kpi_035_target">Objetivo de Cumplimiento NOM-035</h4></div><span class="text-2xl font-bold text-indigo-600" id="kpi-035-progress">92%</span></div>
                                <div class="w-full bg-gray-100 rounded-full h-3"><div class="bg-indigo-600 h-3 rounded-full" style="width: 92%" id="progress-bar-035"></div></div>
                            </div>
                        </div>
                        <div class="grid lg:grid-cols-2 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><div class="h-72 w-full flex items-center justify-center"><canvas id="nom035RadarChart"></canvas></div></div>
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><div class="h-72 w-full flex items-center justify-center"><canvas id="nom035PieChart"></canvas></div></div>
                        </div>
                    </div>

                    <div id="view-riesgos" class="dash-view hidden animate-fade-in">
                        <!-- Estación de Ergonomía (Simplificada visualmente) -->
                         <div class="grid lg:grid-cols-12 gap-6 mb-8">
                            <!-- Panel Control -->
                            <div class="lg:col-span-6 bg-navy text-white p-6 rounded-xl shadow-xl border border-gray-800 h-full">
                                <div class="flex items-center justify-between mb-6">
                                    <h3 class="font-heading font-bold text-lg flex items-center gap-2 text-white"><i class="fas fa-sliders text-teal"></i> <span data-i18n="sim_panel_title">Panel de Variables</span></h3>
                                    <!-- MODIFICACIÓN: Métodos añadidos -->
                                    <select id="sim-method-select" class="bg-white text-gray-900 text-[10px] px-3 py-1.5 rounded font-bold uppercase cursor-pointer hover:bg-gray-100 transition-colors">
                                        <option value="nom036">NOM-036-1 (MAC)</option>
                                        <option value="rula">RULA (Upper Limb)</option>
                                        <option value="reba">REBA (Entire Body)</option>
                                    </select>
                                </div>
                                <div id="inputs-nom036" class="space-y-5">
                                    <div class="bg-slate-800/50 p-4 rounded-lg border border-white/5">
                                        <div class="flex justify-between mb-3 text-xs items-center"><span class="text-gray-300 font-bold uppercase" data-i18n="sim_load">Carga Física</span><span class="font-mono font-bold text-teal bg-teal/10 px-2 py-0.5 rounded" id="sim-weight-val">20 kg</span></div>
                                        <input type="range" min="2" max="50" value="20" id="sim-weight" class="w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-teal mb-4">
                                        <div class="grid grid-cols-3 gap-2">
                                            <button class="sim-btn-freq flex flex-col items-center justify-center py-2.5 rounded-lg border shadow-lg bg-teal border-teal text-white" data-val="low"><span class="text-[10px] font-bold" data-i18n="sim_freq_low">Baja</span></button>
                                            <button class="sim-btn-freq flex flex-col items-center justify-center py-2.5 rounded-lg border border-slate-700 bg-slate-800/50 text-gray-400" data-val="med"><span class="text-[10px] font-bold" data-i18n="sim_freq_med">Media</span></button>
                                            <button class="sim-btn-freq flex flex-col items-center justify-center py-2.5 rounded-lg border border-slate-700 bg-slate-800/50 text-gray-400" data-val="high"><span class="text-[10px] font-bold" data-i18n="sim_freq_high">Alta</span></button>
                                        </div>
                                    </div>
                                    <div class="space-y-3">
                                        <select id="sim-h-dist" class="w-full bg-white text-gray-900 text-xs py-2.5 px-3 rounded-lg"><option value="close" data-i18n="sim_opt_close">Cerca</option><option value="med" data-i18n="sim_opt_med">Media</option><option value="far" data-i18n="sim_opt_far">Lejos</option></select>
                                        <select id="sim-v-pos" class="w-full bg-white text-gray-900 text-xs py-2.5 px-3 rounded-lg"><option value="ideal" data-i18n="sim_opt_knuckle">Nudillos</option><option value="bad" data-i18n="sim_opt_shoulder">Hombros</option><option value="crit" data-i18n="sim_opt_floor">Suelo</option></select>
                                        <select id="sim-grip" class="w-full bg-white text-gray-900 text-xs py-2 px-3 rounded-lg"><option value="good" data-i18n="sim_opt_good">Bueno</option><option value="fair" data-i18n="sim_opt_fair">Regular</option></select>
                                    </div>
                                </div>
                                <div id="inputs-rula" class="space-y-4 hidden">
                                   <!-- Upper Arm -->
                                   <div class="space-y-1">
                                       <label class="text-[10px] font-bold text-gray-400 uppercase" data-i18n="sim_rula_arm">Brazo (Hombro)</label>
                                       <select id="rula-arm" class="w-full bg-white text-gray-900 text-xs py-2 px-3 rounded-lg text-black">
                                           <option value="1">Neutral (0-20°)</option>
                                           <option value="2">Flexión Leve (>20°)</option>
                                           <option value="3">Elevado (45-90°)</option>
                                           <option value="4">Extremo (>90°)</option>
                                       </select>
                                   </div>
                                   <!-- Neck/Trunk -->
                                   <div class="space-y-1">
                                       <label class="text-[10px] font-bold text-gray-400 uppercase" data-i18n="sim_rula_neck">Cuello / Tronco</label>
                                       <select id="rula-neck-trunk" class="w-full bg-white text-gray-900 text-xs py-2 px-3 rounded-lg text-black">
                                           <option value="1">Alineados</option>
                                           <option value="2">Inclinación <20°</option>
                                           <option value="3">Inclinación >20°</option>
                                           <option value="4">Torsión/Lateral</option>
                                       </select>
                                   </div>
                                   <!-- Load/Activity -->
                                    <div class="bg-slate-800/50 p-3 rounded-lg border border-white/5">
                                        <div class="flex justify-between mb-2 text-xs items-center"><span class="text-gray-300 font-bold uppercase" data-i18n="sim_load">Carga/Fuerza</span></div>
                                         <select id="rula-load" class="w-full bg-white text-gray-900 text-xs py-2 px-3 rounded border border-slate-600 text-black">
                                           <option value="0">< 2 kg (Intermitente)</option>
                                           <option value="1">2 - 10 kg</option>
                                           <option value="2">2 - 10 kg (Estático)</option>
                                           <option value="3">> 10 kg</option>
                                       </select>
                                    </div>
                                </div>
                                <div id="inputs-reba" class="space-y-4 hidden">
                                    <!-- Trunk -->
                                    <div class="space-y-1">
                                        <label class="text-[10px] font-bold text-gray-400 uppercase" data-i18n="sim_reba_trunk">Tronco</label>
                                        <select id="reba-trunk" class="w-full bg-white text-gray-900 text-xs py-2 px-3 rounded-lg text-black">
                                            <option value="1">Erguido</option>
                                            <option value="2">Flexión 0-20°</option>
                                            <option value="3">Flexión 20-60°</option>
                                            <option value="4">Flexión >60°</option>
                                        </select>
                                    </div>
                                    <!-- Legs -->
                                    <div class="space-y-1">
                                        <label class="text-[10px] font-bold text-gray-400 uppercase" data-i18n="sim_reba_legs">Piernas</label>
                                        <select id="reba-legs" class="w-full bg-white text-gray-900 text-xs py-2 px-3 rounded-lg text-black">
                                            <option value="1">Soporte Bilateral</option>
                                            <option value="2">Soporte Unilateral</option>
                                        </select>
                                    </div>
                                    <!-- Load -->
                                     <div class="bg-slate-800/50 p-3 rounded-lg border border-white/5">
                                         <div class="flex justify-between mb-2 text-xs items-center"><span class="text-gray-300 font-bold uppercase" data-i18n="sim_load">Carga/Fuerza</span></div>
                                          <select id="reba-load" class="w-full bg-white text-gray-900 text-xs py-2 px-3 rounded border border-slate-600 text-black">
                                            <option value="0">< 5 kg</option>
                                            <option value="1">5 - 10 kg</option>
                                            <option value="2">> 10 kg</option>
                                        </select>
                                     </div>
                                 </div>
                            </div>
                            <!-- Visualizador -->
                            <div class="lg:col-span-6 bg-white p-6 rounded-xl shadow-xl border border-gray-200 flex flex-col justify-center items-center text-center relative overflow-hidden h-full">
                                <h4 class="font-bold text-gray-400 text-xs uppercase tracking-widest absolute top-6 left-0 w-full text-center" data-i18n="sim_risk_title">Nivel de Riesgo Detectado</h4>
                                <div class="my-6">
                                    <div class="w-48 h-48 rounded-full border-8 flex items-center justify-center mb-4 mx-auto bg-gray-50" id="score-circle">
                                        <div><span class="text-6xl font-heading font-extrabold block" id="score-number">0</span></div>
                                    </div>
                                    <h3 class="text-3xl font-heading font-extrabold mb-1" id="score-label">RIESGO BAJO</h3>
                                    <!-- ELEMENTO AÑADIDO PARA MOSTRAR MÉTODO -->
                                    <p class="text-sm font-bold text-navy mt-1" id="sim-method-display">NOM-036-1 (MAC)</p>
                                </div>
                                <div class="w-full max-w-sm h-4 bg-gray-100 rounded-full overflow-hidden mt-auto relative"><div id="risk-fill-bar" class="h-full bg-green-500 transition-all duration-700 ease-out" style="width: 0%"></div></div>
                            </div>
                        </div>
                    </div>

                    <div id="view-iso45001" class="dash-view hidden animate-fade-in">
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                             <div class="kpi-card bg-white p-6 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-blue-50 rounded-bl-full -mr-4 -mt-4"></div>
                                <div><span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="iso_kpi_adherence">Adherencia Global</span><h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-iso-adherence">94%</h4></div>
                                <span class="text-xs text-blue-600 font-bold bg-blue-50 py-1 px-2 rounded w-fit mt-2" data-i18n="iso_status_cert">Certificable</span>
                            </div>
                            <div class="kpi-card bg-white p-6 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-orange-50 rounded-bl-full -mr-4 -mt-4"></div>
                                <div><span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="iso_kpi_nc">No Conformidades</span><h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-iso-nc">0</h4></div>
                                <span class="text-xs text-gray-500 mt-2" data-i18n="iso_nc_critical">Mayores (Críticas)</span>
                            </div>
                            <div class="kpi-card bg-white p-6 rounded-xl border border-gray-100 shadow-sm relative overflow-hidden">
                                <div class="absolute top-0 right-0 w-16 h-16 bg-teal/5 rounded-bl-full -mr-4 -mt-4"></div>
                                <div><span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest" data-i18n="iso_kpi_review">Rev. Dirección</span><h4 class="text-3xl font-heading font-bold text-navy mb-1" id="kpi-iso-review">OK</h4></div>
                            </div>
                        </div>

                        <div class="grid lg:grid-cols-12 gap-6 mb-8">
                            <div class="lg:col-span-4 bg-navy text-white p-6 rounded-xl shadow-xl border border-gray-800 flex flex-col h-full relative overflow-hidden">
                                <div class="flex items-center justify-between mb-4"><h3 class="font-heading font-bold text-lg text-white" data-i18n="iso_panel_title">Panel de Auditoría</h3><span class="text-[10px] uppercase font-bold text-gray-400 border border-gray-600 px-2 py-0.5 rounded">Anexo SL</span></div>
                                <div class="flex-1 overflow-y-auto pr-2 custom-scrollbar space-y-5">
                                    <div class="space-y-4">
                                        <div class="border-b border-gray-700 pb-2 mb-2"><span class="text-[10px] font-bold text-blue-400 uppercase tracking-widest" data-i18n="iso_maturity">Nivel de Madurez</span></div>
                                        <div><div class="flex justify-between text-xs mb-1"><label class="text-gray-300 font-bold" data-i18n="iso_4_context">4. Contexto</label><span class="text-blue-400 font-mono font-bold" id="val-iso-4">100%</span></div><input type="range" id="iso-in-4" min="0" max="100" value="100" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500"></div>
                                        <div><div class="flex justify-between text-xs mb-1"><label class="text-gray-300 font-bold" data-i18n="iso_5_leadership">5. Liderazgo</label><span class="text-blue-400 font-mono font-bold" id="val-iso-5">95%</span></div><input type="range" id="iso-in-5" min="0" max="100" value="95" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500"></div>
                                        <div><div class="flex justify-between text-xs mb-1"><label class="text-gray-300 font-bold" data-i18n="iso_6_planning">6. Planificación</label><span class="text-blue-400 font-mono font-bold" id="val-iso-6">90%</span></div><input type="range" id="iso-in-6" min="0" max="100" value="90" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500"></div>
                                        <div><div class="flex justify-between text-xs mb-1"><label class="text-gray-300 font-bold" data-i18n="iso_7_support">7. Apoyo</label><span class="text-blue-400 font-mono font-bold" id="val-iso-7">92%</span></div><input type="range" id="iso-in-7" min="0" max="100" value="92" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500"></div>
                                        <div><div class="flex justify-between text-xs mb-1"><label class="text-gray-300 font-bold" data-i18n="iso_8_ops">8. Operación</label><span class="text-blue-400 font-mono font-bold" id="val-iso-8">98%</span></div><input type="range" id="iso-in-8" min="0" max="100" value="98" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500"></div>
                                        <div><div class="flex justify-between text-xs mb-1"><label class="text-gray-300 font-bold" data-i18n="iso_9_perf">9. Evaluación</label><span class="text-blue-400 font-mono font-bold" id="val-iso-9">90%</span></div><input type="range" id="iso-in-9" min="0" max="100" value="90" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500"></div>
                                        <div><div class="flex justify-between text-xs mb-1"><label class="text-gray-300 font-bold" data-i18n="iso_10_improv">10. Mejora</label><span class="text-blue-400 font-mono font-bold" id="val-iso-10">88%</span></div><input type="range" id="iso-in-10" min="0" max="100" value="88" class="w-full h-1.5 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-blue-500"></div>
                                    </div>
                                    <div class="pt-4 border-t border-gray-700 mt-4">
                                        <div class="flex items-center gap-2 mb-3"><i class="fas fa-shield-halved text-orange-500"></i><label class="text-[10px] font-bold text-orange-400 uppercase tracking-widest" data-i18n="iso_crit_controls">Controles Críticos</label></div>
                                        <div class="space-y-3 bg-slate-800/50 p-3 rounded-lg border border-gray-700">
                                            <div class="flex items-center justify-between group"><span class="text-xs text-gray-200 font-medium" data-i18n="iso_cc_consult">Consulta (5.4)</span><input type="checkbox" id="iso-check-consult" class="accent-blue-500 w-4 h-4" checked></div>
                                            <div class="flex items-center justify-between group"><span class="text-xs text-gray-200 font-medium" data-i18n="iso_cc_legal">Matriz Legal (6.1.3)</span><input type="checkbox" id="iso-check-legal" class="accent-blue-500 w-4 h-4" checked></div>
                                            <div class="flex items-center justify-between group"><span class="text-xs text-gray-200 font-medium" data-i18n="iso_cc_emerg">Emergencias (8.2)</span><input type="checkbox" id="iso-check-emergency" class="accent-blue-500 w-4 h-4" checked></div>
                                            <div class="flex items-center justify-between group"><span class="text-xs text-gray-200 font-medium" data-i18n="iso_cc_review">Revisión Dirección (9.3)</span><input type="checkbox" id="iso-check-mgmt" class="accent-blue-500 w-4 h-4" checked></div>
                                        </div>
                                    </div>
                                    <div class="pt-4 border-t border-gray-700 mt-2">
                                        <div class="flex justify-between items-center mb-3"><label class="text-red-400 font-bold uppercase text-[10px] tracking-widest" data-i18n="iso_findings_major">Hallazgos Mayores</label></div>
                                        <div class="flex items-center gap-0 mb-3 bg-slate-900 rounded-lg border border-gray-700 overflow-hidden group transition-colors shadow-inner" id="nc-container">
                                            <button class="w-10 h-10 flex items-center justify-center bg-slate-800 text-white font-bold border-r border-gray-700" onclick="adjustNC(-1)"><i class="fas fa-minus text-xs"></i></button>
                                            <div class="flex-1 text-center relative h-10 flex items-center justify-center"><input type="number" id="iso-in-nc" value="0" min="0" class="w-full bg-transparent text-center text-white text-xl font-heading font-bold focus:outline-none z-10 relative appearance-none m-0" readonly></div>
                                            <button class="w-10 h-10 flex items-center justify-center bg-slate-800 text-white font-bold border-l border-gray-700" onclick="adjustNC(1)"><i class="fas fa-plus text-xs"></i></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="lg:col-span-8 grid grid-rows-2 gap-6">
                                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 relative">
                                    <h5 class="font-bold text-navy mb-4 text-sm flex items-center justify-between"><span class="flex items-center"><i class="fas fa-project-diagram text-blue-600 mr-2"></i> <span data-i18n="chart_iso_radar_title">Nivel de Madurez (Anexo SL)</span></span></h5>
                                    <div class="h-64 w-full flex items-center justify-center"><canvas id="isoRadarChart"></canvas></div>
                                </div>
                                <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100 flex flex-col">
                                    <h5 class="font-bold text-navy mb-4 text-sm flex items-center justify-between"><span class="flex items-center"><i class="fas fa-rotate text-teal mr-2"></i> Ciclo PHVA (PDCA)</span></h5>
                                    <div class="flex-1 flex flex-col justify-center space-y-3">
                                        <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center font-bold text-xs">P</div><div class="flex-1"><div class="w-full bg-gray-100 rounded-full h-1.5"><div id="phva-p-bar" class="bg-blue-500 h-1.5 rounded-full transition-all duration-500" style="width: 95%"></div></div></div><span class="text-[10px] font-bold text-blue-600" id="phva-p-val">95%</span></div>
                                        <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-teal/20 text-teal flex items-center justify-center font-bold text-xs">H</div><div class="flex-1"><div class="w-full bg-gray-100 rounded-full h-1.5"><div id="phva-d-bar" class="bg-teal h-1.5 rounded-full transition-all duration-500" style="width: 95%"></div></div></div><span class="text-[10px] font-bold text-teal" id="phva-d-val">95%</span></div>
                                        <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-orange-100 text-orange-500 flex items-center justify-center font-bold text-xs">V</div><div class="flex-1"><div class="w-full bg-gray-100 rounded-full h-1.5"><div id="phva-c-bar" class="bg-orange-500 h-1.5 rounded-full transition-all duration-500" style="width: 90%"></div></div></div><span class="text-[10px] font-bold text-orange-500" id="phva-c-val">90%</span></div>
                                        <div class="flex items-center gap-3"><div class="w-8 h-8 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center font-bold text-xs">A</div><div class="flex-1"><div class="w-full bg-gray-100 rounded-full h-1.5"><div id="phva-a-bar" class="bg-purple-600 h-1.5 rounded-full transition-all duration-500" style="width: 88%"></div></div></div><span class="text-[10px] font-bold text-purple-600" id="phva-a-val">88%</span></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div id="view-wellness" class="dash-view hidden animate-fade-in">
                        <div class="grid lg:grid-cols-2 gap-6 mb-8">
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><h5 class="font-bold text-navy mb-4 text-sm" data-i18n="chart_bmi_title">Distribución IMC</h5><div class="h-64 w-full flex items-center justify-center"><canvas id="wellnessBMIChart"></canvas></div></div>
                            <div class="bg-white p-6 rounded-xl shadow-sm border border-gray-100"><h5 class="font-bold text-navy mb-4 text-sm" data-i18n="chart_chronic_title">Top Patologías</h5><div class="h-64 w-full"><canvas id="wellnessChronicChart"></canvas></div></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

     <!-- Documento Oficial / Reporte Ejecutivo (CONECTADO AL SIMULADOR) -->
    <section class="py-16 bg-white border-t border-gray-100" id="reporte-final-section">
        <div class="max-w-4xl mx-auto px-6 sm:px-8 bg-white shadow-xl rounded-none sm:rounded-lg border border-gray-200 min-h-[800px] relative overflow-hidden my-10 print:shadow-none print:border-none transition-all duration-500">
            <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-[600px] h-[600px] opacity-[0.03] pointer-events-none z-0">
                <img src="https://drive.google.com/thumbnail?id=1oqMOYFDdIc47CKLMa3xCSSvptH9aJyeC&sz=w200" class="w-full h-full object-contain filter grayscale" alt="Watermark">
            </div>
            <div class="relative z-10 p-8 sm:p-12">
                <div class="flex justify-between items-start border-b-2 border-navy pb-6 mb-8">
                    <div>
                        <h6 class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1" data-i18n="report_header_tag">Documento Oficial</h6>
                        <h2 class="text-2xl font-heading font-bold text-navy" data-i18n="report_title">Reporte Ejecutivo de Salud Corporativa</h2>
                        <p class="text-sm text-gray-500 mt-1"><span data-i18n="report_meta_period">Periodo: Enero - Junio 2026</span> | <span data-i18n="report_meta_for">Generado para:</span> <span class="font-bold text-navy" data-i18n="report_meta_target">Consejo Directivo</span></p>
                    </div>
                    <img src="https://drive.google.com/thumbnail?id=1oqMOYFDdIc47CKLMa3xCSSvptH9aJyeC&sz=w200" alt="Logo" class="h-12 w-auto" referrerpolicy="no-referrer">
                </div>
                <div class="grid grid-cols-3 gap-6 mb-10 bg-slate-50 p-6 rounded-lg border border-gray-100">
                    <div class="text-center border-r border-gray-200"><p class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1" data-i18n="rep_kpi_compliance">Estatus Normativo</p><p class="text-2xl font-bold text-navy" id="rep-compliance">98%</p></div>
                    <!-- MODIFIED REPORT KPI: TALENT RETENTION -->
                    <div class="text-center border-r border-gray-200">
                        <p class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1" data-i18n="rep_kpi_financial">Talento Retenido</p>
                        <p class="text-2xl font-bold text-navy" id="rep-savings">98%</p>
                    </div>
                    <div class="text-center"><p class="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1" data-i18n="rep_kpi_health">Salud Organizacional</p><p class="text-2xl font-bold text-navy" id="rep-health">8.4/10</p></div>
                </div>
                <div class="space-y-8" id="rep-body-content">
                    <!-- Contenido JS -->
                </div>
                <div class="mt-8 bg-indigo-50 border border-indigo-200 rounded-lg p-6 flex flex-col md:flex-row items-center justify-between gap-4">
                    <div><h5 class="font-bold text-navy text-sm" data-i18n="rep_cta_title">¿Su empresa enfrenta estos mismos desafíos?</h5><p class="text-xs text-gray-600" data-i18n="rep_cta_desc">Puedo implementar este mismo nivel de diagnóstico y solución en sus primeros 90 días.</p></div>
                    <a href="https://wa.me/525629846164" class="px-5 py-2.5 bg-navy text-white text-xs font-bold rounded shadow hover:bg-teal transition-colors whitespace-nowrap" data-i18n="rep_cta_btn">Agendar Diagnóstico Breve</a>
                </div>
                <div class="mt-16 pt-8 border-t border-gray-200 flex flex-col md:flex-row justify-between items-center gap-6">
                    <div class="text-xs text-gray-400"><p class="font-mono">ID Documento: DH-REP-2026-001</p><p data-i18n="rep_footer_conf">Este reporte es confidencial y para uso exclusivo de la dirección.</p></div>
                    <div class="flex items-center gap-4">
                         <div class="text-right"><p class="font-signature text-3xl text-navy mb-2 transform -rotate-2">Dr. Han</p><p class="font-bold text-navy text-sm">Dr. Edgar Ivan Bañuelos Han</p><p class="text-xs text-gray-500">Director Médico & Estratega</p></div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- NEW SECTION: GEMINI AI SIMULATOR -->
    <section id="ai-simulator" class="py-24 bg-gradient-to-br from-navy to-slate-900 relative text-white overflow-hidden">
        <div class="absolute inset-0 opacity-20">
            <div class="absolute top-10 left-10 w-64 h-64 bg-indigo-500 rounded-full blur-[100px]"></div>
            <div class="absolute bottom-10 right-10 w-96 h-96 bg-teal-500 rounded-full blur-[120px]"></div>
        </div>
        <div class="max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
            <div class="text-center mb-12">
                <span class="inline-block py-1 px-3 rounded-full bg-indigo-900/50 border border-indigo-500 text-indigo-300 text-xs font-bold tracking-widest mb-4 uppercase"><i class="fas fa-sparkles mr-1"></i> Powered by Gemini AI</span>
                <h2 class="text-3xl lg:text-4xl font-heading font-bold mb-4" data-i18n="ai_section_title">AI Strategic Simulator</h2>
                <p class="text-gray-300 text-lg max-w-2xl mx-auto text-justify lg:text-center" data-i18n="ai_desc">La tecnología es una extensión de la estrategia. Ingrese un desafío actual y obtenga un pre-análisis basado en datos y cumplimiento.</p>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-5 gap-8 bg-white/5 backdrop-blur-lg border border-white/10 rounded-2xl p-6 md:p-8 shadow-2xl">
                <div class="md:col-span-2 flex flex-col gap-4">
                    <label for="ai-input" class="text-sm font-bold text-gray-300 uppercase tracking-wide" data-i18n="ai_input_label">Describa un reto</label>
                    <!-- MODIFIED PLACEHOLDER -->
                    <textarea id="ai-input" rows="6" class="w-full bg-navy/50 border border-gray-600 rounded-lg p-4 text-white placeholder-gray-500 focus:outline-none focus:border-indigo-500 focus:ring-1 focus:ring-indigo-500 transition-all resize-none text-sm" placeholder="Ej: El área de ventas tiene alta rotación asociada a estrés. ¿Cómo lo mitigamos?" data-i18n="ai_input_placeholder"></textarea>
                    <button id="ai-generate-btn" class="w-full py-3 bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-500 hover:to-purple-500 text-white font-bold rounded-lg shadow-lg shadow-indigo-500/30 transition-all transform hover:scale-[1.02] flex items-center justify-center gap-2"><span data-i18n="ai_btn_generate">Generar estrategia ✨</span></button>
                    <p class="text-[10px] text-gray-500 text-center italic" data-i18n="ai_disclaimer">Modelo: Gemini 2.5 Flash. Respuesta generada en tiempo real.</p>
                </div>
                <div class="md:col-span-3 bg-white text-gray-800 rounded-lg p-6 relative min-h-[300px] flex flex-col">
                    <div class="border-b border-gray-200 pb-3 mb-4 flex justify-between items-center">
                        <div class="flex items-center gap-2"><div class="w-8 h-8 rounded-full bg-navy flex items-center justify-center text-white text-xs font-bold">DH</div><span class="font-heading font-bold text-navy text-sm" data-i18n="ai_preview_title">Strategic Report Preview</span></div>
                        <div id="ai-loader" class="hidden"><div class="flex space-x-1"><div class="w-2 h-2 bg-indigo-500 rounded-full animate-bounce"></div><div class="w-2 h-2 bg-indigo-500 rounded-full animate-bounce" style="animation-delay: 0.1s"></div><div class="w-2 h-2 bg-indigo-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div></div></div>
                    </div>
                    <div id="ai-result" class="text-sm leading-relaxed text-gray-600 flex-1 overflow-y-auto ai-response">
                        <p class="text-gray-400 italic text-center mt-10" data-i18n="ai_waiting_text">"Esperando input estratégico para iniciar análisis..."</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- SECTION: TRAYECTORIA -->
    <section id="trayectoria" class="py-24 bg-white relative">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-16">
                <span class="text-teal font-bold tracking-widest uppercase text-xs" data-i18n="career_badge">EXPERIENCIA & LIDERAZGO</span>
                <h2 class="text-3xl lg:text-4xl font-heading font-bold text-navy mt-2 mb-6" data-i18n="career_title">Trayectoria <span class="text-indigo-600">Profesional</span></h2>
                <p class="text-gray-600 max-w-2xl mx-auto text-lg" data-i18n="career_desc">
                    Más de 5 años de experiencia consolidada en gestión de servicios médicos corporativos, salud ocupacional y programas de bienestar.
                </p>
            </div>

            <div class="relative border-l-4 border-teal/20 ml-6 md:ml-12 space-y-12">
                <!-- Role 1: Aeroméxico -->
                <div class="relative pl-8 md:pl-12 group">
                    <div class="absolute -left-[14px] top-0 w-6 h-6 bg-navy rounded-full border-4 border-white shadow-lg group-hover:scale-125 transition-transform duration-300"></div>
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2">
                        <h3 class="text-xl font-heading font-bold text-navy" data-i18n="career_role1_title">Médico Ocupacional</h3>
                        <span class="text-xs font-bold text-teal bg-teal/10 px-3 py-1 rounded-full w-fit mt-2 sm:mt-0" data-i18n="career_role1_date">Julio 2023 - Abril 2025</span>
                    </div>
                    <h4 class="text-sm font-bold text-gray-500 mb-4 uppercase tracking-wide">Aeroméxico / Aeroméxico Cargo</h4>
                    <p class="text-gray-600 text-sm leading-relaxed" data-i18n="career_role1_desc">
                        Coordinación de evaluaciones médicas para tripulación y operativos de mantenimiento. Gestión integral de riesgos laborales (ST-7, ST-9, ST-2) y enlace con IMSS. Implementación de pruebas de seguridad crítica (fatiga, alcoholimetría).<br><br><strong>• Cobertura en Fresenius Kabi, DHL CEDIS y Walmart CEDIS.</strong>
                    </p>
                </div>

                <!-- Role 2: Grupo Vallarta Plus -->
                <div class="relative pl-8 md:pl-12 group">
                    <div class="absolute -left-[14px] top-0 w-6 h-6 bg-teal rounded-full border-4 border-white shadow-lg group-hover:scale-125 transition-transform duration-300"></div>
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2">
                        <h3 class="text-xl font-heading font-bold text-navy" data-i18n="career_role2_title">Especialista en Medicina Ocupacional (Proyecto)</h3>
                        <span class="text-xs font-bold text-gray-400 bg-gray-100 px-3 py-1 rounded-full w-fit mt-2 sm:mt-0" data-i18n="career_role2_date">Junio 2023 - Sep 2023</span>
                    </div>
                    <h4 class="text-sm font-bold text-gray-500 mb-4 uppercase tracking-wide">Grupo Vallarta Plus / GOPOST</h4>
                    <p class="text-gray-600 text-sm leading-relaxed" data-i18n="career_role2_desc">
                        Diseño e implementación del departamento de medicina laboral desde cero. Integración de protocolos médicos al reclutamiento, gestión de consentimientos informados y optimización de recursos médicos.
                    </p>
                </div>

                <!-- Role 3: Consulta Privada -->
                <div class="relative pl-8 md:pl-12 group">
                    <div class="absolute -left-[14px] top-0 w-6 h-6 bg-sky rounded-full border-4 border-white shadow-lg group-hover:scale-125 transition-transform duration-300"></div>
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2">
                        <h3 class="text-xl font-heading font-bold text-navy" data-i18n="career_role3_title">Médico General y Familiar</h3>
                        <span class="text-xs font-bold text-gray-400 bg-gray-100 px-3 py-1 rounded-full w-fit mt-2 sm:mt-0" data-i18n="career_role3_date">Sep 2020 - Actualidad</span>
                    </div>
                    <h4 class="text-sm font-bold text-gray-500 mb-4 uppercase tracking-wide" data-i18n="career_role3_sub">Consulta Privada</h4>
                    <p class="text-gray-600 text-sm leading-relaxed" data-i18n="career_role3_desc">
                        Atención médica de primer contacto. Generación de convenios empresariales para la revisión de salud de colaboradores de empresas aledañas.
                    </p>
                </div>
                
                <!-- Education -->
                 <div class="relative pl-8 md:pl-12 group">
                    <div class="absolute -left-[14px] top-0 w-6 h-6 bg-indigo-500 rounded-full border-4 border-white shadow-lg group-hover:scale-125 transition-transform duration-300"></div>
                    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between mb-2">
                        <h3 class="text-xl font-heading font-bold text-navy" data-i18n="career_edu_title">Formación Académica & Certificaciones</h3>
                    </div>
                    <ul class="space-y-3 mt-4">
                        <li class="flex items-start gap-3">
                            <i class="fas fa-graduation-cap text-indigo-500 mt-1"></i>
                            <div>
                                <strong class="block text-navy text-sm" data-i18n="career_edu_1_title">Licenciatura en Médico Cirujano y Partero</strong>
                                <span class="text-xs text-gray-500" data-i18n="career_edu_1_desc">Universidad de Guadalajara (2014-2018)</span>
                            </div>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fas fa-user-shield text-indigo-500 mt-1"></i>
                            <div>
                                <strong class="block text-navy text-sm" data-i18n="career_edu_2_title">Especialidad en Seguridad e Higiene Industrial</strong>
                                <span class="text-xs text-gray-500" data-i18n="career_edu_2_desc">UNITEC (Término previsto: Abr 2026)</span>
                            </div>
                        </li>
                        <li class="flex items-start gap-3">
                            <i class="fas fa-scale-balanced text-indigo-500 mt-1"></i>
                            <div>
                                <strong class="block text-navy text-sm" data-i18n="career_edu_3_title">Especialidad en Derecho Sanitario</strong>
                                <span class="text-xs text-gray-500" data-i18n="career_edu_3_desc">Enfoque: Regulación COFEPRIS y Normatividad</span>
                            </div>
                        </li>
                         <li class="flex items-start gap-3">
                            <i class="fas fa-certificate text-indigo-500 mt-1"></i>
                            <div>
                                <strong class="block text-navy text-sm" data-i18n="career_edu_4_title">Certificación Lean Six Sigma</strong>
                                <span class="text-xs text-gray-500" data-i18n="career_edu_4_desc">Yellow & Green (Certificado) | Black Belt (Fase de Proyecto)</span>
                            </div>
                        </li>
                         <li class="flex items-start gap-3">
                            <i class="fas fa-database text-indigo-500 mt-1"></i>
                            <div>
                                <strong class="block text-navy text-sm" data-i18n="career_edu_5_title">Data Science Bootcamp</strong>
                                <span class="text-xs text-gray-500" data-i18n="career_edu_5_desc">Gestión de Dashboards y Análisis de Datos</span>
                            </div>
                        </li>
                        <!-- NUEVO CURSO 1: HIGIENE -->
                        <li class="flex items-start gap-3">
                            <i class="fas fa-utensils text-indigo-500 mt-1"></i>
                            <div>
                                <strong class="block text-navy text-sm" data-i18n="career_edu_6_title">Buenas Prácticas de Higiene (NOM-251)</strong>
                                <span class="text-xs text-gray-500" data-i18n="career_edu_6_desc">Preparación de Alimentos (NOM-251-SSA1-2009)</span>
                            </div>
                        </li>
                        <!-- NUEVO CURSO 2: LACTARIOS -->
                        <li class="flex items-start gap-3">
                            <i class="fas fa-baby text-indigo-500 mt-1"></i>
                            <div>
                                <strong class="block text-navy text-sm" data-i18n="career_edu_7_title">Regulación Sanitaria en Lactarios</strong>
                                <span class="text-xs text-gray-500" data-i18n="career_edu_7_desc">Normativa para espacios de lactancia materna</span>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- FOOTER -->
    <footer id="contact" class="bg-navy text-white pt-20 pb-10 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <h2 class="text-3xl lg:text-4xl font-heading font-bold mb-6" data-i18n="footer_title">¿Hablamos de estrategia?</h2>
            <div class="flex flex-col sm:flex-row justify-center gap-4 mb-16">
                <a href="mailto:dr.hanmedical@gmail.com" class="px-8 py-4 bg-white text-navy font-bold rounded hover:bg-gray-100 transition-colors flex items-center justify-center gap-3"><i class="fas fa-envelope"></i> <span data-i18n="footer_btn_email">Correo electrónico</span></a>
                <a href="https://wa.me/525629846164" target="_blank" class="px-8 py-4 bg-whatsapp text-white font-bold rounded hover:bg-green-600 transition-colors flex items-center justify-center gap-3"><i class="fab fa-whatsapp"></i> <span data-i18n="footer_btn_wa">WhatsApp directo</span></a>
                <a href="https://drive.google.com/file/d/1zPAhoGCNj7cHVxNoF2MLWUudHTGEP_4-/view?usp=drive_link" target="_blank" class="px-8 py-4 bg-indigo-600 text-white font-bold rounded hover:bg-indigo-500 transition-colors flex items-center justify-center gap-3"><i class="fas fa-file-pdf"></i> <span data-i18n="footer_btn_cv">Ver CV Completo</span></a>
            </div>
            <div class="border-t border-gray-800 pt-10 text-sm text-gray-400">
                <p class="font-heading font-bold text-white text-base">Dr. Han | Strategic Health</p>
                <p class="text-gray-600 pt-4 text-xs" data-i18n="footer_rights">© 2026 Dr. Han Medical. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script>
        // --- GLOBAL CONSTANTS & TRANSLATIONS ---
        const translations = {
            "es": { 
                "nav_home": "Inicio", 
                "nav_strategy": "Estrategia", 
                "nav_legal": "Normatividad", 
                "nav_bi": "BI & Dashboard", 
                "nav_ai": "AI Sim", 
                "nav_career": "Trayectoria", 
                "nav_whatsapp": "WhatsApp directo", 
                "nav_ai_full": "AI Strategic Sim ✨", 
                "hero_badge": "Salud Ocupacional y Bienestar Corporativo", 
                "hero_h1": "Strategic Health, <br> <span class=\"gradient-text\">Wellness & Regulatory</span> Leader.", 
                "hero_desc": "Soy el <strong class=\"text-white\">Dr. Han</strong>. Lidero la transformación de la salud corporativa, alineando el cumplimiento normativo estricto con estrategias de bienestar que impulsan la rentabilidad y blindan la operación.", 
                "hero_btn_vision": "Ver Dashboard Interactivo", 
                "hero_btn_ai": "Probar AI Simulator", 
                "about_title": "Ingeniería de Salud Operativa y <span class=\"text-teal\">Mejora Continua.</span>", 
                "about_desc": "Integro principios de medicina laboral con metodologías de ingeniería (Lean Six Sigma, Análisis de Causa Raíz) para transformar la salud en un KPI medible. Mi enfoque no es solo clínico, es estructural: optimizo procesos para garantizar continuidad operativa y cumplimiento ISO/STPS.", 
                "card1_title": "Auditoría & Estándares", 
                "card1_desc": "Competencias probadas en ISO 9001, 19011 y 45001. Gestión basada en evidencia para \"Zero Fines\" en inspecciones STPS.", 
                "card2_title": "ROI & Siniestralidad", 
                "card2_desc": "Control agresivo de formatos ST-7/ST-9 ante el IMSS. Reducción directa de la Prima de Riesgo mediante análisis de datos y prevención técnica.", 
                "card3_title": "Seguridad Operativa", 
                "card3_desc": "Gestión de riesgos en entornos de alta demanda (Aviación, Logística). Protocolos de fatiga y aptitud psicofísica para personal crítico.", 
                "nav_legal": "Normatividad", 
                "bi_title": "Decisiones basadas en datos.<br><span class=\"text-sky\">No en suposiciones.</span>", 
                "bi_desc": "Interactúa con este simulador real para ver cómo transformo indicadores médicos en decisiones financieras y operativas.", 
                "bi_btn_general": "Dashboard General", 
                "bi_btn_035": "Psicosocial NOM-035", 
                "bi_btn_036": "Ergonomía NOM-036", 
                "bi_btn_iso": "Gestión ISO 45001", 
                "bi_btn_wellness": "Wellness & Retención", 
                "dash_header_title": "Centro de Comando Estratégico", 
                "dash_header_status": "Status: En línea • Datos actualizados", 
                "dash_toggle_label": "Estrategia", 
                "strat_label_on": "Con Gestión Dr. Han", 
                "strat_label_off": "Sin Gestión Estratégica", 
                "report_header_tag": "Documento Oficial", 
                "report_title": "Reporte Ejecutivo de Salud Corporativa", 
                "report_meta_period": "Periodo: Enero - Junio 2026", 
                "report_meta_for": "Generado para:", 
                "report_meta_target": "Consejo Directivo", 
                "rep_section1_title": "Diagnóstico de Riesgo", 
                "rep_method_label": "Método", 
                "rep_finding_opt_title": "Condiciones Óptimas", 
                "rep_finding_opt_desc": "El análisis ergonómico indica operación segura.", 
                "rep_finding_warn_title": "Alerta Operativa", 
                "rep_finding_warn_desc": "Desviaciones moderadas detectadas.", 
                "rep_finding_crit_title": "Riesgo Crítico", 
                "rep_finding_crit_desc": "Indicadores superan límites seguros.", 
                "rep_eval_text": "Evaluación:", 
                "rep_section2_title": "Recomendación Técnica", 
                "rep_section3_title": "Estrategia", 
                "rep_strat_high1": "Reingeniería inmediata.", 
                "rep_strat_high2": "Capacitación urgente.", 
                "rep_strat_low1": "Vigilancia estándar.", 
                "rep_strat_low2": "Pausas activas.", 
                "rec_nom_low": "Condiciones aceptables.", 
                "rec_nom_med": "Examinar tarea.", 
                "rec_nom_high": "ACCIÓN PRONTA REQUERIDA.", 
                "rec_nom_crit": "DETENER ACTIVIDAD.", 
                "ai_section_title": "AI Strategic Simulator", 
                "ai_desc": "Ingrese un desafío actual y obtenga un pre-análisis.", 
                "ai_input_label": "Describa un reto", 
                "ai_input_placeholder": "Ej: El área de ventas tiene alta rotación asociada a estrés...", 
                "ai_waiting_text": "Esperando input...", 
                "ai_res_diag": "Diagnóstico", 
                "ai_res_act": "Acción", 
                "ai_res_txt1": "Desviación operativa detectada.", 
                "ai_res_li1": "Auditoría NOM-030.", 
                "ai_res_li2": "Protocolo Stop-Work.", 
                "ai_btn_generate": "Generar estrategia ✨",
                "footer_title": "¿Hablamos de estrategia?", 
                "footer_btn_email": "Correo electrónico", 
                "footer_btn_wa": "WhatsApp directo", 
                "footer_rights": "© 2026 Dr. Han Medical. Todos los derechos reservados.",
                // New Legal Translations
                "legal_badge": "COMPLIANCE & EHS",
                "legal_title": "Marco Normativo: <span class=\"text-indigo-600\">Datos, ISO & STPS</span>",
                "legal_desc": "Un sistema de gestión integrado que une la seguridad jurídica (LFPDPPP) con la excelencia operativa (ISO/Lean). Protejo la licencia sanitaria y optimizo los procesos de EHS.",
                "legal_c1_desc": "Auditoría interna ISO 45001/9001 y mejora continua con Lean Six Sigma.",
                "legal_c2_desc": "Cumplimiento estricto de LFPDPPP para manejo de datos sensibles de colaboradores.",
                "legal_c3_title": "NOM-004-SSA3",
                "legal_c3_desc": "Integración clínica robusta para defensa legal ante controversias o auditorías sanitarias.",
                "legal_c4_title": "Normatividad STPS",
                "legal_c4_desc": "Implementación técnica de NOMs críticas para seguridad e higiene industrial.",
                "legal_cta_title": "¿Listo para una auditoría?",
                "legal_cta_desc": "Simulacros de inspección STPS y auditoría de expedientes clínicos para asegurar cumplimiento total.",
                "legal_btn": "Auditar Cumplimiento",
                "footer_btn_cv": "Ver CV Completo",
                "career_badge": "EXPERIENCIA & LIDERAZGO",
                "career_title": "Trayectoria <span class=\"text-indigo-600\">Profesional</span>",
                "career_desc": "Más de 5 años de experiencia consolidada en gestión de servicios médicos corporativos, salud ocupacional y programas de bienestar.",
                "career_role1_title": "Médico Ocupacional",
                "career_role1_date": "Julio 2023 - Abril 2025",
                "career_role1_desc": "Coordinación de evaluaciones médicas para tripulación y operativos de mantenimiento. Gestión integral de riesgos laborales (ST-7, ST-9, ST-2) y enlace con IMSS. Implementación de pruebas de seguridad crítica (fatiga, alcoholimetría).<br><br><strong>• Cobertura en Fresenius Kabi, DHL CEDIS y Walmart CEDIS.</strong>",
                "career_role2_title": "Especialista en Medicina Ocupacional (Proyecto)",
                "career_role2_date": "Junio 2023 - Sep 2023",
                "career_role2_desc": "Diseño e implementación del departamento de medicina laboral desde cero. Integración de protocolos médicos al reclutamiento, gestión de consentimientos informados y optimización de recursos médicos.",
                "career_role3_title": "Médico General y Familiar",
                "career_role3_sub": "Consulta Privada",
                "career_role3_date": "Sep 2020 - Actualidad",
                "career_role3_desc": "Atención médica de primer contacto. Generación de convenios empresariales para la revisión de salud de colaboradores de empresas aledañas.",
                "career_edu_title": "Formación Académica & Certificaciones",
                "career_edu_1_title": "Licenciatura en Médico Cirujano y Partero",
                "career_edu_1_desc": "Universidad de Guadalajara (2014-2018)",
                "career_edu_2_title": "Especialidad en Seguridad e Higiene Industrial",
                "career_edu_2_desc": "UNITEC (Término previsto: Dic 2026)",
                "career_edu_3_title": "Especialidad en Derecho Sanitario",
                "career_edu_3_desc": "Enfoque: Regulación COFEPRIS y Normatividad",
                "career_edu_4_title": "Certificación Lean Six Sigma",
                "career_edu_4_desc": "Yellow & Green (Certificado) | Black Belt (Fase de Proyecto)",
                "career_edu_5_title": "Data Science Bootcamp",
                "career_edu_5_desc": "Gestión de Dashboards y Análisis de Datos",
                // NUEVAS TRADUCCIONES PARA CURSOS
                "career_edu_6_title": "Buenas Prácticas de Higiene (NOM-251)",
                "career_edu_6_desc": "Preparación de Alimentos (NOM-251-SSA1-2009)",
                "career_edu_7_title": "Regulación Sanitaria en Lactarios",
                "career_edu_7_desc": "Normativa para espacios de lactancia materna",
                // Dashboard Translations MODIFIED
                "kpi_days": "Días Incapacidad",
                "kpi_compliance": "Cumplimiento ISO",
                "kpi_risk": "Índice de Burnout (035)",
                "kpi_cost": "Riesgo de Rotación",
                "chart_trend_title": "Tendencia",
                "kpi_035_target": "Objetivo de Cumplimiento NOM-035",
                "chart_iso_radar_title": "Nivel de Madurez (Anexo SL)",
                "chart_bmi_title": "Distribución IMC",
                "chart_chronic_title": "Top Patologías",
                "sim_panel_title": "Panel de Variables",
                "sim_load": "Carga Física",
                "sim_freq_low": "Baja",
                "sim_freq_med": "Media",
                "sim_freq_high": "Alta",
                "sim_opt_close": "Cerca",
                "sim_opt_med": "Media",
                "sim_opt_far": "Lejos",
                "sim_opt_knuckle": "Nudillos",
                "sim_opt_shoulder": "Hombros",
                "sim_opt_floor": "Suelo",
                "sim_opt_good": "Bueno",
                "sim_opt_fair": "Regular",
                "sim_risk_title": "Nivel de Riesgo Detectado",
                "iso_kpi_adherence": "Adherencia Global",
                "iso_status_cert": "Certificable",
                "iso_kpi_nc": "No Conformidades",
                "iso_nc_critical": "Mayores (Críticas)",
                "iso_kpi_review": "Rev. Dirección",
                "iso_panel_title": "Panel de Auditoría",
                "iso_maturity": "Nivel de Madurez",
                "iso_4_context": "4. Contexto",
                "iso_5_leadership": "5. Liderazgo",
                "iso_6_planning": "6. Planificación",
                "iso_7_support": "7. Apoyo",
                "iso_8_ops": "8. Operación",
                "iso_9_perf": "9. Evaluación",
                "iso_10_improv": "10. Mejora",
                "iso_crit_controls": "Controles Críticos",
                "iso_cc_consult": "Consulta (5.4)",
                "iso_cc_legal": "Matriz Legal (6.1.3)",
                "iso_cc_emerg": "Emergencias (8.2)",
                "iso_cc_review": "Revisión Dirección (9.3)",
                "iso_findings_major": "Hallazgos Mayores",
                "rep_kpi_compliance": "Estatus Normativo",
                "rep_kpi_financial": "Talento Retenido",
                "rep_kpi_health": "Salud Organizacional",
                "rep_cta_title": "¿Su empresa enfrenta estos mismos desafíos?",
                "rep_cta_desc": "Puedo implementar este mismo nivel de diagnóstico y solución en sus primeros 90 días.",
                "rep_cta_btn": "Agendar Diagnóstico Breve",
                "sim_rula_arm": "Brazo (Hombro)",
                "sim_rula_neck": "Cuello / Tronco",
                "sim_reba_trunk": "Tronco",
                "sim_reba_legs": "Piernas"
            },
            "en": { 
                "nav_home": "Home", 
                "nav_strategy": "Strategy", 
                "nav_legal": "Compliance", 
                "nav_bi": "BI & Dashboard", 
                "nav_ai": "AI Sim", 
                "nav_career": "Career", 
                "nav_whatsapp": "Direct WhatsApp", 
                "nav_ai_full": "AI Strategic Sim ✨", 
                "hero_badge": "Occupational Health & Wellness", 
                "hero_h1": "Strategic Health, <br> <span class=\"gradient-text\">Wellness & Regulatory</span> Leader.", 
                "hero_desc": "I am <strong class=\"text-white\">Dr. Han</strong>. I lead corporate health transformation by aligning strict regulatory compliance with wellness strategies that drive profitability and safeguard operations.", 
                "hero_btn_vision": "View Interactive Dashboard", 
                "hero_btn_ai": "Try AI Simulator", 
                "about_title": "Operational Health Engineering & <span class=\"text-teal\">Continuous Improvement.</span>", 
                "about_desc": "I integrate occupational medicine principles with engineering methodologies (Lean Six Sigma, Root Cause Analysis) to transform health into a measurable KPI. My focus is structural: optimizing processes to ensure operational continuity and ISO/STPS compliance.", 
                "card1_title": "Audit & Standards", 
                "card1_desc": "Proven competencies in ISO 9001, 19011 & 45001. Evidence-based management for 'Zero Fines' in STPS inspections.", 
                "card2_title": "ROI & Claims Rate", 
                "card2_desc": "Rigorous management of ST-7/ST-9 forms with IMSS. Direct reduction of Risk Premium through data analytics and technical prevention.", 
                "card3_title": "Operational Safety", 
                "card3_desc": "Risk management in high-demand environments (Aviation, Logistics). Fatigue and psychophysical aptitude protocols for critical staff.", 
                "nav_legal": "Compliance", 
                "bi_title": "Data-driven decisions.", 
                "bi_desc": "Real simulator interaction. See how I transform medical metrics into financial and operational decisions.", 
                "bi_btn_general": "General Dashboard", 
                "bi_btn_035": "Psychosocial NOM-035", 
                "bi_btn_036": "Ergonomics NOM-036", 
                "bi_btn_iso": "ISO 45001 Mgmt", 
                "bi_btn_wellness": "Wellness & Retention", 
                "dash_header_title": "Strategic Command Center", 
                "dash_header_status": "Status: Online • Updated Data", 
                "dash_toggle_label": "Strategy", 
                "strat_label_on": "With Dr. Han", 
                "strat_label_off": "Without Strategy", 
                "report_header_tag": "Official Document", 
                "report_title": "Executive Health Report", 
                "report_meta_period": "Period: Jan - Jun 2026", 
                "report_meta_for": "Generated for:", 
                "report_meta_target": "Board of Directors", 
                "rep_section1_title": "Risk Diagnosis", 
                "rep_method_label": "Method", 
                "rep_finding_opt_title": "Optimal Conditions", 
                "rep_finding_opt_desc": "Ergonomic analysis indicates safe operation.", 
                "rep_finding_warn_title": "Operational Alert", 
                "rep_finding_warn_desc": "Moderate deviations detected.", 
                "rep_finding_crit_title": "Critical Risk", 
                "rep_finding_crit_desc": "Indicators exceed safe limits.", 
                "rep_eval_text": "Evaluation:", 
                "rep_section2_title": "Recommendation", 
                "rep_section3_title": "Strategy", 
                "rep_strat_high1": "Immediate process re-engineering.", 
                "rep_strat_high2": "Urgent staff training.", 
                "rep_strat_low1": "Standard surveillance.", 
                "rep_strat_low2": "Active pauses program.", 
                "rec_nom_low": "Acceptable conditions.", 
                "rec_nom_med": "Review task design.", 
                "rec_nom_high": "PROMPT ACTION REQUIRED.", 
                "rec_nom_crit": "STOP ACTIVITY IMMEDIATELY.", 
                "ai_section_title": "AI Strategic Simulator", 
                "ai_desc": "Technology as a strategic extension. Enter a current challenge to get a data-driven pre-analysis.", 
                "ai_input_label": "Describe a Challenge", 
                "ai_input_placeholder": "Ex: Sales department has high turnover linked to stress...", 
                "ai_waiting_text": "Waiting for strategic input...", 
                "ai_res_diag": "Diagnosis", 
                "ai_res_act": "Action", 
                "ai_res_txt1": "Operational deviation detected.", 
                "ai_res_li1": "NOM-030 Audit.", 
                "ai_res_li2": "Stop-Work Protocol implementation.", 
                "ai_btn_generate": "Generate Strategy ✨",
                "footer_title": "Let's talk strategy?", 
                "footer_btn_email": "Email", 
                "footer_btn_wa": "Direct WhatsApp", 
                "footer_rights": "© 2026 Dr. Han Medical. All rights reserved.",
                "legal_badge": "COMPLIANCE & EHS",
                "legal_title": "Regulatory Framework: <span class=\"text-indigo-600\">Data, ISO & STPS</span>",
                "legal_desc": "An integrated management system merging legal security (LFPDPPP) with operational excellence (ISO/Lean). I protect sanitary licenses and optimize EHS processes.",
                "legal_c1_desc": "ISO 45001/9001 internal audit and continuous improvement with Lean Six Sigma.",
                "legal_c2_desc": "Strict LFPDPPP compliance for handling sensitive employee data.",
                "legal_c3_title": "NOM-004-SSA3",
                "legal_c3_desc": "Robust clinical integration for legal defense in sanitary disputes or audits.",
                "legal_c4_title": "STPS Standards",
                "legal_c4_desc": "Technical implementation of critical industrial safety and hygiene NOMs.",
                "legal_cta_title": "Ready for an audit?",
                "legal_cta_desc": "STPS inspection drills and clinical record audits to ensure full compliance.",
                "legal_btn": "Audit Compliance",
                "footer_btn_cv": "View Full CV",
                "career_badge": "EXPERIENCE & LEADERSHIP",
                "career_title": "Professional <span class=\"text-indigo-600\">Career</span>",
                "career_desc": "Over 5 years of consolidated experience in corporate medical services management, occupational health, and wellness programs.",
                "career_role1_title": "Occupational Physician",
                "career_role1_date": "July 2023 - April 2025",
                "career_role1_desc": "Orchestrated specialized medical evaluations for crew and maintenance operations. Spearheaded comprehensive risk management (ST-7, ST-9, ST-2) and IMSS liaison. Implemented critical safety tests (fatigue, breathalyzer).<br><br><strong>• Coverage at Fresenius Kabi, DHL & Walmart Distribution Centers.</strong>",
                "career_role2_title": "Occupational Medicine Specialist (Project)",
                "career_role2_date": "June 2023 - Sep 2023",
                "career_role2_desc": "Designed and implemented the occupational medicine department from scratch. Integrated medical protocols into recruitment, streamlined informed consent management, and optimized medical resources.",
                "career_role3_title": "General & Family Physician",
                "career_role3_sub": "Private Practice",
                "career_role3_date": "Sep 2020 - Present",
                "career_role3_desc": "Primary medical care. Established business agreements for health reviews of employees from neighboring companies.",
                "career_edu_title": "Academic Background & Certifications",
                "career_edu_1_title": "Medical Surgeon Degree",
                "career_edu_1_desc": "University of Guadalajara (2014-2018)",
                "career_edu_2_title": "Specialization in Industrial Safety & Hygiene",
                "career_edu_2_desc": "UNITEC (Expected completion: Apr 2026)",
                "career_edu_3_title": "Specialization in Health Law",
                "career_edu_3_desc": "Focus: COFEPRIS Regulation & Compliance",
                "career_edu_4_title": "Lean Six Sigma Certification",
                "career_edu_4_desc": "Yellow & Green (Certified) | Black Belt (Project Phase)",
                "career_edu_5_title": "Data Science Bootcamp",
                "career_edu_5_desc": "Dashboard Management & Data Analytics",
                // NEW COURSE TRANSLATIONS
                "career_edu_6_title": "Good Hygiene Practices (NOM-251)",
                "career_edu_6_desc": "Food Preparation Safety (NOM-251-SSA1-2009)",
                "career_edu_7_title": "Sanitary Regulation in Nursing Rooms",
                "career_edu_7_desc": "Compliance standards for lactation spaces",
                // Dashboard Translations MODIFIED
                "kpi_days": "Disability Days",
                "kpi_compliance": "ISO Compliance",
                "kpi_risk": "Burnout Index (035)",
                "kpi_cost": "Turnover Risk",
                "chart_trend_title": "Trend",
                "kpi_035_target": "NOM-035 Compliance Target",
                "chart_iso_radar_title": "Maturity Level (Annex SL)",
                "chart_bmi_title": "BMI Distribution",
                "chart_chronic_title": "Top Pathologies",
                "sim_panel_title": "Variable Panel",
                "sim_load": "Physical Load",
                "sim_freq_low": "Low",
                "sim_freq_med": "Med",
                "sim_freq_high": "High",
                "sim_opt_close": "Close",
                "sim_opt_med": "Medium",
                "sim_opt_far": "Far",
                "sim_opt_knuckle": "Knuckle",
                "sim_opt_shoulder": "Shoulder",
                "sim_opt_floor": "Floor",
                "sim_opt_good": "Good",
                "sim_opt_fair": "Fair",
                "sim_risk_title": "Detected Risk Level",
                "iso_kpi_adherence": "Global Adherence",
                "iso_status_cert": "Certifiable",
                "iso_kpi_nc": "Non-Conformities",
                "iso_nc_critical": "Major (Critical)",
                "iso_kpi_review": "Mgmt Review",
                "iso_panel_title": "Audit Panel",
                "iso_maturity": "Maturity Level",
                "iso_4_context": "4. Context",
                "iso_5_leadership": "5. Leadership",
                "iso_6_planning": "6. Planning",
                "iso_7_support": "7. Support",
                "iso_8_ops": "8. Operation",
                "iso_9_perf": "9. Performance",
                "iso_10_improv": "10. Improvement",
                "iso_crit_controls": "Critical Controls",
                "iso_cc_consult": "Consultation (5.4)",
                "iso_cc_legal": "Legal Matrix (6.1.3)",
                "iso_cc_emerg": "Emergency (8.2)",
                "iso_cc_review": "Mgmt Review (9.3)",
                "iso_findings_major": "Major Findings",
                "rep_kpi_compliance": "Compliance Status",
                "rep_kpi_financial": "Talent Retained",
                "rep_kpi_health": "Org. Health",
                "rep_cta_title": "Does your company face these challenges?",
                "rep_cta_desc": "I can implement this level of diagnostics and solution in your first 90 days.",
                "rep_cta_btn": "Book Brief Diagnosis",
                "sim_rula_arm": "Arm (Shoulder)",
                "sim_rula_neck": "Neck / Trunk",
                "sim_reba_trunk": "Trunk",
                "sim_reba_legs": "Legs"
            }
        };

        // --- GLOBAL STATE ---
        let appState = { isDrHanStrategy: true, ergoRiskScore: 0, ergoRiskLabel: 'BAJO', currentMethod: 'NOM-036-1 (MAC)' };
        let currentLang = 'es';
        
        // --- CHART INSTANCES ---
        let trendChartInstance, deptChartInstance, jobChartInstance, nom035RadarChartInstance, nom035PieChartInstance, wellnessBMIChartInstance, wellnessChronicChartInstance, isoRadarChartInstance;
        
        // --- CHART CONFIGS (Stored to allow label updates) ---
        const chartData = {
            trend: {
                labels: { es: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'], en: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'] },
                // MODIFIED: Datasets for Stress vs Resignations
                datasets: { es: ['Nivel de Estrés/Burnout', 'Renuncias/Bajas'], en: ['Stress Level/Burnout', 'Resignations'] }
            },
            nom035Radar: {
                labels: { es: ['Ambiente', 'Carga', 'Jornada', 'Liderazgo', 'Relaciones', 'Violencia'], en: ['Environment', 'Workload', 'Hours', 'Leadership', 'Relations', 'Violence'] },
                datasets: { es: ['Riesgo'], en: ['Risk Level'] }
            },
            nom035Pie: {
                labels: { es: ['Nulo', 'Bajo', 'Medio', 'Alto', 'Muy Alto'], en: ['Negligible', 'Low', 'Medium', 'High', 'Very High'] }
            },
            isoRadar: {
                labels: { es: ['4. Contexto', '5. Liderazgo', '6. Planificación', '7. Apoyo', '8. Operación', '9. Evaluación', '10. Mejora'], en: ['4. Context', '5. Leadership', '6. Planning', '7. Support', '8. Operation', '9. Evaluation', '10. Improv.'] },
                datasets: { es: ['Cumplimiento (%)'], en: ['Compliance (%)'] }
            },
            wellnessBMI: {
                labels: { es: ['Normal', 'Sobrepeso', 'Obesidad G1', 'Obesidad G2'], en: ['Normal', 'Overweight', 'Obesity G1', 'Obesity G2'] }
            },
            wellnessChronic: {
                labels: { es: ['Hipertensión', 'Diabetes', 'TME', 'Dislipidemia'], en: ['Hypertension', 'Diabetes', 'MSD', 'Dyslipidemia'] },
                datasets: { es: ['Casos'], en: ['Cases'] }
            }
        };

        // --- HELPER FUNCTIONS ---
        function createChart(id, config) { 
            const ctx = document.getElementById(id); 
            return ctx ? new Chart(ctx, config) : null; 
        }

        // Helper function for updating KPIs
        function updateKpi(id, value, barColor, iconColor) {
            const el = document.getElementById(id);
            if (el) el.innerText = value;
            
            const bar = document.getElementById(id + "-bar");
            if (bar) {
                bar.className = `absolute top-0 left-0 w-full h-1 transition-colors duration-300 ${barColor}`;
            }

            const icon = document.getElementById(id + "-icon");
            if (icon) {
                icon.className = `w-8 h-8 rounded-lg flex items-center justify-center transition-colors duration-300 ${iconColor.replace('text-', 'bg-')}/10 ${iconColor}`;
            }
        }
        
        function updatePDCABar(letter, val) {
            const bar = document.getElementById(`phva-${letter}-bar`); const txt = document.getElementById(`phva-${letter}-val`);
            if(bar && txt) { bar.style.width = val + '%'; txt.innerText = val + '%'; if(val < 60) { bar.classList.remove('bg-blue-500', 'bg-teal', 'bg-orange-500', 'bg-purple-600'); bar.classList.add('bg-red-500'); } else { bar.classList.remove('bg-red-500'); if(letter === 'p') bar.classList.add('bg-blue-500'); if(letter === 'd') bar.classList.add('bg-teal'); if(letter === 'c') bar.classList.add('bg-orange-500'); if(letter === 'a') bar.classList.add('bg-purple-600'); } }
        }

        function switchDashTab(tabName) {
            document.querySelectorAll('.dash-sidebar-btn').forEach(btn => { btn.classList.remove('active', 'text-white'); btn.classList.add('text-gray-400'); });
            document.getElementById(`tab-${tabName}`).classList.add('active', 'text-white');
            document.querySelectorAll('.dash-view').forEach(v => v.classList.add('hidden')); document.getElementById(`view-${tabName}`).classList.remove('hidden');
        }

        function getRecommendationText(method, score, label) {
             const rTxt = translations[currentLang];
             let rec = "";
                if(method.includes('NOM')) {
                    if(label.includes('BAJO') || label.includes("LOW")) rec = rTxt.rec_nom_low; else if(label.includes('MEDIO') || label.includes("MEDIUM")) rec = rTxt.rec_nom_med; else if(label.includes('ALTO') || label.includes("HIGH")) rec = rTxt.rec_nom_high; else rec = rTxt.rec_nom_crit;
                } else if (method.includes('REBA')) {
                    if(score <= 3) rec = rTxt.rec_reba_low; else if(score <= 7) rec = rTxt.rec_reba_med; else rec = rTxt.rec_reba_high;
                } else { 
                    if(score <= 2) rec = rTxt.rec_rula_low; else if(score <= 4) rec = rTxt.rec_rula_med; else rec = rTxt.rec_rula_high;
                }
                return rec;
        }

        // --- DASHBOARD INIT ---
        function initDashboard() {
            // General Charts (MODIFIED TO SHOW STRESS VS RESIGNATIONS)
            trendChartInstance = createChart('trendChart', { 
                type: 'line', 
                data: { 
                    labels: chartData.trend.labels.es, 
                    datasets: [
                        { label: chartData.trend.datasets.es[0], data: [9, 8, 5, 3, 2.5, 2.1], borderColor: '#ef4444', backgroundColor: 'rgba(239, 68, 68, 0.1)', fill: true, tension: 0.4 }, 
                        { label: chartData.trend.datasets.es[1], data: [15, 12, 5, 2, 1, 1], borderColor: '#0ea5e9', backgroundColor: 'rgba(14, 165, 233, 0.6)', type: 'bar', yAxisID: 'y1' }
                    ] 
                }, 
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false, 
                    scales: { 
                        y: { display: true, beginAtZero: true, max: 10, title: {display: true, text: 'Nivel Estrés (1-10)'} }, 
                        y1: { display: true, position: 'right', beginAtZero: true, grid: {drawOnChartArea: false}, title: {display: true, text: 'Renuncias'} }, 
                        x: { grid: { display: false } } 
                    } 
                } 
            });
            
            // NOM-035 Charts
            nom035RadarChartInstance = createChart('nom035RadarChart', { type: 'radar', data: { labels: chartData.nom035Radar.labels.es, datasets: [{ label: chartData.nom035Radar.datasets.es[0], data: [3, 5, 4, 3, 2, 1], backgroundColor: 'rgba(99, 102, 241, 0.2)', borderColor: '#6366f1', pointBackgroundColor: '#6366f1' }] }, options: { responsive: true, maintainAspectRatio: false, scales: { r: { suggestedMin: 0, suggestedMax: 5 } } } });
            nom035PieChartInstance = createChart('nom035PieChart', { type: 'pie', data: { labels: chartData.nom035Pie.labels.es, datasets: [{ data: [15, 45, 25, 10, 5], backgroundColor: ['#22c55e', '#84cc16', '#facc15', '#f97316', '#ef4444'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } } });
            
            // ISO 45001 Radar
            isoRadarChartInstance = createChart('isoRadarChart', { type: 'radar', data: { labels: chartData.isoRadar.labels.es, datasets: [{ label: chartData.isoRadar.datasets.es[0], data: [100, 95, 90, 92, 98, 90, 88], backgroundColor: 'rgba(59, 130, 246, 0.2)', borderColor: '#3b82f6', pointBackgroundColor: '#3b82f6' }] }, options: { responsive: true, maintainAspectRatio: false, scales: { r: { suggestedMin: 0, suggestedMax: 100, ticks: { stepSize: 20 } } } } });
            
            // Wellness Charts
            wellnessBMIChartInstance = createChart('wellnessBMIChart', { type: 'doughnut', data: { labels: chartData.wellnessBMI.labels.es, datasets: [{ data: [45, 30, 15, 10], backgroundColor: ['#0d9488', '#facc15', '#f97316', '#ef4444'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, cutout: '60%', plugins: { legend: { position: 'right' } } } });
            wellnessChronicChartInstance = createChart('wellnessChronicChart', { type: 'bar', data: { labels: chartData.wellnessChronic.labels.es, datasets: [{ label: chartData.wellnessChronic.datasets.es[0], data: [12, 8, 25, 18], backgroundColor: '#0ea5e9', borderRadius: 4 }] }, options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { grid: { display: false } } } } });
            
            // Initialize Sub-modules
            initSimulator();
            initStrategyToggle();
            initIsoSimulator();
            
            // Initial UI Update
            updateFinalReport();
        }

        function updateChartsLanguage() {
            // Trend Chart
            if (trendChartInstance) {
                trendChartInstance.data.labels = chartData.trend.labels[currentLang];
                trendChartInstance.data.datasets[0].label = chartData.trend.datasets[currentLang][0];
                trendChartInstance.data.datasets[1].label = chartData.trend.datasets[currentLang][1];
                trendChartInstance.update();
            }
            // NOM-035 Radar
            if (nom035RadarChartInstance) {
                nom035RadarChartInstance.data.labels = chartData.nom035Radar.labels[currentLang];
                nom035RadarChartInstance.data.datasets[0].label = chartData.nom035Radar.datasets[currentLang][0];
                nom035RadarChartInstance.update();
            }
            // NOM-035 Pie
            if (nom035PieChartInstance) {
                nom035PieChartInstance.data.labels = chartData.nom035Pie.labels[currentLang];
                nom035PieChartInstance.update();
            }
            // ISO Radar
            if (isoRadarChartInstance) {
                isoRadarChartInstance.data.labels = chartData.isoRadar.labels[currentLang];
                isoRadarChartInstance.data.datasets[0].label = chartData.isoRadar.datasets[currentLang][0];
                isoRadarChartInstance.update();
            }
            // Wellness BMI
            if (wellnessBMIChartInstance) {
                wellnessBMIChartInstance.data.labels = chartData.wellnessBMI.labels[currentLang];
                wellnessBMIChartInstance.update();
            }
            // Wellness Chronic
            if (wellnessChronicChartInstance) {
                wellnessChronicChartInstance.data.labels = chartData.wellnessChronic.labels[currentLang];
                wellnessChronicChartInstance.data.datasets[0].label = chartData.wellnessChronic.datasets[currentLang][0];
                wellnessChronicChartInstance.update();
            }
        }

        // --- REPORT GENERATION LOGIC ---
        // MODIFIED: Focus on Retention
        function updateFinalReport() {
            // Metrics now represent Retention % instead of Savings $
            let metrics = { 
                compliance: appState.isDrHanStrategy ? 98 : 65, 
                retention: appState.isDrHanStrategy ? 98 : 85, // Retention Percentage
                health: appState.isDrHanStrategy ? 8.4 : 6.0 
            };
            
            if(appState.ergoRiskLabel.includes('ALTO') || appState.ergoRiskLabel.includes('CRÍTICO')) { 
                metrics.health -= 1.2; 
                metrics.retention -= 15; // High risk drops retention
            }
            else if (appState.ergoRiskLabel.includes('MEDIO')) { 
                metrics.health -= 0.4; 
                metrics.retention -= 5; 
            }

            // Datos ISO para reporte
            const kpiIsoText = document.getElementById('kpi-iso-adherence') ? document.getElementById('kpi-iso-adherence').innerText : "0%";
            const isoAdherence = parseInt(kpiIsoText) || 0;
            const kpiNcText = document.getElementById('kpi-iso-nc') ? document.getElementById('kpi-iso-nc').innerText : "0";
            const isoNc = parseInt(kpiNcText) || 0;
            
            let isoStatus = "Certificable";
            let isoColor = "text-green-500";
            let isoRec = "Continuar con plan de auditoría de certificación.";

            if (isoNc > 0) {
                isoStatus = "NO CERTIFICABLE";
                isoColor = "text-red-500";
                isoRec = "DETENER PROCESO: Cerrar No Conformidades Mayores antes de auditoría.";
            } else if (isoAdherence < 85) {
                isoStatus = "Riesgo Alto";
                isoColor = "text-orange-500";
                isoRec = "Reforzar controles en capítulos con baja madurez.";
            }

            const repComp = document.getElementById('rep-compliance');
            if (repComp) repComp.innerText = metrics.compliance + "%";
            
            // MODIFIED: Savings -> Retention
            const domRet = document.getElementById('rep-savings');
            if (domRet) {
                domRet.innerText = metrics.retention + "%";
                // If retention drops below 90, show red
                if(metrics.retention < 90) domRet.classList.add('text-red-500'); else domRet.classList.remove('text-red-500');
            }
            
            const repHealth = document.getElementById('rep-health');
            if (repHealth) repHealth.innerText = metrics.health.toFixed(1) + "/10";
            
            const repBody = document.getElementById('rep-body-content');
            const rTxt = translations[currentLang];
            let findingTitle = "", findingText = "", findingColor = "";

            // MODIFIED: Text logic based on risk
            if(appState.ergoRiskLabel.includes("BAJO") || appState.ergoRiskLabel.includes("NIVEL 1") || appState.ergoRiskLabel.includes("LOW")) { 
                findingTitle = "Éxito"; 
                findingText = "La estrategia de Wellness ha blindado la retención, reduciendo la intención de renuncia."; 
                findingColor = "bg-green-500"; 
            }
            else if (appState.ergoRiskLabel.includes("MEDIO") || appState.ergoRiskLabel.includes("NIVEL 2") || appState.ergoRiskLabel.includes("MEDIUM")) { 
                findingTitle = rTxt.rep_finding_warn_title; 
                findingText = "Riesgo moderado de burnout detectado en áreas operativas."; 
                findingColor = "bg-yellow-500"; 
            }
            else { 
                findingTitle = "Alerta"; 
                findingText = "El nivel de estrés actual proyecta una fuga de talento del 15% en áreas críticas."; 
                findingColor = "bg-red-500"; 
            }
            
            let recText = getRecommendationText(appState.currentMethod, appState.ergoRiskScore, appState.ergoRiskLabel);

             if (repBody) {
                repBody.innerHTML = `
                    <div>
                        <div class="flex justify-between items-center mb-3"><h4 class="text-sm font-bold text-white ${findingColor} inline-block px-3 py-1 rounded">1 ${rTxt.rep_section1_title}</h4><span class="text-[10px] uppercase font-bold text-gray-400">${rTxt.rep_method_label}: ${appState.currentMethod}</span></div>
                        <p class="text-sm text-gray-700 leading-relaxed text-justify"><strong>${findingTitle}:</strong> ${findingText} ${rTxt.rep_eval_text} <strong>${appState.ergoRiskLabel}</strong>.</p>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                        <div><h4 class="text-sm font-bold text-white bg-navy inline-block px-3 py-1 rounded mb-3">2 ${rTxt.rep_section2_title}</h4><div class="bg-slate-50 border-l-4 border-navy p-4 rounded-r-lg"><p class="text-sm text-gray-700 font-medium italic">"${recText}"</p></div></div>
                        <div><h4 class="text-sm font-bold text-white bg-teal inline-block px-3 py-1 rounded mb-3">3 ${rTxt.rep_section3_title}</h4><ul class="list-disc list-inside text-sm text-gray-700 space-y-2 pl-2"><li>${(appState.ergoRiskLabel.includes('ALTO') || appState.ergoRiskLabel.includes('CRÍTICO') || appState.ergoRiskLabel.includes("HIGH")) ? rTxt.rep_strat_high1 : rTxt.rep_strat_low1}</li><li>${(appState.ergoRiskLabel.includes('ALTO') || appState.ergoRiskLabel.includes('CRÍTICO') || appState.ergoRiskLabel.includes("HIGH")) ? rTxt.rep_strat_high2 : rTxt.rep_strat_low2}</li></ul></div>
                    </div>
                    <!-- NUEVA SECCIÓN ISO 45001 INTEGRADA -->
                    <div class="mt-8 border-t border-gray-100 pt-6">
                        <h4 class="text-sm font-bold text-white bg-blue-600 inline-block px-3 py-1 rounded mb-3">4. ${rTxt.iso_panel_title}</h4>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                             <div class="bg-slate-50 p-4 rounded border border-gray-200 text-center"><span class="block text-2xl font-bold text-navy">${isoAdherence}%</span><span class="text-xs text-gray-500 uppercase">${rTxt.iso_kpi_adherence}</span></div>
                             <div class="bg-slate-50 p-4 rounded border border-gray-200 text-center"><span class="block text-2xl font-bold ${isoNc > 0 ? 'text-red-500' : 'text-green-500'}">${isoNc}</span><span class="text-xs text-gray-500 uppercase">${rTxt.iso_kpi_nc}</span></div>
                             <div class="bg-slate-50 p-4 rounded border border-gray-200 text-center flex flex-col justify-center"><span class="font-bold text-sm ${isoColor}">${isoStatus}</span></div>
                        </div>
                        <p class="text-sm text-gray-700 mt-3 italic">"${isoRec}"</p>
                    </div>
                `;
            }
        }

        // --- STRATEGY TOGGLE ---
        function initStrategyToggle() {
            const toggle = document.getElementById('han-toggle');
            const label = document.getElementById('strategy-label');
            
            // MODIFIED DATA: Stress & Turnover instead of Financial
            const dataBad = { 
                kpiDays: 145, 
                kpiComp: '65%', 
                kpiRisk: '8.5', // Burnout High
                kpiCost: 'Alto', // Turnover High
                trendStress: [6, 7, 8, 8.5, 9, 9.2], // Stress Line
                trendTurnover: [5, 8, 10, 12, 15, 18] // Resignations Bar
            };
            const dataGood = { 
                kpiDays: 42, 
                kpiComp: '98%', 
                kpiRisk: '2.1', // Burnout Low
                kpiCost: 'Bajo', // Turnover Low
                trendStress: [9, 8, 5, 3, 2.5, 2.1], // Stress Line
                trendTurnover: [15, 12, 5, 2, 1, 1] // Resignations Bar
            };

            if(toggle) {
                toggle.addEventListener('change', (e) => {
                    const isDrHan = e.target.checked;
                    appState.isDrHanStrategy = isDrHan;
                    const data = isDrHan ? dataGood : dataBad;
                    
                    if(label) { 
                        label.innerText = isDrHan ? translations[currentLang].strat_label_on : translations[currentLang].strat_label_off; 
                        label.className = `text-xs font-bold transition-colors ${isDrHan ? 'text-teal' : 'text-red-500'}`; 
                    }
                    
                    // Update KPIs with dynamic color coding
                    updateKpi("kpi-days", data.kpiDays, isDrHan ? "bg-teal" : "bg-red-500", isDrHan ? "text-teal" : "text-red-500");
                    updateKpi("kpi-compliance", data.kpiComp, isDrHan ? "bg-teal" : "bg-red-500", isDrHan ? "text-teal" : "text-red-500");
                    
                    // Risk (Burnout) - Lower is better
                    updateKpi("kpi-risk", data.kpiRisk, isDrHan ? "bg-sky" : "bg-red-500", isDrHan ? "text-sky" : "text-red-500");
                    
                    // Cost (Turnover) - "Bajo" is better
                    updateKpi("kpi-cost", data.kpiCost, isDrHan ? "bg-orange-400" : "bg-red-500", isDrHan ? "text-orange-500" : "text-red-500");

                    if(trendChartInstance) { 
                        trendChartInstance.data.datasets[0].data = data.trendStress; 
                        trendChartInstance.data.datasets[1].data = data.trendTurnover; 
                        trendChartInstance.update(); 
                    }
                    setIsoDefaults(isDrHan);
                    updateFinalReport();
                });
            }
        }

        // --- ISO SIMULATOR ---
        function initIsoSimulator() {
            for(let i=4; i<=10; i++) { 
                const el = document.getElementById(`iso-in-${i}`); 
                if(el) el.addEventListener('input', (e) => { 
                    document.getElementById(`val-iso-${i}`).innerText = e.target.value + '%'; 
                    updateIsoRealTime(); 
                }); 
            }
            ['iso-check-consult', 'iso-check-legal', 'iso-check-emergency', 'iso-check-mgmt'].forEach(id => { 
                const el = document.getElementById(id); 
                if(el) el.addEventListener('change', updateIsoRealTime); 
            });
        }

        function adjustNC(delta) { 
            const input = document.getElementById('iso-in-nc'); 
            if(input) { 
                let val = parseInt(input.value) || 0; 
                val += delta; 
                if(val < 0) val = 0; 
                input.value = val; 
                updateIsoRealTime(); 
            } 
        }

        function setIsoDefaults(isGood) {
            const defaults = isGood ? {4:100, 5:95, 6:90, 7:92, 8:98, 9:90, 10:88, nc:0} : {4:40, 5:40, 6:30, 7:40, 8:50, 9:20, 10:10, nc:12};
            for(let i=4; i<=10; i++) { 
                const el = document.getElementById(`iso-in-${i}`); 
                if(el) { 
                    el.value = defaults[i]; 
                    document.getElementById(`val-iso-${i}`).innerText = defaults[i] + '%'; 
                } 
            }
            const ncInput = document.getElementById('iso-in-nc'); 
            if(ncInput) { 
                ncInput.value = 0; 
                adjustNC(defaults.nc); 
            }
            ['iso-check-consult', 'iso-check-legal', 'iso-check-emergency', 'iso-check-mgmt'].forEach(id => { 
                const el = document.getElementById(id); 
                if(el) el.checked = isGood; 
            });
            updateIsoRealTime();
        }

        function updateIsoRealTime() {
            let v4 = parseInt(document.getElementById('iso-in-4').value); let v5 = parseInt(document.getElementById('iso-in-5').value);
            let v6 = parseInt(document.getElementById('iso-in-6').value); let v7 = parseInt(document.getElementById('iso-in-7').value);
            let v8 = parseInt(document.getElementById('iso-in-8').value); let v9 = parseInt(document.getElementById('iso-in-9').value);
            let v10 = parseInt(document.getElementById('iso-in-10').value); const nc = parseInt(document.getElementById('iso-in-nc').value);
            
            if(!document.getElementById('iso-check-consult').checked) { v5 = Math.min(v5, 50); document.getElementById('val-iso-5').classList.add('text-red-500'); } else document.getElementById('val-iso-5').classList.remove('text-red-500');
            if(!document.getElementById('iso-check-legal').checked) { v6 = Math.min(v6, 40); document.getElementById('val-iso-6').classList.add('text-red-500'); } else document.getElementById('val-iso-6').classList.remove('text-red-500');
            if(!document.getElementById('iso-check-emergency').checked) { v8 = Math.min(v8, 60); document.getElementById('val-iso-8').classList.add('text-red-500'); } else document.getElementById('val-iso-8').classList.remove('text-red-500');
            if(!document.getElementById('iso-check-mgmt').checked) { v9 = Math.min(v9, 50); document.getElementById('val-iso-9').classList.add('text-red-500'); } else document.getElementById('val-iso-9').classList.remove('text-red-500');

            document.getElementById('val-iso-5').innerText = v5 + '%'; document.getElementById('val-iso-6').innerText = v6 + '%';
            document.getElementById('val-iso-8').innerText = v8 + '%'; document.getElementById('val-iso-9').innerText = v9 + '%';

            const planAvg = Math.round((v4 + v5 + v6) / 3); const doAvg = Math.round((v7 + v8) / 2); const checkAvg = v9; const actAvg = v10;
            const globalAdherence = Math.round((planAvg + doAvg + checkAvg + actAvg) / 4);
            const isCertifiable = nc === 0;

            const kpiAdh = document.getElementById('kpi-iso-adherence'); 
            if (kpiAdh) {
                kpiAdh.innerText = globalAdherence + '%'; 
                kpiAdh.className = `text-3xl font-heading font-bold mb-1 ${(!isCertifiable || globalAdherence < 85) ? 'text-red-500' : 'text-navy'}`;
            }
            
            const kpiNc = document.getElementById('kpi-iso-nc'); 
            if (kpiNc) {
                kpiNc.innerText = nc; 
                kpiNc.className = `text-3xl font-heading font-bold mb-1 ${nc === 0 ? 'text-navy' : 'text-red-500'}`;
            }
            
            if(isoRadarChartInstance) {
                isoRadarChartInstance.data.datasets[0].data = [v4, v5, v6, v7, v8, v9, v10];
                if(!isCertifiable) { isoRadarChartInstance.data.datasets[0].backgroundColor = 'rgba(239, 68, 68, 0.2)'; isoRadarChartInstance.data.datasets[0].borderColor = '#ef4444'; }
                else { isoRadarChartInstance.data.datasets[0].backgroundColor = 'rgba(59, 130, 246, 0.2)'; isoRadarChartInstance.data.datasets[0].borderColor = '#3b82f6'; }
                isoRadarChartInstance.update();
            }
            updatePDCABar('p', planAvg); updatePDCABar('d', doAvg); updatePDCABar('c', checkAvg); updatePDCABar('a', actAvg);
            
            // ACTUALIZAR REPORTE FINAL EN TIEMPO REAL
            updateFinalReport();
        }

        // --- ERGO SIMULATOR ---
        function initSimulator() {
            const methodSelect = document.getElementById('sim-method-select'); if(!methodSelect) return;
            const inputsNom036 = document.getElementById('inputs-nom036');
            
            function updateReport(score, maxScore, label, colorClass, colorHex, methodFull) {
                appState.ergoRiskScore = score; appState.ergoRiskLabel = label; appState.currentMethod = methodFull;
                const circle = document.getElementById('score-circle'); const num = document.getElementById('score-number'); const lab = document.getElementById('score-label'); const bar = document.getElementById('risk-fill-bar');
                
                // ACTUALIZAR LABEL DEL MÉTODO EN VISUALIZADOR
                const methodDisplay = document.getElementById('sim-method-display');
                if(methodDisplay) {
                     methodDisplay.innerText = methodFull;
                     methodDisplay.className = "text-sm font-bold text-navy mt-1";
                }

                if (circle && num && lab && bar) { circle.className = `w-48 h-48 rounded-full border-8 flex items-center justify-center mb-4 transition-all duration-500 ease-out mx-auto bg-gray-50 ${colorClass.replace('text-', 'border-')}`; num.innerText = score; num.className = `text-6xl font-heading font-extrabold block transition-colors ${colorClass}`; lab.innerText = label; lab.className = `text-3xl font-heading font-extrabold mb-1 transition-colors ${colorClass}`; bar.style.width = `${Math.min((score/maxScore)*100, 100)}%`; bar.style.backgroundColor = colorHex; }
                updateFinalReport();
            }
            function calcErgo() {
                const method = document.getElementById('sim-method-select').value;
                const weight = parseInt(document.getElementById('sim-weight').value); 
                document.getElementById('sim-weight-val').innerText = `${weight} kg`;
                
                // Toggle visibility
                document.getElementById('inputs-nom036').classList.add('hidden');
                document.getElementById('inputs-rula').classList.add('hidden');
                document.getElementById('inputs-reba').classList.add('hidden');
                document.getElementById(`inputs-${method}`).classList.remove('hidden');

                let score = 0;
                let label = "";
                let colorClass = "";
                let colorHex = "";
                let maxScore = 20;
                let methodTitle = "";

                if (method === 'nom036') {
                    // NOM-036-1 (MAC) Logic
                    methodTitle = "NOM-036-1 (MAC)";
                    maxScore = 25;
                    const freqVal = document.querySelector('.sim-btn-freq[data-active="true"]')?.dataset.val || 'low'; 
                    const hDist = document.getElementById('sim-h-dist').value; 
                    const vPos = document.getElementById('sim-v-pos').value; 
                    const grip = document.getElementById('sim-grip').value; 
                    
                    // Base score from weight/freq matrix
                    if (weight <= 10) score += (freqVal === 'high' ? 1 : 0); 
                    else if (weight <= 20) score += (freqVal === 'low' ? 1 : 3); 
                    else if (weight <= 25) score += (freqVal === 'low' ? 3 : 5); 
                    else score += 5; // >25kg automatic high risk base
                    
                    // Modifiers
                    if (hDist === 'med') score += 1; else if (hDist === 'far') score += 3; 
                    if (vPos === 'bad') score += 1; else if (vPos === 'crit') score += 3; 
                    if (grip === 'fair') score += 1; 
                    
                    if (currentLang === 'es') {
                        label = score <= 4 ? "RIESGO BAJO" : (score <= 10 ? "RIESGO MEDIO" : "RIESGO ALTO");
                    } else {
                        label = score <= 4 ? "LOW RISK" : (score <= 10 ? "MEDIUM RISK" : "HIGH RISK");
                    }
                    
                    if (score <= 4) { colorClass = "text-green-500"; colorHex = "#22c55e"; }
                    else if (score <= 10) { colorClass = "text-yellow-500"; colorHex = "#eab308"; }
                    else { colorClass = "text-red-500"; colorHex = "#ef4444"; }

                } else if (method === 'rula') {
                    // RULA (Rapid Upper Limb Assessment) - Proxy Logic based on inputs
                    methodTitle = (currentLang === 'es') ? "Método RULA (Extremidades)" : "RULA Method (Upper Limb)";
                    maxScore = 7;
                    score = 1; // Base
                    
                    const arm = parseInt(document.getElementById('rula-arm').value);
                    const neck = parseInt(document.getElementById('rula-neck-trunk').value);
                    const load = parseInt(document.getElementById('rula-load').value);

                    score += (arm - 1);
                    score += (neck - 1);
                    score += load;
                    
                    if (score > 7) score = 7;

                    if (score <= 2) { 
                        label = currentLang === 'es' ? "NIVEL 1" : "LEVEL 1"; 
                        colorClass = "text-green-500"; colorHex = "#22c55e"; 
                    } else if (score <= 4) { 
                        label = currentLang === 'es' ? "NIVEL 2" : "LEVEL 2"; 
                        colorClass = "text-yellow-500"; colorHex = "#eab308"; 
                    } else if (score <= 6) { 
                        label = currentLang === 'es' ? "NIVEL 3" : "LEVEL 3"; 
                        colorClass = "text-orange-500"; colorHex = "#f97316"; 
                    } else { 
                        label = currentLang === 'es' ? "NIVEL 4" : "LEVEL 4"; 
                        colorClass = "text-red-600"; colorHex = "#dc2626"; 
                    }

                } else if (method === 'reba') {
                    // REBA Logic
                    methodTitle = (currentLang === 'es') ? "Método REBA (Cuerpo Entero)" : "REBA Method (Entire Body)";
                    maxScore = 15;
                    score = 1; // Base

                    const trunk = parseInt(document.getElementById('reba-trunk').value);
                    const legs = parseInt(document.getElementById('reba-legs').value);
                    const load = parseInt(document.getElementById('reba-load').value);

                    score += (trunk - 1);
                    score += (legs - 1);
                    score += load;

                    if (score <= 1) {
                        label = currentLang === 'es' ? "INAPRECIABLE" : "NEGLIGIBLE";
                        colorClass = "text-green-500"; colorHex = "#22c55e";
                    } else if (score <= 3) {
                        label = currentLang === 'es' ? "BAJO" : "LOW";
                        colorClass = "text-teal"; colorHex = "#0d9488";
                    } else if (score <= 7) {
                        label = currentLang === 'es' ? "MEDIO" : "MEDIUM";
                        colorClass = "text-yellow-500"; colorHex = "#eab308";
                    } else if (score <= 10) {
                        label = currentLang === 'es' ? "ALTO" : "HIGH";
                        colorClass = "text-orange-500"; colorHex = "#f97316";
                    } else {
                        label = currentLang === 'es' ? "MUY ALTO" : "VERY HIGH";
                        colorClass = "text-red-600"; colorHex = "#dc2626";
                    }
                }

                updateReport(score, maxScore, label, colorClass, colorHex, methodTitle);
            }
            
            // Listeners
            methodSelect.addEventListener('change', calcErgo);
            
            const wInput = document.getElementById('sim-weight');
            if(wInput) wInput.addEventListener('input', calcErgo);
            
            document.getElementById('sim-h-dist').addEventListener('change', calcErgo);
            document.getElementById('sim-v-pos').addEventListener('change', calcErgo);
            document.getElementById('sim-grip').addEventListener('change', calcErgo);
            
            // RULA Listeners
            document.getElementById('rula-arm').addEventListener('change', calcErgo);
            document.getElementById('rula-neck-trunk').addEventListener('change', calcErgo);
            document.getElementById('rula-load').addEventListener('change', calcErgo);

            // REBA Listeners
            document.getElementById('reba-trunk').addEventListener('change', calcErgo);
            document.getElementById('reba-legs').addEventListener('change', calcErgo);
            document.getElementById('reba-load').addEventListener('change', calcErgo);
            
            document.querySelectorAll('.sim-btn-freq').forEach(btn => btn.addEventListener('click', (e) => { 
                document.querySelectorAll('.sim-btn-freq').forEach(b => { 
                    b.dataset.active = "false"; 
                    b.classList.remove('scale-[1.02]', 'bg-teal', 'text-white'); 
                    b.classList.add('bg-slate-800/50', 'text-gray-400'); 
                }); 
                e.currentTarget.dataset.active = "true"; 
                e.currentTarget.classList.add('scale-[1.02]', 'bg-teal', 'text-white'); 
                e.currentTarget.classList.remove('bg-slate-800/50', 'text-gray-400'); 
                calcErgo(); 
            }));
            
            // Initial call
            const lowBtn = document.querySelector('.sim-btn-freq[data-val="low"]');
            if(lowBtn) lowBtn.click();
            
            // Force initial visibility check
            calcErgo();
        }

        // --- I18N LOGIC ---
        // Variables declared BEFORE usage to fix ReferenceError
        const langToggle = document.getElementById('lang-toggle');
        const langToggleMobile = document.getElementById('lang-toggle-mobile');

        function toggleLanguage() {
            currentLang = currentLang === 'es' ? 'en' : 'es';
            const nextLang = currentLang === 'es' ? 'EN' : 'ES';
            if (langToggle) langToggle.innerText = nextLang; 
            if (langToggleMobile) langToggleMobile.innerText = nextLang;
            
            // 1. Update Static Text
            document.querySelectorAll('[data-i18n]').forEach(el => { 
                const key = el.getAttribute('data-i18n'); 
                if (translations[currentLang][key]) { 
                    if (el.tagName === 'INPUT' || el.tagName === 'TEXTAREA') el.placeholder = translations[currentLang][key]; 
                    else el.innerHTML = translations[currentLang][key]; 
                } 
            });

            // 2. Update Charts
            updateChartsLanguage();

            // 3. Update Report & Dynamic Elements
            updateFinalReport();
            
            // 4. Update Simulators (Recalculate labels)
            const wInput = document.getElementById('sim-weight');
            if(wInput) {
                // Trigger event to recalculate with new language strings
                wInput.dispatchEvent(new Event('input'));
            }

            const label = document.getElementById('strategy-label'); 
            if(label) label.innerText = appState.isDrHanStrategy ? translations[currentLang].strat_label_on : translations[currentLang].strat_label_off;
        }
        
        if (langToggle) langToggle.addEventListener('click', toggleLanguage); 
        if (langToggleMobile) langToggleMobile.addEventListener('click', toggleLanguage);
        
        const mobileMenuBtn = document.getElementById('mobile-menu-btn'); 
        if (mobileMenuBtn) mobileMenuBtn.addEventListener('click', () => document.getElementById('mobile-menu').classList.toggle('hidden'));
        
        window.onload = () => { initDashboard(); };

        const generateBtn = document.getElementById('ai-generate-btn'); 
        const aiLoader = document.getElementById('ai-loader'); 
        const aiResult = document.getElementById('ai-result');
        if (generateBtn) { 
            generateBtn.addEventListener('click', async () => { 
                const val = document.getElementById('ai-input').value.trim(); 
                const rTxt = translations[currentLang]; 
                if (!val) return alert("Ingrese texto"); 
                generateBtn.disabled = true; 
                aiLoader.classList.remove('hidden'); 
                aiResult.innerHTML = `<p class="text-gray-400 italic">${rTxt.ai_waiting_text}</p>`; 
                setTimeout(() => { 
                    aiResult.innerHTML = `<p><strong>${rTxt.ai_res_diag}:</strong> ${rTxt.ai_res_txt1}</p><p><strong>${rTxt.ai_res_act}:</strong><ul><li>${rTxt.ai_res_li1}</li><li>${rTxt.ai_res_li2}</li></ul>`; 
                    aiLoader.classList.add('hidden'); 
                    generateBtn.disabled = false; 
                }, 2000); 
            }); 
        }
    </script>
</body>
</html>
